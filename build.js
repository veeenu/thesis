!function t(n,e,r){function i(a,s){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=e[a]={exports:{}};n[a][0].call(l.exports,function(t){var e=n[a][1][t];return i(e?e:t)},l,l.exports,t,n,e,r)}return e[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,n,e){var r=document.getElementById("thesis-canvas"),i=r.getContext("webgl"),o=r.getBoundingClientRect(),a=o.width,s=o.height;r.width=a,r.height=s,r.style.background="black",n.exports={canvas:r,gl:i,w:a,h:s,aspectRatio:a/s}},{}],2:[function(t,n,e){var r,i,o,a,s,u,h,l=(t("./lib/util.js"),t("./lib/glMatrixSubset")),c=(l.vec3,l.mat3),p=l.mat4,x=t("./Context"),f=x.gl,v=(t("./generators/BuildingSHG.js"),f.createProgram()),d=f.createProgram(),m=f.createProgram(),y=f.createShader(f.VERTEX_SHADER),g=f.createShader(f.FRAGMENT_SHADER),E=f.createShader(f.VERTEX_SHADER),z=f.createShader(f.FRAGMENT_SHADER),b=f.createShader(f.VERTEX_SHADER),T=f.createShader(f.FRAGMENT_SHADER);o="uniform mat4 projection, viewmodel;\nuniform mat3 normalM;\n\nattribute vec3 vertex, normal, uv, extra;\n\nvarying vec4 vPosition, clipPosition;\nvarying vec3 texUV, vNormal, vExtra;\n\nvoid main() {\n  \n  vec4 viewPos = viewmodel * vec4(vertex, 1.);\n  clipPosition = gl_Position = projection * viewPos;\n\n  vPosition = viewPos;\n  vNormal = normalize(normalM * normal);\n  vExtra = extra;\n  texUV = uv;\n\n}\n\n",s="#extension GL_OES_standard_derivatives : require\n\nprecision highp float;\n\nvarying vec4 vPosition, clipPosition;\nvarying vec3 texUV, vNormal, vExtra;\n\n////////////////////////////////////////////////////////////////////////////////\n// https://github.com/ashima/webgl-noise/blob/master/src/noise2D.glsl         //\n////////////////////////////////////////////////////////////////////////////////\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\nfloat snoise(vec2 v) {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i);\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n		+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Procedural textures\n////////////////////////////////////////////////////////////////////////////////\n\nvec3 bumpMap(vec3 fvert, vec3 fnorm, float bump) {\n\n  vec3 bU = dFdx(bump) * cross(fnorm, normalize(dFdy(fvert))),\n       bV = dFdy(bump) * cross(normalize(dFdx(fvert)), fnorm),\n       bD = fnorm + (bU + bV);\n\n  return normalize(bD);\n}\n\nstruct TTextureInfo {\n  vec3 color;\n  vec3 normal;\n};\n\n#define textureBrickI(x, p, notp) ((floor(x)*(p))+max(fract(x)-(notp), 0.0))\nTTextureInfo textureBrick(vec3 fvert, vec3 fnorm, float fdepth, vec2 uv, vec3 brickColor) {\n\n  const float bW  = .0625,\n              bH  = .03125,\n              mS  = 1. / 256.,\n              mWf = mS * .5 / bW,\n              mHf = mS * .5 / bH;\n  const vec3 mortarColor = vec3(.68, .68, .71);\n\n  float u = uv.s / bW,\n        v = uv.t / bH,\n        brU = floor(u),\n        brV = floor(v);\n\n  if(mod(v * .5, 1.) > .5)\n    u += .5;\n  brU = floor(u);\n\n  float noisev = 1. +\n                 snoise(uv * 256.) * .125;\n  float brickDamp = 1. + .125 * sin(1.57 * (brU + 1.)) * sin(2. * (brV + 1.));\n\n  vec2 uuv = vec2(u, v),\n       fw = 2. * vec2(fwidth(uuv.x), fwidth(uuv.y)),\n       mortarPct = vec2(mWf, mHf),\n       brickPct = vec2(1., 1.) - mortarPct,\n       ub = (textureBrickI(uuv + fw, brickPct, mortarPct) -\n             textureBrickI(uuv, brickPct, mortarPct)) / fw;\n\n  vec3 color = mix(mortarColor, brickColor * brickDamp, ub.x * ub.y);\n\n  // Adaptive box blur filter. Not perfect but quick and somewhat acceptable\n  vec2 ubSample, ubKernel = 4. * fwidth(ub), noiseKernel = fwidth(uv);\n  float bump = 0., invd = 1. / 11.;\n\n  for(int x = -1; x <= 1; x++) {\n    for(int y = -1; y <= 1; y++) {\n      ubSample = ub + vec2(float(x), float(y)) * ubKernel;\n      bump += .1111111 * ubSample.x * ubSample.y;\n    }\n  }\n\n  // Frequency clamping\n  bump += 8. * (1. - smoothstep(0., .00125, max(noiseKernel.x, noiseKernel.y))) * noisev;\n\n  return TTextureInfo(\n    color,\n    bumpMap(fvert, fnorm, bump)\n  );\n}\n\n/******************************************************************************\\\n * Window texture\n\\******************************************************************************/\n\nTTextureInfo textureWindow(vec3 fvert, vec3 fnorm, float fdepth, vec2 uv, vec3 windowColor) {\n\n  const vec2 patternPct   = vec2(1., 1.),\n             patternStart = vec2(0., 0.), //(1. - patternPct) * .25,\n             patternEnd   = patternStart + patternPct,\n             framePct     = vec2(1. / 32., 1. / 32.),\n             frameStart   = patternStart + framePct,\n             frameEnd     = patternEnd   - framePct;\n  //const vec3 windowColor  = vec3(.8, .94, .99),\n  const vec3 frameColor   = vec3(.5, .5, .5);\n\n  vec2 fk   = fwidth(uv) * 2.,\n       uuv  = mod(uv, .5 - 1. / 64.),\n       patF = (smoothstep(frameEnd, frameEnd + fk, uuv) - smoothstep(frameStart, frameStart + fk, uuv));\n  float noisep = 1. + \n                snoise(-uv * .5) * .25;\n  float noisev = 1. + \n                 snoise(uv * 16.) * .0625 +\n                 abs(snoise(uv * 512.)) * .0625;\n\n  float bump = patF.x * patF.y;\n\n  return TTextureInfo(\n    mix(frameColor, windowColor * noisep, patF.x * patF.y),\n    bumpMap(fvert, fnorm, bump)\n  );\n}\n\n/******************************************************************************\\\n * Road texture\n\\******************************************************************************/\n\nvec3 textureRoad(vec2 uuv) {\n  const float padding = 1. / 32.,\n              tapeW   = 1. / 32.,\n              tapeL0  = padding,\n              tapeL1  = padding + tapeW,\n              tapeR1  = 1. - tapeL0,\n              tapeR0  = 1. - tapeL1,\n              tapeC0  = .5 - tapeW * .5,\n              tapeC1  = .5 + tapeW * .5,\n              vertDiv = 4.;\n  const vec3 asphaltColor = vec3(.2, .2, .2),\n             stripColor = vec3(.8, .8, .8);\n\n  vec2 uv = uuv + vec2(0, .5), fk = fwidth(uv);\n  float csSpacing = mod(.25 + uv.t * vertDiv, 1.),\n        q = \n    (\n      smoothstep(tapeL0, tapeL0 + fk.x, uv.s) - \n      smoothstep(tapeL1, tapeL1 + fk.x, uv.s)\n    ) +\n    (\n      smoothstep(tapeR0, tapeR0 + fk.x, uv.s) - \n      smoothstep(tapeR1, tapeR1 + fk.x, uv.s)\n    ) +\n    (\n      smoothstep(tapeC0, tapeC0 + fk.x, uv.s) - \n      smoothstep(tapeC1, tapeC1 + fk.x, uv.s)\n    ) * \n    (\n      smoothstep(.5 - fk.y, .5 + fk.y, csSpacing) *\n      (1. - smoothstep(1. - 2. * fk.y, 1., csSpacing))\n    )\n    ;\n\n  float noiseA = 1. +\n                 abs(snoise(uv * 16.))  * .0625 +\n                 abs(snoise(uv * 32.))  * .0625 +\n                 abs(snoise(uv * 128.)) * .125,\n        noiseS = 1. + \n                 abs(snoise(uv * 128.)) * .125;\n\n  return 6. * mix(asphaltColor * noiseA, stripColor * noiseS, q);\n}\n\nvec3 textureAsphalt(vec2 uuv) {\n  const vec3 asphaltColor = vec3(.2, .2, .2);\n\n  vec2 uv = uuv + vec2(0, .5);\n  float noiseA = 1. +\n                 abs(snoise(uv * 16.))  * .0625 +\n                 abs(snoise(uv * 32.))  * .0625 +\n                 abs(snoise(uv * 128.)) * .125;\n  return asphaltColor * 2.5 * noiseA;\n}\n////////////////////////////////////////////////////////////////////////////////\n\nfloat packColor(vec3 v) {\n  const float u = 255. / 256.;\n\n  return fract(v.x * u) + floor(v.y * u * 255.) + floor(v.z * u * 255.) * 255.;\n}\n\nvec2 packNormal(in vec3 normal)\n{\n    const float SCALE = 1.7777;\n    float scalar1 = (normal.z + 1.0) * (SCALE * 2.0);\n    return normal.xy / scalar1 + 0.5;\n}\n\nvoid main() {\n\n  TTextureInfo ti;\n  mat3 tsMatrix;\n  vec3 color, normal, tangent, tsPosition;\n\n  float depth = clipPosition.z / clipPosition.w;\n\n  normal = normalize(faceforward(vNormal, gl_FragCoord.xyz, vNormal));\n\n  if(texUV.z > 5.1) {\n    ti = textureBrick(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.xy, 1.), vExtra);\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 4.1) {\n    ti = textureWindow(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.yx, 1.), vec3(1., 1., .7));\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 3.1) {\n    ti = textureWindow(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.yx, 1.), vec3(.3, .3, .3));\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 2.1)\n    color = textureAsphalt(mod(texUV.yx, 1.));\n  else if(texUV.z > 1.1)\n    color = textureRoad(mod(texUV.xy, 1.));\n  else\n    color = textureAsphalt(mod(texUV.yx, 1.));\n\n  color = clamp(.2 * pow(color, vec3(1. / 2.2)), 0., 1.);\n\n  gl_FragColor = vec4(packNormal(normalize(normal)), packColor(color), depth);\n}\n",a="uniform mat4 viewMatrix;\n\nattribute vec3 lightPos;\nattribute vec2 position;\nvarying vec2 sscoord, coord;\n\nvarying vec3 lPos;\n\nvoid main() {\n  gl_Position = vec4(position, 0., 1.);\n  coord = .5 + .5 * position;\n  sscoord = position;\n  lPos = (viewMatrix * vec4(lightPos, 1.)).xyz;\n}\n",u="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform sampler2D target0, depthBuffer;\nuniform mat4 inverseProjection, viewMatrix;\n\nvarying vec2 sscoord, coord;\nvarying vec3 lPos;\n\nvec3 unpackColor(float d) {\n  vec3 ret;\n\n  ret.x = fract(d);\n  float zi = floor(d / 255.);\n  ret.z = fract(zi / 255.);\n  ret.y = fract( floor( d - ( zi * 255. ) ) / 255.);\n\n  return ret;\n}\n\nvec3 unpackNormal(in vec2 enc)\n{\n	const float SCALE = 1.7777;\n	vec2 nn = enc * (2.0 * SCALE) - SCALE;\n	float g = 2.0 / (dot(nn.xy, nn.xy) + 1.0);\n	vec3 normal;\n	normal.xy = g * nn.xy;\n	normal.z = g - 1.0;\n	return normal;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Main\n////////////////////////////////////////////////////////////////////////////////\n\nvoid main() {\n\n  vec4 t0 = texture2D(target0, coord);\n  if(length(t0.xy) == 0.)\n    discard;\n\n  float depth     = t0.w;\n\n  vec4 vertexFromDepth = inverseProjection * vec4(sscoord, depth, 1.);\n  vec3 vertex = vertexFromDepth.xyz / vertexFromDepth.w;\n  vec3 lightDir = lPos - vertex;\n\n  float dist = length(lightDir);\n  //if(dist > 4.)\n  //  discard;\n\n  vec3 normal    = -normalize(unpackNormal(t0.xy)),\n       color     = unpackColor(t0.z);\n\n  float lambert = max(dot(faceforward(-normal, lightDir, normal), normalize(lightDir)), 0.),\n        att = min(1., 1. / (.2 + .1 * dist + .8 * dist * dist));\n\n  gl_FragColor = vec4(lambert * att * color, 1.);\n  gl_FragColor = vec4(color, 1.);\n}\n",h="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform sampler2D target0, lightBuffer;\n\nvarying vec2 sscoord, coord;\n\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\n\nvec2 vrand( const vec2 coord ) {\n \n  vec2 noise;\n \n  float nx = dot ( coord, vec2( 12.9898, 78.233 ) );\n  float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\n \n  noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n \n  return ( noise * 2.0  - 1.0 ) * .0003;\n \n}\n\nfloat readDepth(const vec2 coord) {\n  return (96. * .001) / (1000.001 - texture2D(target0, coord).w * 999.999);\n}\n\nfloat cmpDepth(const float d1, const float d2, inout int far) {\n\n  float ga = 2., diff = (d1 - d2) * 100.;\n\n  if(diff < .4)\n    ga = .3;\n  else\n    far = 1;\n\n  float dd = diff - .4,\n        gauss = pow(EULER, -2. * dd * dd / (ga * ga));\n  \n  return gauss;\n}\n\nfloat calcAO(float depth, vec2 uv, float dw, float dh) {\n  float dd = 5. - depth * 5.;\n\n  vec2 vv = vec2(dw, dh),\n       coord1 = uv + dd * vv,\n       coord2 = uv - dd * vv;\n\n  int far = 0;\n  float tmp1 = 0., tmp2 = 0.;\n  \n  tmp1 = cmpDepth(depth, readDepth(coord1), far);\n  if(far > 0) {\n    tmp2 = cmpDepth(readDepth(coord2), depth, far);\n    tmp1 += (1. - tmp1) * tmp2;\n  }\n\n  return tmp1;\n}\n\nvoid main() {\n\n  vec3 color = 4. * texture2D(lightBuffer, coord).rgb;\n  float occlusion = 0., \n        vdepth = readDepth(coord),\n        tt = clamp(vdepth, .5, 1.);\n  vec2 noisev = vrand(coord);\n\n  float w = (1. / 1280.) / tt + (noisev.x * (1. - noisev.x)),\n        h = (1. / 800.)  / tt + (noisev.y * (1. - noisev.y)),\n        dz = 1. / 16.,\n        z = 1. - dz * .5,\n        l = 0.;\n  for(int i = 0; i <= 16; i++) {\n    float r = sqrt(1. - z),\n          pw = cos(l) * r,\n          ph = sin(l) * r;\n    occlusion += calcAO(vdepth, coord, pw * w, ph * h);\n    z -= dz;\n    l += DL;\n  }\n\n  occlusion *= dz;\n\n  color = mix(color, vec3(0.), occlusion);\n  color = pow(color, vec3(2.2));\n  //color = mix(color, vec3(1. - occlusion), .5);\n\n  gl_FragColor = vec4(color, 1.);\n\n  //gl_FragColor = vec4(lambert * att * 2.5 * color, 1.);\n}\n\n",f.clearColor(0,0,0,0),f.depthFunc(f.LESS),f.blendFunc(f.ONE,f.ONE),f.getExtension("OES_standard_derivatives"),f.getExtension("OES_texture_float"),i=f.getExtension("OES_texture_float_linear"),r=f.getExtension("WEBGL_depth_texture"),f.shaderSource(y,o),f.shaderSource(g,s),f.compileShader(y),f.compileShader(g),f.attachShader(v,y),f.attachShader(v,g),f.linkProgram(v),f.shaderSource(b,a),f.shaderSource(T,h),f.compileShader(b),f.compileShader(T),f.attachShader(d,b),f.attachShader(d,T),f.linkProgram(d),f.shaderSource(E,a),f.shaderSource(z,u),f.compileShader(E),f.compileShader(z),f.attachShader(m,E),f.attachShader(m,z),f.linkProgram(m),console.log("VP:",f.getShaderInfoLog(y),"\nFP:",f.getShaderInfoLog(g),"\nVL:",f.getShaderInfoLog(E),"\nFL:",f.getShaderInfoLog(z),"\nFS:",f.getShaderInfoLog(T));var M=f.createTexture(),A=f.createTexture(),R=f.createTexture(),w=f.createFramebuffer(),F=f.createFramebuffer();f.bindTexture(f.TEXTURE_2D,A),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,f.DEPTH_COMPONENT,x.w,x.h,0,f.DEPTH_COMPONENT,f.UNSIGNED_SHORT,null),f.bindTexture(f.TEXTURE_2D,M),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,null!==i?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,null!==i?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,x.w,x.h,0,f.RGBA,f.FLOAT,null),f.bindTexture(f.TEXTURE_2D,R),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,null!==i?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,null!==i?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,x.w,x.h,0,f.RGBA,f.UNSIGNED_BYTE,null),f.bindTexture(f.TEXTURE_2D,null),f.bindFramebuffer(f.FRAMEBUFFER,w),f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.TEXTURE_2D,A,0),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,M,0),f.bindFramebuffer(f.FRAMEBUFFER,F),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,R,0),f.bindFramebuffer(f.FRAMEBUFFER,null);for(var _=f.createBuffer(),I=f.createBuffer(),S=new Float32Array(9216),P=[],D=p.create(),N=p.create(),L=0;512>L;L++)P.push(1,-1,-1,-1,-1,1,1,-1,-1,1,1,1);f.bindBuffer(f.ARRAY_BUFFER,_),f.bufferData(f.ARRAY_BUFFER,new Float32Array(P),f.STATIC_DRAW),f.bindBuffer(f.ARRAY_BUFFER,I),f.bufferData(f.ARRAY_BUFFER,S,f.STREAM_DRAW),f.bindBuffer(f.ARRAY_BUFFER,null),p.perspective(D,Math.PI/2,x.aspectRatio,.001,1e3),p.invert(N,D),["vertex","normal","uv","extra"].forEach(function(t){v[t]=f.getAttribLocation(v,t)}),["projection","viewmodel","normalM"].forEach(function(t){v[t]=f.getUniformLocation(v,t)}),["position"].forEach(function(t){d[t]=f.getAttribLocation(d,t)}),["target0","lightBuffer"].forEach(function(t){d[t]=f.getUniformLocation(d,t)}),["position","lightPos"].forEach(function(t){m[t]=f.getAttribLocation(m,t)}),["target0","depthBuffer","inverseProjection","viewMatrix"].forEach(function(t){m[t]=f.getUniformLocation(m,t)}),v.activate=function(t){f.useProgram(v),f.bindFramebuffer(f.FRAMEBUFFER,w),f.enable(f.DEPTH_TEST),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);var n=p.create(),e=c.create();p.mul(n,t.view,t.model),c.normalFromMat4(e,n),f.uniformMatrix4fv(v.projection,!1,D),f.uniformMatrix4fv(v.viewmodel,!1,n),f.uniformMatrix3fv(v.normalM,!1,e),f.enableVertexAttribArray(v.vertex),f.enableVertexAttribArray(v.normal),f.enableVertexAttribArray(v.uv),f.enableVertexAttribArray(v.extra),t.meshes.forEach(function(t){f.bindBuffer(f.ARRAY_BUFFER,t.vBuf),f.vertexAttribPointer(v.vertex,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,t.nBuf),f.vertexAttribPointer(v.normal,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,t.uBuf),f.vertexAttribPointer(v.uv,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,t.eBuf),f.vertexAttribPointer(v.extra,3,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLES,0,t.count)})},v.deactivate=function(){f.bindFramebuffer(f.FRAMEBUFFER,null),f.disableVertexAttribArray(v.vertex),f.disableVertexAttribArray(v.normal),f.disableVertexAttribArray(v.uv),f.disableVertexAttribArray(v.extra),f.disable(f.DEPTH_TEST)},d.activate=function(t){f.useProgram(d),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,M),f.activeTexture(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,R),f.uniform1i(d.target0,0),f.uniform1i(d.lightBuffer,1),f.bindBuffer(f.ARRAY_BUFFER,_),f.vertexAttribPointer(d.position,2,f.FLOAT,!1,0,0),f.enableVertexAttribArray(d.position),f.drawArrays(f.TRIANGLES,0,6)},d.deactivate=function(){},m.activate=function(t){f.useProgram(m),f.bindFramebuffer(f.FRAMEBUFFER,F),f.enable(f.BLEND),f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,M),f.uniform1i(m.target0,0),f.uniformMatrix4fv(m.viewMatrix,!1,t.view),f.uniformMatrix4fv(m.inverseProjection,!1,N),f.bindBuffer(f.ARRAY_BUFFER,_),f.vertexAttribPointer(m.position,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,I),f.vertexAttribPointer(m.lightPos,3,f.FLOAT,!1,0,0);var n=Math.min(t.lights.length,S.length),e=S.subarray(0,n);e.set(t.lights),f.bufferSubData(f.ARRAY_BUFFER,0,e),f.enableVertexAttribArray(m.position),f.enableVertexAttribArray(m.lightPos),f.drawArrays(f.TRIANGLES,0,n/3)},m.deactivate=function(){f.bindFramebuffer(f.FRAMEBUFFER,null),f.disable(f.BLEND)},n.exports={render:function(t){v.activate(t),v.deactivate(),m.activate(t),m.deactivate(),d.activate(t),d.deactivate()}}},{"./Context":1,"./generators/BuildingSHG.js":5,"./lib/glMatrixSubset":16,"./lib/util.js":17}],3:[function(t,n,e){var r=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=t("./../lib/Geom"),a=(t("./PRNG"),new r),s=new r;a.define("Balcony",null,function(){var t=this.points,n={sym:"BalconyFloor",points:[{x:t[0].x,y:t[0].y,z:t[0].z},{x:t[1].x,y:t[1].y,z:t[1].z},{x:t[2].x,y:t[2].y,z:t[2].z},{x:t[3].x,y:t[3].y,z:t[3].z}],extrudeBorders:this.floorHeight},e={sym:"BalconyFloor",points:[{x:t[0].x,y:t[0].y+this.floorHeight,z:t[0].z},{x:t[1].x,y:t[1].y+this.floorHeight,z:t[1].z},{x:t[2].x,y:t[2].y+this.floorHeight,z:t[2].z},{x:t[3].x,y:t[3].y+this.floorHeight,z:t[3].z}]},r=i.extrudeAll(n.points,this.floorHeight,"TQuad"),o=i.extrudeAll(e.points,this.fenceHeight,"Fence");return o.pop(),r.push.apply(r,o),r.push(n,e),r}),a.define("BalconyFloor",null,function(){var t=i.splitXZ(this,[.8,.15,.05],[.05,.45,.5],"TQuad"),n=t.splice(4,1).shift().points;if("extrudeBorders"in this){var e=i.extrudeAll([{x:n[0].x,y:n[0].y,z:n[0].z},{x:n[1].x,y:n[1].y,z:n[1].z},{x:n[2].x,y:n[2].y,z:n[2].z},{x:n[3].x,y:n[3].y,z:n[3].z}],this.extrudeBorders,"TQuad");t.push.apply(t,e)}return t}),a.define("Fence",null,function(){var t=i.fit("x",this,"StickBase",.25),n=this.points[0],e=this.points[1],r=(this.points[2],this.points[3]),o=r.x-n.x,a=(e.y-n.y,r.z-n.z),s=Math.atan2(a,o)-Math.PI/2,u=(Math.sqrt(o*o+a*a),.05*Math.cos(s)),h=.05*Math.sin(s),l={sym:"TQuad",points:[{x:n.x,y:e.y,z:n.z},{x:n.x+u,y:e.y,z:n.z+h},{x:r.x+u,y:e.y,z:r.z+h},{x:r.x,y:e.y,z:r.z}]},c={sym:"TQuad",points:[{x:n.x,y:e.y+.05,z:n.z},{x:n.x+u,y:e.y+.05,z:n.z+h},{x:r.x+u,y:e.y+.05,z:r.z+h},{x:r.x,y:e.y+.05,z:r.z}]};t.push(l),t.push(c);var p=l.points;return t.push.apply(t,i.extrudeAll([{x:p[0].x,y:p[0].y,z:p[0].z},{x:p[1].x,y:p[1].y,z:p[1].z},{x:p[2].x,y:p[2].y,z:p[2].z},{x:p[3].x,y:p[3].y,z:p[3].z}],.05,"TQuad")),t}),a.define("StickBase",null,function(){var t=i.split(this,[.45,.1,.45],[1],null),n=t[1],e=n.points,r=e[3].x-e[0].x,o=e[1].y-e[0].y,a=e[3].z-e[0].z,s=Math.atan2(a,r)-Math.PI/2,u=Math.sqrt(r*r+a*a),h=Math.abs(o),l=Math.cos(s)*u,c=Math.sin(s)*u;return{sym:"Stick",points:[{x:e[0].x,y:e[0].y,z:e[0].z},{x:e[0].x+l,y:e[0].y,z:e[0].z+c},{x:e[3].x+l,y:e[0].y,z:e[3].z+c},{x:e[3].x,y:e[0].y,z:e[3].z}],stickHeight:h}}),a.define("Stick",null,function(){var t=this.points;return i.extrudeAll([{x:t[0].x,y:t[0].y,z:t[0].z},{x:t[1].x,y:t[1].y,z:t[1].z},{x:t[2].x,y:t[2].y,z:t[2].z},{x:t[3].x,y:t[3].y,z:t[3].z}],this.stickHeight,"TQuad")}),a.define("TQuad",null,function(){var t,n=[],e=[],i=[];this.uvs=this.uvs||[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];var a=this.points[0],s=this.points[1],u=this.points[2],h=this.points[3];n=[a.x,a.y,a.z,s.x,s.y,s.z,u.x,u.y,u.z,a.x,a.y,a.z,u.x,u.y,u.z,h.x,h.y,h.z],i=[0,1,2,0,2,3].reduce(function(t,n){return t.push(this.uvs[n].s,this.uvs[n].t,this.texID||0),t}.bind(this),[]),t=o.triToNormal(n);for(var l=0;6>l;l++)e.push.apply(e,t);return{sym:r.TERMINAL,vertices:n,normals:e,uvs:i}}),s.define("Staircase",null,function(){for(var t=this.stairHeight+this.stairSpace,n=this.height/t,e=this.width/n,r=[],i=0;n>=i;i++)r.push({sym:"Stair",x:this.x+e*i,y:this.y+t*i,z:this.z,height:this.stairHeight,width:e,depth:this.stairDepth});return r.push({sym:"TQuad",points:[{x:this.x-e/2,y:this.y,z:this.z-this.stairDepth/2},{x:this.x-e/2+this.width,y:this.y+this.height,z:this.z-this.stairDepth/2},{x:this.x+e/2+this.width,y:this.y+this.height,z:this.z-this.stairDepth/2},{x:this.x+e/2,y:this.y,z:this.z-this.stairDepth/2}]},{sym:"TQuad",points:[{x:this.x-e/2,y:this.y,z:this.z+this.stairDepth/2},{x:this.x-e/2+this.width,y:this.y+this.height,z:this.z+this.stairDepth/2},{x:this.x+e/2+this.width,y:this.y+this.height,z:this.z+this.stairDepth/2},{x:this.x+e/2,y:this.y,z:this.z+this.stairDepth/2}]}),r}),s.define("Stair",null,function(){var t=this.width/2,n=this.height/2,e=this.depth/2,r=[{sym:"TQuad",points:[{x:this.x-t,y:this.y-n,z:this.z-e},{x:this.x-t,y:this.y-n,z:this.z+e},{x:this.x+t,y:this.y-n,z:this.z+e},{x:this.x+t,y:this.y-n,z:this.z-e}]},{sym:"TQuad",points:[{x:this.x-t,y:this.y+n,z:this.z-e},{x:this.x-t,y:this.y+n,z:this.z+e},{x:this.x+t,y:this.y+n,z:this.z+e},{x:this.x+t,y:this.y+n,z:this.z-e}]}];return r.push.apply(r,i.extrudeAll(r[0].points,this.height,"TQuad")),r}),s.define("TQuad",null,function(){var t,n=[],e=[],i=[];this.uvs=this.uvs||[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];var a=this.points[0],s=this.points[1],u=this.points[2],h=this.points[3];n=[a.x,a.y,a.z,s.x,s.y,s.z,u.x,u.y,u.z,a.x,a.y,a.z,u.x,u.y,u.z,h.x,h.y,h.z],i=[0,1,2,0,2,3].reduce(function(t,n){return t.push(this.uvs[n].s,this.uvs[n].t,this.texID||0),t}.bind(this),[]),t=o.triToNormal(n);for(var l=0;6>l;l++)e.push.apply(e,t);return{sym:r.TERMINAL,vertices:n,normals:e,uvs:i}});var u,h;u=a.run({sym:"Balcony",points:[{x:-.5,y:0,z:0},{x:-.5,y:0,z:1},{x:.5,y:0,z:1},{x:.5,y:0,z:0}],floorHeight:.025,fenceHeight:.4}).reduce(function(t,n){for(var e=0,r=n.vertices.length;r>e;e++)t.vertices.push(n.vertices[e]),t.normals.push(n.normals[e]),t.uvs.push(n.uvs[e]);return t},{vertices:[],normals:[],uvs:[]}),h=s.run({sym:"Staircase",x:-0.2375,y:.0125,z:.35,height:1,width:.7,stairDepth:.2,stairHeight:.025,stairSpace:.0625}).reduce(function(t,n){for(var e=0,r=n.vertices.length;r>e;e++)t.vertices.push(n.vertices[e]),t.normals.push(n.normals[e]),t.uvs.push(n.uvs[e]);return t},{vertices:u.vertices.slice(),normals:u.normals.slice(),uvs:u.uvs.slice()});var l=function(t){var n=t.vertices,e=t.normals,r=t.uvs;return function(t){for(var i=t.angle,o=Math.cos(i),a=Math.sin(i),s=t.x1-t.x0,u=t.z1-t.z0,h=t.x0+s/2,l=t.z0+u/2,c=t.y,p=t.width,x=t.height,f=t.depth,v=n.length,d=new Float32Array(v),m=new Float32Array(v),y=new Float32Array(r),g=0;v>g;g+=3){var E=n[g]*p,z=n[g+1]*x+c,b=n[g+2]*f;d[g]=E*o+b*a+h,d[g+1]=z,d[g+2]=-E*a+b*o+l,E=e[g],z=e[g+1],b=e[g+2],E=E*o+b*a+h,b=-E*a+b*o+l,m[g]=E,m[g+1]=z,m[g+2]=b}return{vertices:d,normals:m,uvs:y}}};n.exports={createBalcony:l(u),createBalconyWithStairs:l(h)}},{"../lib/SHAPE.js":14,"./../lib/Geom":10,"./../lib/ShapeGrammar":15,"./PRNG":7}],4:[function(t,n,e){var r=t("./PRNG"),i=t("./../lib/Geom"),o=(t("./../lib/ShapeGrammar"),function(t,n,e){return(1-e)*t+e*n}),a=function(t,n,e){var r,a,u,h,l,c,p,x,f,v,d,m,y,g=[],E=[],z=[],b=[];for(x=0,d=t.length;d>x;x++)for(r=(x+1)%d,a=(x+2)%d,u=(x-1+d)%d,h=i.lineIntersection(t[x],t[r],n[u],n[x]),l=i.lineIntersection(t[x],t[r],n[r],n[a]),c=h.x-l.x,p=h.y-l.y,y=Math.sqrt(c*c+p*p),ang=Math.atan2(p,c),v=2,E.push(v),z.push(ang),f=0;v>f;f++){var T=f/(v-1);px1=o(h.x,l.x,T),py1=o(h.y,l.y,T),px2=o(n[x].x,n[r].x,T),py2=o(n[x].y,n[r].y,T),g.push({x:o(h.x,l.x,T),y:o(h.y,l.y,T)},{x:o(n[x].x,n[r].x,T),y:o(n[x].y,n[r].y,T)})}for(g.push(g[0]),x=0,d=t.length;d>x;x++){for(m=[],f=0;f<E[x];f++)m.push(g.shift()),m.push(g.shift());m.push(t[(x+1)%d]),m.push(g[0]||t[0]);for(var M=0,v=m.length;v-2>M;M+=2)b.push(new s([m[M],m[(M+1)%v],m[(M+3)%v],m[(M+2)%v]],e.random()+.5,z[x]))}return b},s=function(t,n,e){this.poly=t,this.height=n,this.angle=e},u=function(t,n){var e=new r(n);this.poly=t,this.block=i.insetPolygon(this.poly,.05),this.lots=a(i.insetPolygon(this.block,.1),i.insetPolygon(this.block,.6),e);var o=t.reduce(function(t,n){return t.cx+=n.x,t.cy+=n.y,t.xm>n.x&&(t.xm=n.x),t.xM<n.x&&(t.xM=n.x),t.ym>n.y&&(t.ym=n.y),t.yM<n.y&&(t.yM=n.y),t},{xm:Number.POSITIVE_INFINITY,ym:Number.POSITIVE_INFINITY,xM:Number.NEGATIVE_INFINITY,yM:Number.NEGATIVE_INFINITY,cx:0,cy:0});this.x=o.cx/t.length,this.y=o.cy/t.length,this.w=Math.max(Math.abs(o.xM-o.xm),Math.abs(o.yM-o.ym))};n.exports=u},{"./../lib/Geom":10,"./../lib/ShapeGrammar":15,"./PRNG":7}],5:[function(t,n,e){var r=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=t("earcut"),a=t("./../lib/Geom"),s=t("./PRNG"),u=t("./BalconySHG.js"),h=new r,l=new s(31337),c=new s(31338),p=new s(31339),x=new s(31337);h.define("Building",null,function(){for(var t=[],n=0,e=0,r=this.floorsLayout.length;r>e;e++){var i=this.floorsLayout[e],o={sym:i.type,height:i.height,params:i,points:this.points.map(function(t){return{x:t.x,y:t.y+n,z:t.z}}),facadeLayout:this.facadeLayout};"frontFacade"in this&&(o.frontFacade=this.frontFacade),"hasBalcony"in this&&(o.hasBalcony=this.hasBalcony),n+=i.height,t.push(o)}return t}),h.define("FL_GndFloor",null,function(){2*Math.PI;return function(){{var t=i.extrudeAll(this.points,this.height,"Facade",[0,1,0]);this.params.frontSide}switch(this.params.tiles){case"OneDoor":for(var n=0,e=t.length;e>n;n++)t[n].type=this.facadeLayout[n]||"Windows";t[this.frontFacade].type="OneDoor"}return t}}()),h.define("FL_Floor",null,function(){for(var t=i.extrudeAll(this.points,this.height,"Facade",[0,1,0]),n=0,e=t.length;e>n;n++)t[n].type=this.facadeLayout[n]||"Windows",t[n].windows=this.params.windows;return"hasBalcony"in this&&(t[this.frontFacade].hasBalcony=this.hasBalcony),t}),h.define("FL_Ledge",null,function(){for(var t=[],n=this.height,e=this.points[0].y,r=0,o=this.points.length;o>r;r++){var s=this.points[r],u=this.points[(r+1)%o],l=Math.atan2(u.z-s.z,u.x-s.x),c=l-Math.PI/2;Math.cos(l)+Math.cos(c),Math.sin(l)+Math.sin(c)}t=a.insetPolygon(this.points.map(function(t){return{x:t.x,y:t.z}}),this.params.width).map(function(t){return{x:t.x,y:e,z:t.y}});var p=i.extrudeAll(t,this.height,"Quad",[0,1,0]);return p.forEach(function(t){var e=t.points[3].x-t.points[0].x,r=t.points[1].y-t.points[0].y,i=t.points[3].z-t.points[0].z,o=n/h.UVSCALE,a=o*Math.sqrt(e*e+i*i)/r;t.uvs=[{s:0,t:o},{s:0,t:0},{s:a,t:0},{s:a,t:o}],t.texID=6}),p.push({sym:"Poly",texID:6,points:t}),p.push({sym:"Poly",texID:6,points:t.map(function(t){return{x:t.x,y:t.y+n,z:t.z}})}),p}),h.define("FL_Rooftop",null,function(){for(var t=[],n=this.height,e=this.points[0].y,r=0,o=this.points.length;o>r;r++){var s=this.points[r],u=this.points[(r+1)%o],l=Math.atan2(u.z-s.z,u.x-s.x),c=l-Math.PI/2;Math.cos(l)+Math.cos(c),Math.sin(l)+Math.sin(c)}t=a.insetPolygon(this.points.map(function(t){return{x:t.x,y:t.z}}),-this.params.width).map(function(t){return{x:t.x,y:e,z:t.y}});for(var p=i.extrudeAll(this.points,this.height,"Quad",[0,1,0]),x=i.extrudeAll(t,this.height,"Quad",[0,1,0]);p.length;)x.push(p.shift());x.forEach(function(t){var e=t.points[3].x-t.points[0].x,r=t.points[1].y-t.points[0].y,i=t.points[3].z-t.points[0].z,o=n/h.UVSCALE,a=o*Math.sqrt(e*e+i*i)/r;t.uvs=[{s:0,t:o},{s:0,t:0},{s:a,t:0},{s:a,t:o}],t.texID=6}),x.push({sym:"Poly",points:t,texID:3});for(var r=0,o=t.length;o>r;r++){var f=(r+1)%o,s=this.points[r],u=t[r],v=t[f],d=this.points[f],m={sym:"Poly",points:[s,u,v,s,v,d].map(function(t){return{x:t.x,y:t.y+n,z:t.z}}),texID:6};x.push(m)}return x}),h.define("Facade",function(){return"OneDoor"===this.type},function(){var t=this.points[3].x-this.points[0].x,n=this.points[1].y-this.points[0].y,e=this.points[3].z-this.points[0].z,r=n/h.UVSCALE,o=r*Math.sqrt(t*t+e*e)/n;this.uvs=[{s:0,t:r},{s:0,t:0},{s:o,t:0},{s:o,t:r}];var a=i.fit("x",this,"Window",1);a[~~(a.length/2)].sym="Door";for(var s=0,u=a.length;u>s;s++)a[s].normal=this.normal;return a}),h.define("Facade",null,function(){var t=this.points[3].x-this.points[0].x,n=this.points[1].y-this.points[0].y,e=this.points[3].z-this.points[0].z,o=Math.sqrt(t*t+e*e),a=n/h.UVSCALE,s=a*o/n,l=null,c=this.normal;this.uvs=[{s:0,t:a},{s:0,t:0},{s:s,t:0},{s:s,t:a}];var p=i.fit("x",this,"Window",1).map(function(t){return t.normal=c,t});if("Window"===this.type);else if("function"==typeof this.type)for(var x=0,f=p.length;f>x;x++)this.type(x)||(p[x].sym="Quad",p[x].texID=6);if(this.hasBalcony){var v=(p.length%2===0?2:3)/p.length,d={x0:this.points[0].x,z0:this.points[0].z,x1:this.points[3].x,z1:this.points[3].z,y:this.points[0].y,height:n,width:.9*o*v,depth:.4*o*v,angle:Math.atan2(-e,t)};l=u.createBalconyWithStairs(d),l.sym=r.TERMINAL}for(var x=0,f=p.length;f>x;x++)p[x].normal=this.normal;return null!==l&&p.push(l),p}),h.define("Window",null,function(){{var t=i.split(this,[.3,.4,.3],[1],"Quad"),n=i.split(t[1],[1],[.15,.7,.15],"Quad"),e=n[1],r=l.random()>.8;e.uvs}e.uvs=null,e.texID=r?5:4,t[0].texID=t[2].texID=n[0].texID=n[2].texID=6;var o=[t[0],t[2],n[0],n[2]],s=this.normal||a.triToNormal([e.points[0].x,e.points[0].y,e.points[0].z,e.points[1].x,e.points[1].y,e.points[1].z,e.points[2].x,e.points[2].y,e.points[2].z]),u=i.extrudeAll(e.points,-.005,"Quad",s),h=s[0],c=s[1],p=s[2];h*=.005,c*=.005,p*=.005;for(var x=0,f=e.points.length;f>x;x++){var v=e.points[x];v.x-=h,v.y-=c,
v.z-=p}for(var x=0,f=u.length;f>x;x++)u[x].texID=3,o.push(u[x]);return o.push(e),o}),h.define("Door",null,function(){{var t=i.split(this,[.15,.7,.15],[1],"Quad"),n=i.split(t[1],[1],[.7,.3],"Quad"),e=n[0];e.uvs}e.uvs=null,e.texID=l.random()>.3?4:5,t[0].texID=t[2].texID=n[1].texID=6;var r=[t[0],t[2],n[1]],o=a.triToNormal([e.points[0].x,e.points[0].y,e.points[0].z,e.points[1].x,e.points[1].y,e.points[1].z,e.points[2].x,e.points[2].y,e.points[2].z]),s=i.extrudeAll(e.points,-.005,"Quad",o),u=o[0],h=o[1],c=o[2];u*=.005,h*=.005,c*=.005;for(var p=0,x=e.points.length;x>p;p++){var f=e.points[p];f.x-=u,f.y-=h,f.z-=c}for(var p=0,x=s.length;x>p;p++)s[p].texID=3,r.push(s[p]);return r.push(e),r}),h.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var n,e,i,o,s,u,h,l,c,p,x,f,v=[],d=this.points;c=d[0],p=d[1],x=d[2],f=d[3],n=[c.x,c.y,c.z,p.x,p.y,p.z,x.x,x.y,x.z,c.x,c.y,c.z,x.x,x.y,x.z,f.x,f.y,f.z],i=this.normal||a.triToNormal(n);for(var m=0;6>m;m++)v.push(i[0],i[1],i[2]);return e=this.uvs||t,s=e[0],u=e[1],h=e[2],l=e[3],o=this.texID||0,e=[s.s,s.t,o,u.s,u.t,o,h.s,h.t,o,s.s,s.t,o,h.s,h.t,o,l.s,l.t,o],{sym:r.TERMINAL,vertices:n,normals:v,uvs:e}}}()),h.define("Poly",null,function(){var t,n,e,i,s,u,h,l=this.points.map(function(t){return[t.x,t.z]}),c=this.points[0].y,p=o([l]),x=p.reduce(function(t,n){return t.push(n[0],c,n[1]),t},[]),f=this.normal||a.triToNormal(x),v=[],d=[];t=n=Number.POSITIVE_INFINITY,e=i=Number.NEGATIVE_INFINITY;for(var m=0,y=this.points.length;y>m;m++)h=this.points[m],t>h.x&&(t=h.x),e<h.x&&(e=h.x),n>h.z&&(n=h.z),i<h.z&&(i=h.z);s=e-t,u=i-n;for(var m=0,y=x.length;y>m;m+=3){var g=x[m],E=x[m+2];d.push((g-t)/s,(E-n)/u,this.texID),v.push(f[0],f[1],f[2])}return{sym:r.TERMINAL,vertices:x,normals:v,uvs:d}});var f=[[.9,.65,.48],[.75,.73,.69],[.82,.67,.42],[.6,.39,.33]];h.UVSCALE=.1,n.exports={shg:h,create:function(t){var n=t.width/2,e=t.depth/2,r=t.x-n,i=t.x+n,o=t.y-e,a=t.y+e,s=Math.max(n/e,e/n),u=null,l=!1,v=[];if(1.3>s&&c.random()<.3)for(var d=0;8>d;d++){var m=-t.angle-d*Math.PI/4;v.push({x:t.x+n*Math.cos(m),y:0,z:t.y+e*Math.sin(m)}),u=0}else if(s>1.1&&c.random()<.8){l=!0;var y=2/2.7;n>e?t.angle<.1?(v.push({x:r,y:0,z:o},{x:r,y:0,z:a},{x:r+n*y,y:0,z:a},{x:r+n*y,y:0,z:a-e*y},{x:i-n*y,y:0,z:a-e*y},{x:i-n*y,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),u=3):(v.push({x:r,y:0,z:o},{x:r,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o},{x:i-n*y,y:0,z:o},{x:i-n*y,y:0,z:o+e*y},{x:r+n*y,y:0,z:o+e*y},{x:r+n*y,y:0,z:o}),u=5):t.angle>0?(v.push({x:r,y:0,z:o},{x:r,y:0,z:o+e*y},{x:r+n*y,y:0,z:o+e*y},{x:r+n*y,y:0,z:a-e*y},{x:r,y:0,z:a-e*y},{x:r,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),u=2):(v.push({x:r,y:0,z:o},{x:r,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:a-e*y},{x:i-n*y,y:0,z:a-e*y},{x:i-n*y,y:0,z:o+e*y},{x:i,y:0,z:o+e*y},{x:i,y:0,z:o}),u=4)}else v.push({x:r,y:0,z:o},{x:r,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),u=n>e?t.angle<.1?1:3:t.angle<0?2:0;var g=[],E=~~(2*p.random()),z=[];switch(E){case 0:g.push({type:"FL_GndFloor",height:.05,tiles:"OneDoor",frontSide:t.angle},{type:"FL_Ledge",height:.00625,width:.00625});for(var d=0,b=4+~~(20*x.random());b>d;d++)g.push({type:"FL_Floor",height:.05,windows:"Double"});g.push({type:"FL_Ledge",height:.00625,width:.00625},{type:"FL_Floor",height:.0625,windows:"Single"},{type:"FL_Rooftop",height:.00625,width:.00625});break;case 1:g.push({type:"FL_GndFloor",height:.05,tiles:"OneDoor",frontSide:t.angle});for(var d=0,b=4+~~(10*x.random());b>d;d++)g.push({type:"FL_Floor",height:.05,windows:"Double"});g.push({type:"FL_Floor",height:.05,windows:"Single"},{type:"FL_Rooftop",height:.00625,width:.00625})}for(var d=0,b=v.length;b>d;d++){var T=~~(3*x.random());switch(T){case 0:z[d]="Windows";break;case 1:z[d]=function(t){return!(t%3===0)};break;case 2:z[d]=function(t){return t%2===0}}}var M={sym:"Building",floorsLayout:g,facadeLayout:z,points:v};null!==u&&(M.frontFacade=u),l&&(M.hasBalcony=!0);var A=f[~~(x.random()*f.length)],R=h.run(M);return{geom:R,color:A}},getGeom:function(){return context}}},{"../lib/SHAPE.js":14,"./../lib/Geom":10,"./../lib/ShapeGrammar":15,"./BalconySHG.js":3,"./PRNG":7,earcut:19}],6:[function(t,n,e){var r=new(t("./PRNG")),i=t("./../lib/Geom"),o=t("./Roads.js"),a=t("./Block.js"),s=(t("../lib/ShapeGrammar.js"),function(){var t=2*Math.PI;return function(n,e,r,o){var a,u,h,l=Math.atan2(-e.y+n.y,e.x-n.x),c={th:Number.POSITIVE_INFINITY,vertex:null};"traversed"in n||(n.traversed=[]),"traversed"in e||(e.traversed=[]),n.traversed.push(e);for(var p=0;p<e.conns.length;p++)u=e.conns[p],u===n||-1!==e.traversed.indexOf(u)||o&&u!==o[0]&&-1!==o.indexOf(u)||(a=Math.atan2(-u.y+e.y,u.x-e.x)-l,a>Math.PI?a-=t:a<-Math.PI&&(a+=t),a<c.th&&(c.th=a,c.vertex=e.conns[p]));return null===c.vertex?null:(o&&o.push(e),o&&c.vertex===o[0]?(h=i.isOverlapping(o,r))?null:(e.traversed.push(o[0]),o):(o=s(e,c.vertex,r,o||[n,e]),null===o&&e.traversed.splice(e.traversed.indexOf(c.vertex),1),o||null))}}()),u=function(t){r.seed(t);var n=[];this.roads=o(),this.blocks=[];for(var e=0;e<this.roads.length;e++)for(var u=0;u<this.roads[e].conns.length;u++){"traversed"in this.roads[e]||(this.roads[e].traversed=[]);var h=s(this.roads[e],this.roads[e].conns[u],this.roads);null===h||i.isPolyIn(h,n)||(n.push(h),this.blocks.push(new a(h,65536*r.random())))}this.roads.forEach(function(t){t.traversed=[]});var l=[];this.roads.forEach(function(t){t.conns.forEach(function(n){-1===n.traversed.indexOf(t)&&(l.push([t,n]),t.traversed.push(n),n.traversed.push(t))})}),this.roadQuads=l};n.exports=u},{"../lib/ShapeGrammar.js":15,"./../lib/Geom":10,"./Block.js":4,"./PRNG":7,"./Roads.js":8}],7:[function(t,n,e){var r=t("mersennetwister"),i=function(t){void 0!==t?this.seed(t):this.mt=new r};i.prototype.seed=function(t){this.mt=new r(t)},i.prototype.random=function(){return this.mt.random()},n.exports=i},{mersennetwister:20}],8:[function(t,n,e){var r=t("./PRNG"),i=3,o=0,a=2;n.exports=function(t){for(var n=[],e=new r(t),s=0;i>s;s++)for(var u=0;i>u;u++){var h=n[s*i+u]={x:a*u+o*e.random(),y:a*s+o*e.random(),conns:[]};u>0&&(h.conns.push(n[s*i+u-1]),n[s*i+u-1].conns.push(h)),s>0&&(h.conns.push(n[(s-1)*i+u]),n[(s-1)*i+u].conns.push(h))}return n}},{"./PRNG":7}],9:[function(t,n,e){var r=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=(t("earcut"),t("./../lib/Geom")),a=t("./PRNG"),s=new r,u=new a(12345);s.define("Room",function(){var t=i.bounds(this);return t.width>t.depth&&(t.width>s.minWidth&&u.random()<s.density||t.width>s.maxWidth)},function(){return i.splitXZ(this,[s.ratio,1-s.ratio],[1],"Room")}),s.define("Room",function(){var t=i.bounds(this);return t.width<=t.depth&&(t.depth>s.minWidth&&u.random()<s.density||t.width>s.maxWidth)},function(){return i.splitXZ(this,[1],[s.ratio,1-s.ratio],"Room")}),s.define("Room",null,function(t){for(var n=this.points,e=[],o=i.inset(this.points,.05),e=[],a=0,s=n.length;s>a;a++){var u,h,l=o[a],c=o[(a+1)%s],p=c.x-l.x,x=c.z-l.z,f=Math.atan2(x,p),v=f+Math.PI/2,d=Math.sin(f),m=Math.cos(f),y=Math.sin(v),g=Math.cos(v);u={x:l.x+.3*m,y:l.y,z:l.z+.3*d},h={x:c.x-.3*m,y:c.y,z:c.z-.3*d},e.push({sym:"Wall",points:[n[a],n[(a+1)%s]],p0:u,p1:h,boundaries:[{x:u.x-.1*g,z:u.z-.1*y},{x:u.x+.1*g,z:u.z+.1*y},{x:h.x+.1*g,z:h.z+.1*y},{x:h.x-.1*g,z:h.z-.1*y}].reduce(function(t,n){return{maxX:Math.max(t.maxX,n.x),maxZ:Math.max(t.maxZ,n.z),minX:Math.min(t.minX,n.x),minZ:Math.min(t.minZ,n.z)}},{maxX:Number.NEGATIVE_INFINITY,maxZ:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minZ:Number.POSITIVE_INFINITY}),length:Math.sqrt(p*p+x*x),angle:f})}e.push({sym:"Quad",points:this.points});var E=1/n.length;return e.push({sym:r.TERMINAL,roomCentroid:this.points.reduce(function(t,n){return t.x+=E*n.x,t.y+=E*n.y,t.z+=E*n.z,t},{x:0,y:0,z:0})}),e}),s.define("Wall",function(t){return!t.reduce(function(t,n){return t||"Room"===n.sym},!1)},function(t){var n=this.boundaries.maxX,e=this.boundaries.maxZ,r=this.boundaries.minX,i=this.boundaries.minZ,o=this,a=this.length,s=t.reduce(function(t,s){if(t||s===o||s.occluded===!0||"Wall"!==s.sym)return t;var u=s.boundaries;return t||s.length>=a&&!(n<u.minX||u.maxX<r||e<u.minZ||u.maxZ<i)},!1);return s?(this.occluded=!0,{sym:"OccludedWall",points:this.points,angle:this.angle,length:this.length}):[]}),s.define("Wall",null,function(){return this}),s.define("OccludedWall",null,function(){var t=this.angle+Math.PI/2,n=Math.sin(t)*s.wallDepth/2,e=Math.cos(t)*s.wallDepth/2,r=this.points[0],o=this.points[1],a={x:r.x+e,y:r.y,z:r.z+n},u={x:o.x+e,y:o.y,z:o.z+n},h={x:r.x-e,y:r.y,z:r.z-n},l={x:o.x-e,y:o.y,z:o.z-n},c=i.extrude("OccludedWall",a,u,s.floorHeight,[0,1,0]),p=i.extrude("OccludedWall",h,l,s.floorHeight,[0,1,0]);return hspace=.5/this.length,chspace=(1-hspace)/2,hsp1=i.split(c,[chspace,hspace,chspace],[1],"Quad"),vsp1=i.split(hsp1[1],[1],[.7,.3],"Quad"),hsp2=i.split(p,[chspace,hspace,chspace],[1],"Quad"),vsp2=i.split(hsp2[1],[1],[.7,.3],"Quad"),q0=vsp1[0],q1=vsp2[0],lA=chspace,lB=chspace+hspace,wsA={x:i.lerp(r.x,o.x,lA),y:i.lerp(r.y,o.y,lA),z:i.lerp(r.z,o.z,lA)},wsB={x:i.lerp(r.x,o.x,lB),y:i.lerp(r.y,o.y,lB),z:i.lerp(r.z,o.z,lB)},[hsp1[0],hsp1[2],vsp1[1],hsp2[0],hsp2[2],vsp2[1],{sym:"Quad",points:[q1.points[1],q1.points[0],q0.points[0],q0.points[1]]},{sym:"Quad",points:[q1.points[3],q1.points[2],q0.points[2],q0.points[3]]},{sym:"Quad",points:[q1.points[2],q1.points[1],q0.points[1],q0.points[2]]},{sym:"WallSegment",points:[r,wsA]},{sym:"WallSegment",points:[wsB,o]}]}),s.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var n,e,i,a,s,u,h,l,c,p,x,f,v=[],d=this.points;c=d[0],p=d[1],x=d[2],f=d[3],n=[c.x,c.y,c.z,p.x,p.y,p.z,x.x,x.y,x.z,c.x,c.y,c.z,x.x,x.y,x.z,f.x,f.y,f.z],i=this.normal||o.triToNormal(n);for(var m=0;6>m;m++)v.push(i[0],i[1],i[2]);return e=this.uvs||t,s=e[0],u=e[1],h=e[2],l=e[3],a=this.texID||3,e=[s.s,s.t,a,u.s,u.t,a,h.s,h.t,a,s.s,s.t,a,h.s,h.t,a,l.s,l.t,a],{sym:r.TERMINAL,vertices:n,normals:v,uvs:e}}}()),s.define("Door",null,function(){return{sym:r.TERMINAL,isDoor:!0,point:this.point,angle:this.angle}}),s.define("WallSegment",null,function(){return{sym:r.TERMINAL,isWall:!0,p0:this.points[0],p1:this.points[1]}}),s.minWidth=2.5,s.maxWidth=5,s.density=.8,s.ratio=.61,s.floorHeight=1.5,s.wallDepth=.2,n.exports={shg:s,create:function(t){var n=s.run({sym:"Room",points:t}).reduce(function(t,n){if(n.isWall)t.walls.push(n);else if("roomCentroid"in n)t.rooms.push(n.roomCentroid);else for(var e=0,r=n.vertices.length;r>e;e++)t.vertices.push(n.vertices[e]),t.normals.push(n.normals[e]),t.uvs.push(n.uvs[e]);return t},{vertices:[],normals:[],uvs:[],walls:[],rooms:[]}),e=t.reduce(function(t,n){return t.minX=Math.min(n.x,t.minX),t.minZ=Math.min(n.z,t.minZ),t.maxX=Math.max(n.x,t.maxX),t.maxZ=Math.max(n.z,t.maxZ),t},{minX:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,minZ:Number.POSITIVE_INFINITY,maxZ:Number.NEGATIVE_INFINITY});return e.lenX=e.maxX-e.minX,e.lenZ=e.maxZ-e.minZ,n.lines=n.walls.reduce(function(t,n){return t.push((n.p0.x-e.minX)/e.lenX,(n.p0.z-e.minZ)/e.lenZ,(n.p1.x-e.minX)/e.lenX,(n.p1.z-e.minZ)/e.lenZ),t},[]),n.roomsWorld=n.rooms,n.rooms=n.rooms.reduce(function(t,n){return t.push({x:(n.x-e.minX)/e.lenX,y:(n.y-e.minY)/e.lenY,z:(n.z-e.minZ)/e.lenZ}),t},[]),n.width=e.lenX,n.height=e.lenZ,n.bbox=e,n}}},{"../lib/SHAPE.js":14,"./../lib/Geom":10,"./../lib/ShapeGrammar":15,"./PRNG":7,earcut:19}],10:[function(t,n,e){var r=t("./glMatrixSubset"),i=(r.vec3,{pnpoly:function(t,n,e){var r,i,o,a,s=t.length,u=!1;for(r=0,i=s-1;s>r;i=r++)o=t[r],a=t[i],o.y>e!=a.y>e&&n<(a.x-o.x)*(e-o.y)/(a.y-o.y)+o.x&&(u=!u);return u},isOverlapping:function(t,n){for(var e=n.length-1;e--;)if(i.pnpoly(t,n[e].x,n[e].y)&&-1===t.indexOf(n[e]))return!0;return!1},isPolyIn:function(t,n){for(var e=n.length-1;e>0;e--)if(i.isEqualPoly(t,n[e]))return!0;return!1},isEqualPoly:function(t,n){if(t.length!==n.length)return!1;for(var e=t.length-1;e--;)if(-1===n.indexOf(t[e]))return!1;return!0},insetPolygon:function(t,n){var e,r,o,a=[];r=t[t.length-1];for(var s=0;s<t.length-1;s++)e=r,r=t[s],o=t[s+1],a.push(i.insetCorner(e,r,o,n));return a.push(i.insetCorner(r,o,t[0],n)),a},insetCorner:function(t,n,e,r){var o,a,s,u,h=n.x-t.x,l=t.y-n.y,c=e.x-n.x,p=n.y-e.y,x=Math.sqrt(h*h+l*l),f=Math.sqrt(c*c+p*p),v={x:n.x,y:n.y},d={x:n.x,y:n.y};return 0==x||0==f?null:(o=l/x*r,s=h/x*r,a=p/f*r,u=c/f*r,v.x+=o,v.y+=s,d.x+=a,d.y+=u,v.x===d.x&&v.y===d.y?v:i.lineIntersection({x:t.x+o,y:t.y+s},v,d,{x:e.x+a,y:e.y+u}))},lineIntersection:function(t,n,e,r){var i,o,a,s,u,h={x:t.x,y:t.y},l={x:n.x,y:n.y},c={x:e.x,y:e.y},p={x:r.x,y:r.y};return l.x-=h.x,c.x-=h.x,p.x-=h.x,l.y-=h.y,c.y-=h.y,p.y-=h.y,i=Math.sqrt(l.x*l.x+l.y*l.y),o=l.x/i,a=l.y/i,s=c.x*o+c.y*a,c.y=-c.x*a+c.y*o,c.x=s,s=p.x*o+p.y*a,p.y=-p.x*a+p.y*o,p.x=s,c.y==p.y?null:(u=p.x+(c.x-p.x)*p.y/(p.y-c.y),{x:h.x+u*o,y:h.y+u*a})},triToNormal:function(t){var n=t[0]-t[3],e=t[1]-t[4],r=t[2]-t[5],i=t[6]-t[3],o=t[7]-t[4],a=t[8]-t[5],s=e*a-r*o,u=n*a-r*i,h=n*o-e*i,l=1/Math.sqrt(s*s+u*u+h*h);return s*=l,u*=l,h*=l,[s,u,h]}});n.exports=i},{"./glMatrixSubset":16}],11:[function(t,n,e){var r=t("./../Context"),o={},a=document.createElement("ul");a.style.position="absolute",a.style.top="7rem",a.style.left="1rem",a.style.color="#444",a.style.font='10px "Ubuntu Mono", monospace',a.style.lineHeight="1.5em",a.style.listStyleType="none",r.canvas.parentNode.appendChild(a),n.exports={progress:function(t,n){if(!(t in o)){var e=document.createElement("li");a.appendChild(e),o[t]={fns:[],li:e,value:0}}o[t].value=n,n>=1&&o[t].fns.forEach(function(t){t()})},subscribe:function(t,n){if(!(t in o)){var e=document.createElement("li");a.appendChild(e),o[t]={fns:[],li:e,value:0}}o[t].fns.push(n)},render:function(){for(i in o){for(var t=parseInt(100*o[i].value),n=""+t;n.length<4;)n="_"+n;n=n.replace(/_/g,"&nbsp;"),o[i].li.innerHTML="&nbsp;"+i+": "+n+"%&nbsp;\n";var e="linear-gradient(90deg, #0f0, #0f0 "+t+"%, #0b0 "+t+"%)";o[i].li.style.backgroundImage=e}}}},{"./../Context":1}],12:[function(t,n,e){var r=(t("./glMatrixSubset"),t("./../Context")),i=r.gl,o=function(t,n,e,r){this.vBuf=i.createBuffer(),this.nBuf=i.createBuffer(),this.uBuf=i.createBuffer(),this.eBuf=i.createBuffer(),this.count=t.length/3,i.bindBuffer(i.ARRAY_BUFFER,this.vBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.nBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.uBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.eBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)};n.exports=o},{"./../Context":1,"./glMatrixSubset":16}],13:[function(t,n,e){var r=function(t,n,e,r){this.nw=this.sw=this.ne=this.se=null,this.x=t,this.y=n,this.w=Math.abs(e),this.limit=r,this.points=[]};r.prototype.contains=function(t){return Math.abs(t.x-this.x)<this.w&&Math.abs(t.y-this.y)<this.w},r.prototype.insert=function(t){return this.contains(t)?this.points.length<this.limit?(this.points.push(t),!0):(null===this.nw&&this.subdivide(),this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t)):!1},r.prototype.subdivide=function(){var t=this.x,n=this.y,e=this.w/2;this.nw=new r(t-e,n-e,e,this.limit),this.sw=new r(t-e,n+e,e,this.limit),this.ne=new r(t+e,n-e,e,this.limit),this.se=new r(t+e,n+e,e,this.limit)},r.prototype.intersect=function(t,n,e){return Math.abs(this.x-t)<this.w+e&&Math.abs(this.y-n)<this.w+e},r.prototype.query=function(t,n,e){var r=[],o=[],a=this.points;if(!this.intersect(t,n,e))return r;for(var s=0,u=a.length;u>s;s++)i(a[s],t,n,e)&&r.push(a[s]);if(null===this.nw)return r;o=this.nw.query(t,n,e);for(var s=0,u=o.length;u>s;s++)r.push(o[s]);o=this.ne.query(t,n,e);for(var s=0,u=o.length;u>s;s++)r.push(o[s]);o=this.sw.query(t,n,e);for(var s=0,u=o.length;u>s;s++)r.push(o[s]);o=this.se.query(t,n,e);for(var s=0,u=o.length;u>s;s++)r.push(o[s]);return r};var i=function(t,n,e,r){return Math.abs(t.x-n)<r&&Math.abs(t.y-e)<r};n.exports=r},{}],14:[function(t,n,e){var r=t("./Geom"),i={extrude:function(t,n,e,r,i){var o=0,a=r,s=0;return void 0!==i&&(o=i[0]*r,a=i[1]*r,s=i[2]*r),{sym:t,points:[{x:n.x,y:n.y,z:n.z},{x:n.x+o,y:n.y+a,z:n.z+s},{x:e.x+o,y:e.y+a,z:e.z+s},{x:e.x,y:e.y,z:e.z}]}},extrudeAll:function(t,n,e,r){for(var o=[],a=0,s=t.length;s>a;++a){var u=t[a],h=t[(a+1)%s];o.push(i.extrude(e instanceof Array?e[a]:e,u,h,n,r))}return o},split:function(t,n,e,r){var o=[],a=0,s=r instanceof Array,u=t.points,h=t.uvs,l=u[0],c=u[1],p=u[2],x=u[3],f=l.x,v=(c.x,p.x,x.x),d=l.y,m=c.y,y=(p.y,x.y,l.z),g=(c.z,p.z,x.z),E=1,z=1,b=0,T=0;h instanceof Array&&(E=h[3].s-h[0].s,z=h[1].t-h[0].t,b=h[0].s,T=h[1].t);for(var M=0,A=0,R=e.length;R>A;++A){for(var w=0,F=M+e[A],_=0,I=n.length;I>_;++_){var S=w+n[_],P=i.lerp(f,v,w),D=i.lerp(f,v,S),N=i.lerp(d,m,M),L=i.lerp(d,m,F),B=i.lerp(y,g,w),U=i.lerp(y,g,S);o.push({sym:s?r[a++]:r,points:[{x:P,y:N,z:B},{x:P,y:L,z:B},{x:D,y:L,z:U},{x:D,y:N,z:U}],uvs:[{s:b+E*w,t:T+z*M},{s:b+E*w,t:T+z*F},{s:b+E*S,t:T+z*F},{s:b+E*S,t:T+z*M}]}),w=S}M=F}return o},splitXZ:function(t,n,e,r){for(var o=[],a=0,s=t.points,u=s[0],h=s[1],l=s[2],c=s[3],p=u.x,x=(h.x,l.x,c.x),f=u.y,v=h.y,d=(l.y,c.y,u.z),m=h.z,y=(l.z,c.z,0),g=0,E=e.length;E>g;++g){for(var z=0,b=0,T=n.length;T>b;++b){var M=i.lerp(p,x,z),A=i.lerp(p,x,z+n[b]),R=i.lerp(f,v,z),w=i.lerp(f,v,z+n[b]),F=i.lerp(d,m,y),_=i.lerp(d,m,y+e[g]);o.push({sym:r instanceof Array?r[a++]:r,points:[{x:M,y:R,z:F},{x:M,y:R,z:_},{x:A,y:w,z:_},{x:A,y:w,z:F}]}),z+=n[b]}y+=e[g]}return o},splitZX:function(t,n,e,r){for(var o=[],a=0,s=t.points,u=s[0],h=s[1],l=s[2],c=s[3],p=u.x,x=h.x,f=(l.x,c.x,u.y),v=h.y,d=(l.y,c.y,u.z),m=(h.z,l.z,c.z),y=0,g=0,E=e.length;E>g;++g){for(var z=0,b=0,T=n.length;T>b;++b){var M=i.lerp(p,x,z),A=i.lerp(p,x,z+n[b]),R=i.lerp(f,v,z),w=i.lerp(f,v,z+n[b]),F=i.lerp(d,m,y),_=i.lerp(d,m,y+e[g]);o.push({sym:r instanceof Array?r[a++]:r,points:[{x:M,y:R,z:F},{x:M,y:R,z:_},{x:A,y:w,z:_},{x:A,y:w,z:F}]}),z+=n[b]}y+=e[g]}return o},fit:function(t,n,e,r){r=r||1;var o=n.points,a=o[0],s=o[1],u=o[2],h=o[3],l=a.x,c=(s.x,u.x,h.x),p=a.y,x=s.y,f=(u.y,h.y,a.z),v=s.z,d=(u.z,h.z),m=c-l,y=x-p,g=d-f,E=v-f;if("x"===t){var z=y,b=r*z,T=Math.sqrt(m*m+g*g),M=Math.round(T/b),A=[];b=T/M,M=Math.max(1,Math.abs(M));for(var R=0;M>R;R++)A.push(1/M);return i.split(n,A,[1],e)}if("y"===t){var b=c-l,z=b/r,w=Math.sqrt(y*y+E*E),M=Math.round(w/z),A=[];z=w/M;for(var R=0;M>R;R++)A.push(1/M);return i.split(n,A,[1],e)}},bounds:function(t){var n,e,r,i,o=t.points;n=e=Number.POSITIVE_INFINITY,r=i=Number.NEGATIVE_INFINITY;for(var a=0,s=o.length;s>a;a++){var u=o[a];n=Math.min(u.x,n),e=Math.min(u.z,e),r=Math.max(u.x,r),i=Math.max(u.z,i)}return{width:r-n,depth:i-e}},inset:function(t,n){return r.insetPolygon(t.map(function(t){return{x:t.x,y:t.z}}),-n).map(function(n){return{x:n.x,y:t[0].y,z:n.y}})},lerp:function(t,n,e){return t*(1-e)+n*e}};n.exports=i},{"./Geom":10}],15:[function(t,n,e){var r=(t("./Geom"),t("./SHAPE.js"),t("./glMatrixSubset")),i=(t("earcut"),r.vec3,r.mat4,function(){this.rules=[]});i.prototype.define=function(t,n,e){this.rules.push({lhs:t,cond:n,rhs:e})},i.prototype.run=function(t){var n=[],e=this.rules,r=0;t=t instanceof Array?t:[t];for(var o=0,a=t.length;a>o;o++){var s=t[o];if(s.sym===i.TERMINAL)n.push(s);else for(var u=0,h=e.length;h>u;u++){var l=e[u];if(s.sym===l.lhs&&(null===l.cond||l.cond.call(s,t))){var c=l.rhs.call(s,t);c=c instanceof Array?c:[c];for(var p=0,x=c.length;x>p;p++)n.push(c[p]),++r;break}}}return r>0?this.run(n):n},i.TERMINAL="TERMINAL",n.exports=i},{"./Geom":10,"./SHAPE.js":14,"./glMatrixSubset":16,earcut:19}],16:[function(t,n,e){var r=Float32Array,i={};i.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.clone=function(t){var n=new r(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.transpose=function(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],o=n[6],a=n[7],s=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},i.invert=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],h=n[7],l=n[8],c=n[9],p=n[10],x=n[11],f=n[12],v=n[13],d=n[14],m=n[15],y=e*s-r*a,g=e*u-i*a,E=e*h-o*a,z=r*u-i*s,b=r*h-o*s,T=i*h-o*u,M=l*v-c*f,A=l*d-p*f,R=l*m-x*f,w=c*d-p*v,F=c*m-x*v,_=p*m-x*d,I=y*_-g*F+E*w+z*R-b*A+T*M;return I?(I=1/I,t[0]=(s*_-u*F+h*w)*I,t[1]=(i*F-r*_-o*w)*I,t[2]=(v*T-d*b+m*z)*I,t[3]=(p*b-c*T-x*z)*I,t[4]=(u*R-a*_-h*A)*I,t[5]=(e*_-i*R+o*A)*I,t[6]=(d*E-f*T-m*g)*I,t[7]=(l*T-p*E+x*g)*I,t[8]=(a*F-s*R+h*M)*I,t[9]=(r*R-e*F-o*M)*I,t[10]=(f*b-v*E+m*y)*I,t[11]=(c*E-l*b-x*y)*I,t[12]=(s*A-a*w-u*M)*I,t[13]=(e*w-r*A+i*M)*I,t[14]=(v*g-f*z-d*y)*I,t[15]=(l*z-c*g+p*y)*I,t):null},i.adjoint=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],h=n[7],l=n[8],c=n[9],p=n[10],x=n[11],f=n[12],v=n[13],d=n[14],m=n[15];return t[0]=s*(p*m-x*d)-c*(u*m-h*d)+v*(u*x-h*p),t[1]=-(r*(p*m-x*d)-c*(i*m-o*d)+v*(i*x-o*p)),t[2]=r*(u*m-h*d)-s*(i*m-o*d)+v*(i*h-o*u),t[3]=-(r*(u*x-h*p)-s*(i*x-o*p)+c*(i*h-o*u)),t[4]=-(a*(p*m-x*d)-l*(u*m-h*d)+f*(u*x-h*p)),t[5]=e*(p*m-x*d)-l*(i*m-o*d)+f*(i*x-o*p),t[6]=-(e*(u*m-h*d)-a*(i*m-o*d)+f*(i*h-o*u)),t[7]=e*(u*x-h*p)-a*(i*x-o*p)+l*(i*h-o*u),t[8]=a*(c*m-x*v)-l*(s*m-h*v)+f*(s*x-h*c),t[9]=-(e*(c*m-x*v)-l*(r*m-o*v)+f*(r*x-o*c)),t[10]=e*(s*m-h*v)-a*(r*m-o*v)+f*(r*h-o*s),t[11]=-(e*(s*x-h*c)-a*(r*x-o*c)+l*(r*h-o*s)),t[12]=-(a*(c*d-p*v)-l*(s*d-u*v)+f*(s*p-u*c)),t[13]=e*(c*d-p*v)-l*(r*d-i*v)+f*(r*p-i*c),t[14]=-(e*(s*d-u*v)-a*(r*d-i*v)+f*(r*u-i*s)),t[15]=e*(s*p-u*c)-a*(r*p-i*c)+l*(r*u-i*s),t},i.determinant=function(t){var n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8],l=t[9],c=t[10],p=t[11],x=t[12],f=t[13],v=t[14],d=t[15],m=n*a-e*o,y=n*s-r*o,g=n*u-i*o,E=e*s-r*a,z=e*u-i*a,b=r*u-i*s,T=h*f-l*x,M=h*v-c*x,A=h*d-p*x,R=l*v-c*f,w=l*d-p*f,F=c*d-p*v;return m*F-y*w+g*R+E*A-z*M+b*T},i.multiply=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],h=n[6],l=n[7],c=n[8],p=n[9],x=n[10],f=n[11],v=n[12],d=n[13],m=n[14],y=n[15],g=e[0],E=e[1],z=e[2],b=e[3];return t[0]=g*r+E*s+z*c+b*v,t[1]=g*i+E*u+z*p+b*d,t[2]=g*o+E*h+z*x+b*m,t[3]=g*a+E*l+z*f+b*y,g=e[4],E=e[5],z=e[6],b=e[7],t[4]=g*r+E*s+z*c+b*v,t[5]=g*i+E*u+z*p+b*d,t[6]=g*o+E*h+z*x+b*m,t[7]=g*a+E*l+z*f+b*y,g=e[8],E=e[9],z=e[10],b=e[11],t[8]=g*r+E*s+z*c+b*v,t[9]=g*i+E*u+z*p+b*d,t[10]=g*o+E*h+z*x+b*m,t[11]=g*a+E*l+z*f+b*y,g=e[12],E=e[13],z=e[14],b=e[15],t[12]=g*r+E*s+z*c+b*v,t[13]=g*i+E*u+z*p+b*d,t[14]=g*o+E*h+z*x+b*m,t[15]=g*a+E*l+z*f+b*y,t},i.mul=i.multiply,i.translate=function(t,n,e){var r,i,o,a,s,u,h,l,c,p,x,f,v=e[0],d=e[1],m=e[2];return n===t?(t[12]=n[0]*v+n[4]*d+n[8]*m+n[12],t[13]=n[1]*v+n[5]*d+n[9]*m+n[13],t[14]=n[2]*v+n[6]*d+n[10]*m+n[14],t[15]=n[3]*v+n[7]*d+n[11]*m+n[15]):(r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],h=n[6],l=n[7],c=n[8],p=n[9],x=n[10],f=n[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h,t[7]=l,t[8]=c,t[9]=p,t[10]=x,t[11]=f,t[12]=r*v+s*d+c*m+n[12],t[13]=i*v+u*d+p*m+n[13],t[14]=o*v+h*d+x*m+n[14],t[15]=a*v+l*d+f*m+n[15]),t},i.scale=function(t,n,e){var r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},i.rotate=function(t,n,e,r){var i,o,a,s,u,h,l,c,p,x,f,v,d,m,y,g,E,z,b,T,M,A,R,w,F=r[0],_=r[1],I=r[2],S=Math.sqrt(F*F+_*_+I*I);return Math.abs(S)<GLMAT_EPSILON?null:(S=1/S,F*=S,_*=S,I*=S,i=Math.sin(e),o=Math.cos(e),a=1-o,s=n[0],u=n[1],h=n[2],l=n[3],c=n[4],p=n[5],x=n[6],f=n[7],v=n[8],d=n[9],m=n[10],y=n[11],g=F*F*a+o,E=_*F*a+I*i,z=I*F*a-_*i,b=F*_*a-I*i,T=_*_*a+o,M=I*_*a+F*i,A=F*I*a+_*i,R=_*I*a-F*i,w=I*I*a+o,t[0]=s*g+c*E+v*z,t[1]=u*g+p*E+d*z,t[2]=h*g+x*E+m*z,t[3]=l*g+f*E+y*z,t[4]=s*b+c*T+v*M,t[5]=u*b+p*T+d*M,t[6]=h*b+x*T+m*M,t[7]=l*b+f*T+y*M,t[8]=s*A+c*R+v*w,t[9]=u*A+p*R+d*w,t[10]=h*A+x*R+m*w,t[11]=l*A+f*R+y*w,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},i.rotateX=function(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[4],a=n[5],s=n[6],u=n[7],h=n[8],l=n[9],c=n[10],p=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*i+h*r,t[5]=a*i+l*r,t[6]=s*i+c*r,t[7]=u*i+p*r,t[8]=h*i-o*r,t[9]=l*i-a*r,t[10]=c*i-s*r,t[11]=p*i-u*r,t},i.rotateY=function(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],s=n[2],u=n[3],h=n[8],l=n[9],c=n[10],p=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i-h*r,t[1]=a*i-l*r,t[2]=s*i-c*r,t[3]=u*i-p*r,t[8]=o*r+h*i,t[9]=a*r+l*i,t[10]=s*r+c*i,t[11]=u*r+p*i,t},i.rotateZ=function(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],s=n[2],u=n[3],h=n[4],l=n[5],c=n[6],p=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i+h*r,t[1]=a*i+l*r,t[2]=s*i+c*r,t[3]=u*i+p*r,t[4]=h*i-o*r,t[5]=l*i-a*r,t[6]=c*i-s*r,t[7]=p*i-u*r,t},i.fromRotationTranslation=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=r+r,u=i+i,h=o+o,l=r*s,c=r*u,p=r*h,x=i*u,f=i*h,v=o*h,d=a*s,m=a*u,y=a*h;return t[0]=1-(x+v),t[1]=c+y,t[2]=p-m,t[3]=0,t[4]=c-y,t[5]=1-(l+v),t[6]=f+d,t[7]=0,t[8]=p+m,t[9]=f-d,t[10]=1-(l+x),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},i.fromQuat=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,s=r+r,u=i+i,h=e*a,l=r*a,c=r*s,p=i*a,x=i*s,f=i*u,v=o*a,d=o*s,m=o*u;return t[0]=1-c-f,t[1]=l+m,t[2]=p-d,t[3]=0,t[4]=l-m,t[5]=1-h-f,t[6]=x+v,t[7]=0,t[8]=p+d,t[9]=x-v,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.frustum=function(t,n,e,r,i,o,a){var s=1/(e-n),u=1/(i-r),h=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(e+n)*s,t[9]=(i+r)*u,t[10]=(a+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*h,t[15]=0,t},i.perspective=function(t,n,e,r,i){var o=1/Math.tan(n/2),a=1/(r-i);return t[0]=o/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t},i.ortho=function(t,n,e,r,i,o,a){var s=1/(n-e),u=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(n+e)*s,t[13]=(i+r)*u,t[14]=(a+o)*h,t[15]=1,t},i.lookAt=function(t,n,e,r){var o,a,s,u,h,l,c,p,x,f,v=n[0],d=n[1],m=n[2],y=r[0],g=r[1],E=r[2],z=e[0],b=e[1],T=e[2];return Math.abs(v-z)<GLMAT_EPSILON&&Math.abs(d-b)<GLMAT_EPSILON&&Math.abs(m-T)<GLMAT_EPSILON?i.identity(t):(c=v-z,p=d-b,x=m-T,f=1/Math.sqrt(c*c+p*p+x*x),c*=f,p*=f,x*=f,o=g*x-E*p,a=E*c-y*x,s=y*p-g*c,f=Math.sqrt(o*o+a*a+s*s),f?(f=1/f,o*=f,a*=f,s*=f):(o=0,a=0,s=0),u=p*s-x*a,h=x*o-c*s,l=c*a-p*o,f=Math.sqrt(u*u+h*h+l*l),f?(f=1/f,u*=f,h*=f,l*=f):(u=0,h=0,l=0),t[0]=o,t[1]=u,t[2]=c,t[3]=0,t[4]=a,t[5]=h,t[6]=p,t[7]=0,t[8]=s,t[9]=l,t[10]=x,t[11]=0,t[12]=-(o*v+a*d+s*m),t[13]=-(u*v+h*d+l*m),t[14]=-(c*v+p*d+x*m),t[15]=1,t)},i.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof e&&(e.mat4=i);var o={};o.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var n=new r(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},o.fromValues=function(t,n,e){var i=new r(3);return i[0]=t,i[1]=n,i[2]=e,i},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},o.set=function(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t},o.add=function(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t},o.subtract=function(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t},o.sub=o.subtract,o.multiply=function(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t},o.mul=o.multiply,o.divide=function(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t},o.div=o.divide,o.min=function(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t},o.max=function(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t},o.scale=function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t},o.scaleAndAdd=function(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t},o.distance=function(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(e*e+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)},o.len=o.length,o.squaredLength=function(t){var n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},o.normalize=function(t,n){var e=n[0],r=n[1],i=n[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o),t},o.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},o.cross=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1],u=e[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},o.lerp=function(t,n,e,r){var i=n[0],o=n[1],a=n[2];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t[2]=a+r*(e[2]-a),t},o.random=function(t,n){n=n||1;var e=2*GLMAT_RANDOM()*Math.PI,r=2*GLMAT_RANDOM()-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t},o.transformMat4=function(t,n,e){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r+e[4]*i+e[8]*o+e[12],t[1]=e[1]*r+e[5]*i+e[9]*o+e[13],t[2]=e[2]*r+e[6]*i+e[10]*o+e[14],t},o.transformMat3=function(t,n,e){var r=n[0],i=n[1],o=n[2];return t[0]=r*e[0]+i*e[3]+o*e[6],t[1]=r*e[1]+i*e[4]+o*e[7],t[2]=r*e[2]+i*e[5]+o*e[8],t},o.transformQuat=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1],u=e[2],h=e[3],l=h*r+s*o-u*i,c=h*i+u*r-a*o,p=h*o+a*i-s*r,x=-a*r-s*i-u*o;return t[0]=l*h+x*-a+c*-u-p*-s,t[1]=c*h+x*-s+p*-a-l*-u,t[2]=p*h+x*-u+l*-s-c*-a,t},o.rotateX=function(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t},o.rotateY=function(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t},o.rotateZ=function(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t},o.forEach=function(){var t=o.create();return function(n,e,r,i,o,a){var s,u;for(e||(e=3),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;u>s;s+=e)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],o(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2];return n}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof e&&(e.vec3=o);var a={};a.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat4=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},a.clone=function(t){var n=new r(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},a.copy=function(t,n){return t[0]=n[0],
t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,n){if(t===n){var e=n[1],r=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},a.invert=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],h=n[7],l=n[8],c=l*a-s*h,p=-l*o+s*u,x=h*o-a*u,f=e*c+r*p+i*x;return f?(f=1/f,t[0]=c*f,t[1]=(-l*r+i*h)*f,t[2]=(s*r-i*a)*f,t[3]=p*f,t[4]=(l*e-i*u)*f,t[5]=(-s*e+i*o)*f,t[6]=x*f,t[7]=(-h*e+r*u)*f,t[8]=(a*e-r*o)*f,t):null},a.adjoint=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],h=n[7],l=n[8];return t[0]=a*l-s*h,t[1]=i*h-r*l,t[2]=r*s-i*a,t[3]=s*u-o*l,t[4]=e*l-i*u,t[5]=i*o-e*s,t[6]=o*h-a*u,t[7]=r*u-e*h,t[8]=e*a-r*o,t},a.determinant=function(t){var n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8];return n*(h*o-a*u)+e*(-h*i+a*s)+r*(u*i-o*s)},a.multiply=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],h=n[6],l=n[7],c=n[8],p=e[0],x=e[1],f=e[2],v=e[3],d=e[4],m=e[5],y=e[6],g=e[7],E=e[8];return t[0]=p*r+x*a+f*h,t[1]=p*i+x*s+f*l,t[2]=p*o+x*u+f*c,t[3]=v*r+d*a+m*h,t[4]=v*i+d*s+m*l,t[5]=v*o+d*u+m*c,t[6]=y*r+g*a+E*h,t[7]=y*i+g*s+E*l,t[8]=y*o+g*u+E*c,t},a.mul=a.multiply,a.translate=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],h=n[6],l=n[7],c=n[8],p=e[0],x=e[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=p*r+x*a+h,t[7]=p*i+x*s+l,t[8]=p*o+x*u+c,t},a.rotate=function(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],h=n[6],l=n[7],c=n[8],p=Math.sin(e),x=Math.cos(e);return t[0]=x*r+p*a,t[1]=x*i+p*s,t[2]=x*o+p*u,t[3]=x*a-p*r,t[4]=x*s-p*i,t[5]=x*u-p*o,t[6]=h,t[7]=l,t[8]=c,t},a.scale=function(t,n,e){var r=e[0],i=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},a.fromMat2d=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},a.fromQuat=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,s=r+r,u=i+i,h=e*a,l=r*a,c=r*s,p=i*a,x=i*s,f=i*u,v=o*a,d=o*s,m=o*u;return t[0]=1-c-f,t[3]=l-m,t[6]=p+d,t[1]=l+m,t[4]=1-h-f,t[7]=x-v,t[2]=p-d,t[5]=x+v,t[8]=1-h-c,t},a.normalFromMat4=function(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],h=n[7],l=n[8],c=n[9],p=n[10],x=n[11],f=n[12],v=n[13],d=n[14],m=n[15],y=e*s-r*a,g=e*u-i*a,E=e*h-o*a,z=r*u-i*s,b=r*h-o*s,T=i*h-o*u,M=l*v-c*f,A=l*d-p*f,R=l*m-x*f,w=c*d-p*v,F=c*m-x*v,_=p*m-x*d,I=y*_-g*F+E*w+z*R-b*A+T*M;return I?(I=1/I,t[0]=(s*_-u*F+h*w)*I,t[1]=(u*R-a*_-h*A)*I,t[2]=(a*F-s*R+h*M)*I,t[3]=(i*F-r*_-o*w)*I,t[4]=(e*_-i*R+o*A)*I,t[5]=(r*R-e*F-o*M)*I,t[6]=(v*T-d*b+m*z)*I,t[7]=(d*E-f*T-m*g)*I,t[8]=(f*b-v*E+m*y)*I,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof e&&(e.mat3=a),n.exports={mat4:i,mat3:a,vec3:o}},{}],17:[function(t,n,e){n.exports={hsl2rgb:function(t,n,e){var r,i,o,a,s,u;return isFinite(t)||(t=0),isFinite(n)||(n=0),isFinite(e)||(e=0),t/=60,0>t&&(t=6- -t%6),t%=6,n=Math.max(0,Math.min(1,n/100)),e=Math.max(0,Math.min(1,e/100)),s=(1-Math.abs(2*e-1))*n,u=s*(1-Math.abs(t%2-1)),1>t?(r=s,i=u,o=0):2>t?(r=u,i=s,o=0):3>t?(r=0,i=s,o=u):4>t?(r=0,i=u,o=s):5>t?(r=u,i=0,o=s):(r=s,i=0,o=u),a=e-s/2,r=Math.round(255*(r+a)),i=Math.round(255*(i+a)),o=Math.round(255*(o+a)),{r:r,g:i,b:o}}}},{}],18:[function(t,n,e){function r(){0===p&&requestAnimationFrame(r),h.render()}function i(t){isNaN(i.t0)&&(i.t0=t),c.begin(),u.render(mainScene),mainScene.update(t-i.t0),c.end(),window.STAHP!==!0&&requestAnimationFrame(i)}var o=(t("./lib/glMatrixSubset"),t("./Context")),a=o.canvas,s=o.gl,u=t("./Renderer.js"),h=t("./lib/Loader"),l=(t("./generators/City.js"),t("stats-js")),c=(t("./scenes/RoomScene.js"),new l);c.setMode(0),c.domElement.style.position="absolute",c.domElement.style.right="1rem",c.domElement.style.top="1rem",a.parentNode.appendChild(c.domElement);var p=0,x=0/0;h.subscribe("Blocks",function(){console.log("Loading complete"),p=1,x=0/0,i()}),s.viewport(0,0,o.w,o.h),r()},{"./Context":1,"./Renderer.js":2,"./generators/City.js":6,"./lib/Loader":11,"./lib/glMatrixSubset":16,"./scenes/RoomScene.js":22,"stats-js":21}],19:[function(t,n,e){"use strict";function r(t,n){var e=o(i(t[0],!0)),r=n?{vertices:[],indices:[]}:[];if(!e)return r;var s,u,h,l,p,x,f,v,d,m=80;for(d=0;m>=0&&d<t.length;d++)m-=t[d].length;if(0>m){s=e.next,u=l=s.p[0],h=p=s.p[1];do x=s.p[0],f=s.p[1],u>x&&(u=x),h>f&&(h=f),x>l&&(l=x),f>p&&(p=f),s=s.next;while(s!==e);v=Math.max(l-u,p-h)}return t.length>1&&(e=c(t,e)),a(e,r,u,h,v),r}function i(t,n){var e,r,i,o,a,s=0,u=t.length;for(e=0,r=u-1;u>e;r=e++)i=t[e],o=t[r],s+=(o[0]-i[0])*(i[1]+o[1]);if(n===s>0)for(e=0;u>e;e++)a=w(t[e],a);else for(e=u-1;e>=0;e--)a=w(t[e],a);return a}function o(t,n){n||(n=t);var e,r=t;do if(e=!1,E(r.p,r.next.p)||0===g(r.prev.p,r.p,r.next.p)){if(r.prev.next=r.next,r.next.prev=r.prev,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ),r=n=r.prev,r===r.next)return null;e=!0}else r=r.next;while(e||r!==n);return n}function a(t,n,e,r,i,c){if(t){var p=void 0!==n.vertices;c||void 0===e||f(t,e,r,i);for(var x,v,d=t;t.prev!==t.next;)if(x=t.prev,v=t.next,u(t,e,r,i))p?(s(n,x),s(n,t),s(n,v)):(n.push(x.p),n.push(t.p),n.push(v.p)),v.prev=x,x.next=v,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t=v.next,d=v.next;else if(t=v,t===d){c?1===c?(t=h(t,n),a(t,n,e,r,i,2)):2===c&&l(t,n,e,r,i):a(o(t),n,e,r,i,1);break}}}function s(t,n){n.source&&(n=n.source);var e=n.index;if(null===e){var r=n.p.length,i=t.vertices;n.index=e=i.length/r;for(var o=0;r>o;o++)i.push(n.p[o])}t.indices.push(e)}function u(t,n,e,r){var i=t.prev.p,o=t.p,a=t.next.p,s=i[0],u=o[0],h=a[0],l=i[1],c=o[1],p=a[1],x=s*c-l*u,f=s*p-l*h,v=h*c-p*u,m=x-f-v;if(0>=m)return!1;var y,g,E,z,b,T,M,A=p-l,R=s-h,w=l-c,F=u-s;if(void 0!==n){var _=u>s?h>s?s:h:h>u?u:h,I=c>l?p>l?l:p:p>c?c:p,S=s>u?s>h?s:h:u>h?u:h,P=l>c?l>p?l:p:c>p?c:p,D=d(_,I,n,e,r),N=d(S,P,n,e,r);for(M=t.nextZ;M&&M.z<=N;)if(y=M.p,M=M.nextZ,y!==i&&y!==a&&(g=y[0],E=y[1],z=A*g+R*E-f,z>=0&&(b=w*g+F*E+x,b>=0&&(T=m-z-b,T>=0&&(z&&b||z&&T||b&&T)))))return!1;for(M=t.prevZ;M&&M.z>=D;)if(y=M.p,M=M.prevZ,y!==i&&y!==a&&(g=y[0],E=y[1],z=A*g+R*E-f,z>=0&&(b=w*g+F*E+x,b>=0&&(T=m-z-b,T>=0&&(z&&b||z&&T||b&&T)))))return!1}else for(M=t.next.next;M!==t.prev;)if(y=M.p,M=M.next,g=y[0],E=y[1],z=A*g+R*E-f,z>=0&&(b=w*g+F*E+x,b>=0&&(T=m-z-b,T>=0&&(z&&b||z&&T||b&&T))))return!1;return!0}function h(t,n){var e=!!n.vertices,r=t;do{var i=r.prev,o=r.next.next;if(i.p!==o.p&&z(i.p,r.p,r.next.p,o.p)&&T(i,o)&&T(o,i)){e?(s(n,i),s(n,r),s(n,o)):(n.push(i.p),n.push(r.p),n.push(o.p)),i.next=o,o.prev=i;var a=r.prevZ,u=r.nextZ&&r.nextZ.nextZ;a&&(a.nextZ=u),u&&(u.prevZ=a),r=t=o}r=r.next}while(r!==t);return r}function l(t,n,e,r,i){var s=t;do{for(var u=s.next.next;u!==s.prev;){if(s.p!==u.p&&y(s,u)){var h=R(s,u);return s=o(s,s.next),h=o(h,h.next),a(s,n,e,r,i),void a(h,n,e,r,i)}u=u.next}s=s.next}while(s!==t)}function c(t,n){for(var e=t.length,r=[],a=1;e>a;a++){var s=o(i(t[a],!1));s&&r.push(m(s))}for(r.sort(A),a=0;a<r.length;a++)p(r[a],n),n=o(n,n.next);return n}function p(t,n){if(n=x(t,n)){var e=R(n,t);o(e,e.next)}}function x(t,n){var e,r,i,o=n,a=t.p,s=a[0],u=a[1],h=-(1/0);do{if(r=o.p,i=o.next.p,u<=r[1]&&u>=i[1]){var l=r[0]+(u-r[1])*(i[0]-r[0])/(i[1]-r[1]);s>=l&&l>h&&(h=l,e=r[0]<i[0]?o:o.next)}o=o.next}while(o!==n);if(!e)return null;var c,p,x,f,v,d,m=e.p[0],y=e.p[1],g=s*y-u*m,E=s*u-u*h,z=u-u,b=s-h,M=u-y,A=m-s,R=g-E-(h*y-u*m),w=0>=R?-1:1,F=e,_=1/0;for(o=e.next;o!==F;)c=o.p[0],p=o.p[1],x=s-c,x>=0&&c>=m&&(f=(z*c+b*p-E)*w,f>=0&&(v=(M*c+A*p+g)*w,v>=0&&R*w-f-v>=0&&(d=Math.abs(u-p)/x,_>d&&T(o,t)&&(e=o,_=d)))),o=o.next;return e}function f(t,n,e,r){var i=t;do null===i.z&&(i.z=d(i.p[0],i.p[1],n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,v(i)}function v(t){for(var n,e,r,i,o,a,s,u,h=1;;){for(e=t,t=null,o=null,a=0;e;){for(a++,r=e,s=0,n=0;h>n&&(s++,r=r.nextZ,r);n++);for(u=h;s>0||u>0&&r;)0===s?(i=r,r=r.nextZ,u--):0!==u&&r?e.z<=r.z?(i=e,e=e.nextZ,s--):(i=r,r=r.nextZ,u--):(i=e,e=e.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;e=r}if(o.nextZ=null,1>=a)return t;h*=2}}function d(t,n,e,r,i){return t=1e3*(t-e)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),n=1e3*(n-r)/i,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),t|n<<1}function m(t){var n=t,e=t;do n.p[0]<e.p[0]&&(e=n),n=n.next;while(n!==t);return e}function y(t,n){return!b(t,t.p,n.p)&&T(t,n)&&T(n,t)&&M(t,t.p,n.p)}function g(t,n,e){var r=(n[1]-t[1])*(e[0]-n[0])-(n[0]-t[0])*(e[1]-n[1]);return r>0?1:0>r?-1:0}function E(t,n){return t[0]===n[0]&&t[1]===n[1]}function z(t,n,e,r){return g(t,n,e)!==g(t,n,r)&&g(e,r,t)!==g(e,r,n)}function b(t,n,e){var r=t;do{var i=r.p,o=r.next.p;if(i!==n&&o!==n&&i!==e&&o!==e&&z(i,o,n,e))return!0;r=r.next}while(r!==t);return!1}function T(t,n){return-1===g(t.prev.p,t.p,t.next.p)?-1!==g(t.p,n.p,t.next.p)&&-1!==g(t.p,t.prev.p,n.p):-1===g(t.p,n.p,t.prev.p)||-1===g(t.p,t.next.p,n.p)}function M(t,n,e){var r=t,i=!1,o=(n[0]+e[0])/2,a=(n[1]+e[1])/2;do{var s=r.p,u=r.next.p;s[1]>a!=u[1]>a&&o<(u[0]-s[0])*(a-s[1])/(u[1]-s[1])+s[0]&&(i=!i),r=r.next}while(r!==t);return i}function A(t,n){return t.p[0]-n.p[0]}function R(t,n){var e=new F(t.p),r=new F(n.p),i=t.next,o=n.prev;return e.source=t,r.source=n,t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function w(t,n){var e=new F(t);return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function F(t){this.p=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.source=null,this.index=null}n.exports=r},{}],20:[function(t,n,e){!function(t,r){"use strict";"object"==typeof e?n.exports=r():"function"==typeof define&&define.amd?define(r):t.MersenneTwister=r()}(this,function(){"use strict";var t=4294967296,n=624,e=397,r=2147483648,i=2147483647,o=2567483615,a=function(t){"undefined"==typeof t&&(t=(new Date).getTime()),this.mt=new Array(n),this.mti=n+1,this.seed(t)};a.prototype.seed=function(t){var e;for(this.mt[0]=t>>>0,this.mti=1;this.mti<n;this.mti++)e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0},a.prototype.seedArray=function(t){var e,r=1,i=0,o=n>t.length?n:t.length;for(this.seed(19650218);o>0;o--)e=this.mt[r-1]^this.mt[r-1]>>>30,this.mt[r]=(this.mt[r]^(1664525*((4294901760&e)>>>16)<<16)+1664525*(65535&e))+t[i]+i,this.mt[r]>>>=0,r++,i++,r>=n&&(this.mt[0]=this.mt[n-1],r=1),i>=t.length&&(i=0);for(o=n-1;o;o--)e=this.mt[r-1]^this.mt[r-1]>>>30,this.mt[r]=(this.mt[r]^(1566083941*((4294901760&e)>>>16)<<16)+1566083941*(65535&e))-r,this.mt[r]>>>=0,r++,r>=n&&(this.mt[0]=this.mt[n-1],r=1);this.mt[0]=2147483648},a.prototype.int=function(){var t,a,s=new Array(0,o);if(this.mti>=n){for(this.mti===n+1&&this.seed(5489),a=0;n-e>a;a++)t=this.mt[a]&r|this.mt[a+1]&i,this.mt[a]=this.mt[a+e]^t>>>1^s[1&t];for(;n-1>a;a++)t=this.mt[a]&r|this.mt[a+1]&i,this.mt[a]=this.mt[a+(e-n)]^t>>>1^s[1&t];t=this.mt[n-1]&r|this.mt[0]&i,this.mt[n-1]=this.mt[e-1]^t>>>1^s[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},a.prototype.int31=function(){return this.int()>>>1},a.prototype.real=function(){return this.int()*(1/(t-1))},a.prototype.realx=function(){return(this.int()+.5)*(1/t)},a.prototype.rnd=function(){return this.int()*(1/t)},a.prototype.random=a.prototype.rnd,a.prototype.rndHiRes=function(){var t=this.int()>>>5,n=this.int()>>>6;return(67108864*t+n)*(1/9007199254740992)};var s=new a;return a.random=function(){return s.rnd()},a})},{}],21:[function(t,n,e){var r=function(){var t=Date.now(),n=t,e=0,r=1/0,i=0,o=0,a=1/0,s=0,u=0,h=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),y(++h%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps",c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(c);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",c.appendChild(p);var x=document.createElement("div");for(x.id="fpsGraph",x.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",c.appendChild(x);74>x.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",x.appendChild(f)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var d=document.createElement("div");d.id="msText",d.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="MS",v.appendChild(d);var m=document.createElement("div");for(m.id="msGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(m);74>m.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",m.appendChild(f);var y=function(t){switch(h=t){case 0:c.style.display="block",v.style.display="none";break;case 1:c.style.display="none",v.style.display="block"}};return{REVISION:12,domElement:l,setMode:y,begin:function(){t=Date.now()},end:function(){var h=Date.now();e=h-t,r=Math.min(r,e),i=Math.max(i,e),d.textContent=e+" MS ("+r+"-"+i+")";var l=Math.min(30,30-30*(e/200));return m.appendChild(m.firstChild).style.height=l+"px",u++,h>n+1e3&&(o=Math.round(1e3*u/(h-n)),a=Math.min(a,o),s=Math.max(s,o),p.textContent=o+" FPS ("+a+"-"+s+")",l=Math.min(30,30-30*(o/100)),x.appendChild(x.firstChild).style.height=l+"px",n=h,u=0),h},update:function(){t=this.end()}}};"object"==typeof n&&(n.exports=r)},{}],22:[function(t,n,e){var r,i,o,a=t("./../lib/glMatrixSubset"),s=t("./../Context"),u=t("./../lib/Mesh"),h=(t("./../lib/Geom"),t("./../lib/QuadTree"),t("./../lib/Loader"),a.vec3),l=a.mat4,c=(s.gl,t("../generators/RoomSHG.js")),p={meshes:[],lights:[],view:l.create(),model:l.create(),count:0},x=function(t){var n=t.vertices,e=t.normals,r=t.uvs,i=[],o=[{x:0,y:0,z:0}];return i=n.map(function(t,n){return.4}),{room:t,mesh:new u(n,e,r,i),lights:o}},f=function(t){var n,e=new Float32Array(t.lines),r=document.createElement("canvas"),i=r.getContext("webgl"),o=i.createProgram(),a=i.createShader(i.VERTEX_SHADER),s=i.createShader(i.FRAGMENT_SHADER),u="attribute vec2 point;\nvoid main() { gl_Position = vec4(-1. + 2. * point.xy, 0., 1.); }",h="precision highp float;\nvoid main() { gl_FragColor = vec4(1.); }",l=i.createBuffer(),c=i.createTexture(),p=i.createFramebuffer(),x=Math.round(10*t.width),f=Math.round(10*t.height),v=x,d=f,m=[];[1,2,4,8,16].forEach(function(t){v|=v>>t,d|=d>>t}),v++,d++,n=new Uint8Array(v*d*4),i.shaderSource(a,u),i.shaderSource(s,h),i.compileShader(a),i.compileShader(s),i.attachShader(o,a),i.attachShader(o,s),i.linkProgram(o),i.useProgram(o),i.bindTexture(i.TEXTURE_2D,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,v,d,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindFramebuffer(i.FRAMEBUFFER,p),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,c,0),i.bindBuffer(i.ARRAY_BUFFER,l),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),i.viewport(0,0,x,f),i.lineWidth(1),i.enableVertexAttribArray(i.getAttribLocation(o,"point")),i.vertexAttribPointer(i.getAttribLocation(o,"point"),2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,e.length/2),i.readPixels(0,0,v,d,i.RGBA,i.UNSIGNED_BYTE,n);for(var y=0,g=n.length;g>y;y+=4)m.push(n[y]);return{grid:m,w:v,h:d}},v=function(t,n,e){var r,i;return r=function(t,e){return e*n+t},i=function(i,o){var a=[];return o>0&&a.push({x:i,y:o-1}),e>o&&a.push({x:i,y:o+1}),i>0&&a.push({x:i-1,y:o}),n>i&&a.push({x:i+1,y:o}),o>0&&i>0&&a.push({x:i-1,y:o-1}),o>0&&n>i&&a.push({x:i+1,y:o-1}),e>o&&n>i&&a.push({x:i+1,y:o+1}),e>o&&i>0&&a.push({x:i-1,y:o+1}),a.reduce(function(n,e){return 0===t[r(e.x,e.y)]&&n.push(e),n},[])},function(t,n){var e,o,a=[t],s=[],u=[],h=0;for(s[r(t.x,t.y)]=null;a.length>0&&h++<1e4&&(e=a.shift(),e.x!==n.x||e.y!==n.y);)i(e.x,e.y).forEach(function(t){o=r(t.x,t.y),void 0===s[o]&&(a.push(t),s[o]=e)});for(e=s[r(n.x,n.y)];null!==e&&u.length<5e3;)u.unshift(e),e=s[r(e.x,e.y)];return u}};o=x(c.create([{x:-3,y:0,z:-5},{x:-3,y:0,z:5},{x:3,y:0,z:5},{x:3,y:0,z:-5}])),r=f(o.room),i=v(r.grid,r.w,r.h);for(var d=o.room.rooms.map(function(t){return{x:~~(t.x*o.room.width*10),y:~~(t.z*o.room.height*10)}}),m=[],y=0,g=d.length;g>y;y++)m=m.concat(i(d[y],d[(y+1)%g]));var E=o.room.bbox;m=m.map(function(t){return{x:E.minX+E.lenX*(t.x/(10*o.room.width)),y:E.minZ+E.lenZ*(t.y/(10*o.room.height))}}),p.meshes=[o.mesh],p.lights=o.lights.reduce(function(t,n){for(var e=0;6>e;e++)t.push(n.x,n.y,n.z);return t},[]),l.translate(p.view,p.view,[0,0,-8]),l.rotateX(p.view,p.view,Math.PI/2),p.update=function(t){var n=t%80/80,e=~~(t/80)%m.length,r=m[e],i=m[(e+1)%m.length],o=m[(e+2)%m.length],a=r.x*(1-n)+i.x*n,s=r.y*(1-n)+i.y*n,c=i.x*(1-n)+o.x*n,x=i.y*(1-n)+o.y*n,f=c-a,v=x-s,d=Math.atan2(-v,f)-Math.PI/2,y=(Math.cos(d),Math.sin(d),h.fromValues(-.0625,.25,.0625)),g=h.fromValues(0,.25,-.0625),E=h.fromValues(.0625,.25,.0625),z=l.create();l.translate(z,z,[a,0,s]),l.rotateY(z,z,d),h.transformMat4(y,y,z),h.transformMat4(g,g,z),h.transformMat4(E,E,z),p.meshes[1]=new u([y[0],y[1],y[2],g[0],g[1],g[2],E[0],E[1],E[2]],[0,1,0,0,1,0,0,1,0],[0,0,6,0,1,6,1,1,6],[0,1,0,0,1,0,0,1,0]),l.identity(p.view),l.rotateX(p.view,p.view,Math.PI/12),l.rotateY(p.view,p.view,-d),l.translate(p.view,p.view,[-a,-.5,-s])},n.exports=p},{"../generators/RoomSHG.js":9,"./../Context":1,"./../lib/Geom":10,"./../lib/Loader":11,"./../lib/Mesh":12,"./../lib/QuadTree":13,"./../lib/glMatrixSubset":16}]},{},[18]);
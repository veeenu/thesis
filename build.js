!function t(n,e,r){function o(a,s){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=e[a]={exports:{}};n[a][0].call(c.exports,function(t){var e=n[a][1][t];return o(e?e:t)},c,c.exports,t,n,e,r)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,n,e){var r=document.getElementById("thesis-canvas"),o=r.getContext("webgl"),i=r.getBoundingClientRect(),a=i.width,s=i.height;r.width=a,r.height=s,r.style.background="black",n.exports={canvas:r,gl:o,w:a,h:s,aspectRatio:a/s}},{}],2:[function(t,n,e){var r,o,i,a,s,u,l=(t("./lib/util.js"),t("./lib/glMatrixSubset")),c=(l.vec3,l.mat3),h=l.mat4,f=t("./Context"),p=f.gl,v=(t("./generators/BuildingSHG.js"),p.createProgram()),x=p.createProgram(),d=p.createShader(p.VERTEX_SHADER),m=p.createShader(p.FRAGMENT_SHADER),y=p.createShader(p.VERTEX_SHADER),g=p.createShader(p.FRAGMENT_SHADER);i="uniform mat4 projection, viewmodel;\nuniform mat3 normalM;\n\nattribute vec3 vertex, normal, uv, extra;\n\nvarying vec4 vPosition, clipPosition;\nvarying vec3 texUV, vNormal, vExtra;\n\nvoid main() {\n  \n  vec4 viewPos = viewmodel * vec4(vertex, 1.);\n  clipPosition = gl_Position = projection * viewPos;\n\n  vPosition = viewPos;\n  vNormal = normalize(normalM * normal);\n  vExtra = extra;\n  texUV = uv;\n\n}\n\n",s="#extension GL_OES_standard_derivatives : require\n//#extension GL_EXT_draw_buffers : require\n\nprecision highp float;\n\nvarying vec4 vPosition, clipPosition;\nvarying vec3 texUV, vNormal, vExtra;\n\n////////////////////////////////////////////////////////////////////////////////\n// https://github.com/ashima/webgl-noise/blob/master/src/noise2D.glsl         //\n////////////////////////////////////////////////////////////////////////////////\n\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\nfloat snoise(vec2 v) {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i);\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n		+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Procedural textures\n////////////////////////////////////////////////////////////////////////////////\n\nvec3 bumpMap(vec3 fvert, vec3 fnorm, float bump) {\n\n  vec3 bU = dFdx(bump) * cross(fnorm, normalize(dFdy(fvert))),\n       bV = dFdy(bump) * cross(normalize(dFdx(fvert)), fnorm),\n       bD = fnorm + (bU + bV) * .5;\n\n  return normalize(bD);\n}\n\nstruct TTextureInfo {\n  vec3 color;\n  vec3 normal;\n};\n\n#define textureBrickI(x, p, notp) ((floor(x)*(p))+max(fract(x)-(notp), 0.0))\nTTextureInfo textureBrick(vec3 fvert, vec3 fnorm, float fdepth, vec2 uv, vec3 brickColor) {\n\n  const float bW  = .125,\n              bH  = .0625,\n              mS  = 1. / 128.,\n              mWf = mS * .5 / bW,\n              mHf = mS * .5 / bH;\n  //const vec3 mortarColor = vec3(.9, .9, .9);\n  const vec3 mortarColor = vec3(.68, .68, .71);\n\n  float u = uv.s / bW,\n        v = uv.t / bH,\n        brU = floor(u),\n        brV = floor(v);\n\n  if(mod(v * .5, 1.) > .5)\n    u += .5;\n  brU = floor(u);\n\n  float noisev = 1. +\n                 //snoise(uv * 16.) * .0625 +\n                 snoise(uv * 64.) * .125;\n  float brickDamp = 1. + .125 * sin(1.57 * (brU + 1.)) * sin(2. * (brV + 1.));\n\n  vec2 uuv = vec2(u, v),\n       fw = 2. * vec2(fwidth(uuv.x), fwidth(uuv.y)),\n       mortarPct = vec2(mWf, mHf),\n       brickPct = vec2(1., 1.) - mortarPct,\n       ub = (textureBrickI(uuv + fw, brickPct, mortarPct) -\n             textureBrickI(uuv, brickPct, mortarPct)) / fw;\n\n  vec3 color = mix(mortarColor, brickColor * brickDamp, ub.x * ub.y);\n\n  float bump = noisev / fdepth + 4. * ((ub.x * ub.y) - dFdx(ub.x) * dFdy(ub.y));\n\n  return TTextureInfo(\n    color,\n    bumpMap(fvert, fnorm, bump)\n  );\n}\n\n/******************************************************************************\\\n * Window texture\n\\******************************************************************************/\n\nTTextureInfo textureWindow(vec3 fvert, vec3 fnorm, float fdepth, vec2 uv, vec3 windowColor) {\n\n  const vec2 patternPct   = vec2(1., 1.),\n             patternStart = vec2(0., 0.), //(1. - patternPct) * .25,\n             patternEnd   = patternStart + patternPct,\n             framePct     = vec2(1. / 32., 1. / 32.),\n             frameStart   = patternStart + framePct,\n             frameEnd     = patternEnd   - framePct;\n  //const vec3 windowColor  = vec3(.8, .94, .99),\n  const vec3 frameColor   = vec3(.5, .5, .5);\n\n  vec2 fk   = fwidth(uv) * 2.,\n       uuv  = mod(uv, .5 - 1. / 64.),\n       patF = (smoothstep(frameEnd, frameEnd + fk, uuv) - smoothstep(frameStart, frameStart + fk, uuv));\n  float noisep = 1. + \n                snoise(-uv * .5) * .25;\n  float noisev = 1. + \n                 snoise(uv * 16.) * .0625 +\n                 abs(snoise(uv * 512.)) * .0625;\n\n  return TTextureInfo(\n    mix(frameColor, windowColor * noisep, patF.x * patF.y),\n    bumpMap(fvert, fnorm, patF.x * patF.y)\n  );\n}\n\n/******************************************************************************\\\n * Road texture\n\\******************************************************************************/\n\nvec3 textureRoad(vec2 uuv) {\n  const float padding = 1. / 32.,\n              tapeW   = 1. / 32.,\n              tapeL0  = padding,\n              tapeL1  = padding + tapeW,\n              tapeR1  = 1. - tapeL0,\n              tapeR0  = 1. - tapeL1,\n              tapeC0  = .5 - tapeW * .5,\n              tapeC1  = .5 + tapeW * .5,\n              vertDiv = 4.;\n  const vec3 asphaltColor = vec3(.2, .2, .2),\n             stripColor = vec3(.8, .8, .8);\n\n  vec2 uv = uuv + vec2(0, .5), fk = fwidth(uv);\n  float csSpacing = mod(.25 + uv.t * vertDiv, 1.),\n        q = \n    (\n      smoothstep(tapeL0, tapeL0 + fk.x, uv.s) - \n      smoothstep(tapeL1, tapeL1 + fk.x, uv.s)\n    ) +\n    (\n      smoothstep(tapeR0, tapeR0 + fk.x, uv.s) - \n      smoothstep(tapeR1, tapeR1 + fk.x, uv.s)\n    ) +\n    (\n      smoothstep(tapeC0, tapeC0 + fk.x, uv.s) - \n      smoothstep(tapeC1, tapeC1 + fk.x, uv.s)\n    ) * \n    (\n      smoothstep(.5 - fk.y, .5 + fk.y, csSpacing) *\n      (1. - smoothstep(1. - 2. * fk.y, 1., csSpacing))\n    )\n    ;\n\n  float noiseA = 1. +\n                 abs(snoise(uv * 16.))  * .0625 +\n                 abs(snoise(uv * 32.))  * .0625 +\n                 abs(snoise(uv * 128.)) * .125,\n        noiseS = 1. + \n                 abs(snoise(uv * 128.)) * .125;\n\n  return mix(asphaltColor * noiseA, stripColor * noiseS, q);\n}\n\nvec3 textureAsphalt(vec2 uuv) {\n  const vec3 asphaltColor = vec3(.2, .2, .2);\n\n  vec2 uv = uuv + vec2(0, .5);\n  float noiseA = 1. +\n                 abs(snoise(uv * 16.))  * .0625 +\n                 abs(snoise(uv * 32.))  * .0625 +\n                 abs(snoise(uv * 128.)) * .125;\n  return asphaltColor * 1.5 * noiseA;\n}\n////////////////////////////////////////////////////////////////////////////////\n\nfloat packColor(vec3 v) {\n  const float u = 255. / 256.;\n\n  return fract(v.x * u) + floor(v.y * u * 255.) + floor(v.z * u * 255.) * 255.;\n}\n\nvec2 packNormal(in vec3 normal)\n{\n    const float SCALE = 1.7777;\n    float scalar1 = (normal.z + 1.0) * (SCALE * 2.0);\n    return normal.xy / scalar1 + 0.5;\n}\n\nvoid main() {\n\n  TTextureInfo ti; // = textureBrick(vPosition.xyz, vNormal.xyz, vNormal.w, texUV.st, vExtra.xyz);\n  vec3 color, normal;\n\n  float depth = clipPosition.z / clipPosition.w; //gl_FragCoord.z / gl_FragCoord.w;\n\n  normal = normalize(faceforward(vNormal, gl_FragCoord.xyz, vNormal));\n\n  if(texUV.z > 5.1) {\n    ti = textureBrick(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.xy, 1.), vExtra);\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 4.1) {\n    ti = textureWindow(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.yx, 1.), vec3(1., 1., .7));\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 3.1) {\n    ti = textureWindow(vPosition.xyz, vNormal, gl_FragCoord.z, mod(texUV.yx, 1.), vec3(.3, .3, .3));\n    color = ti.color;\n    normal = ti.normal;\n  }\n  else if(texUV.z > 2.1)\n    color = textureAsphalt(mod(texUV.yx, 1.));\n  else if(texUV.z > 1.1)\n    color = textureRoad(mod(texUV.xy, 1.));\n  else\n    color = textureAsphalt(mod(texUV.yx, 1.)); //textureWindow(uuv, fextra);\n\n  gl_FragColor = vec4(packNormal(normalize(normal)), packColor(clamp(color, 0., 1.)), depth);\n  //gl_FragData[0] = vec4(packNormal(normalize(normal)), packColor(clamp(color, 0., 1.)), depth);\n  //gl_FragData[1] = vec4(normalize(normal), depth);\n  //gl_FragData[2] = vec4(color, pack(clamp(color, 0., 1.)));\n}\n",a="uniform mat4 viewMatrix;\nuniform vec3 lightPos;\n\nattribute vec2 position;\n//attribute vec3 lightPosition;\nvarying vec2 sscoord, coord;\n\nvarying vec3 lPos;\n\nvoid main() {\n  gl_Position = vec4(position, 0., 1.);\n  coord = .5 + .5 * position;\n  sscoord = position;\n  lPos = vec3(0., 0., 0.); \n  //lPos = (viewMatrix * vec4(lightPos, 1.)).xyz;\n}\n",u="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\n/* #pragma glslify: fxaa = require(glsl-fxaa) */\n\n//uniform sampler2D target0, target1, target2, depthBuffer, randMap;\nuniform sampler2D target0, depthBuffer;\nuniform mat4 inverseProjection, viewMatrix;\nuniform vec3 lightPos;\n\nvarying vec2 sscoord, coord;\nvarying vec3 lPos;\n\n//uniform vec3 lightPos;\n\nfloat sample(vec3 p, vec3 n, vec2 uv) {\n  vec3 dstP = texture2D(target0, uv).xyz,\n       posV = dstP - p;\n\n  float intens = max(dot(normalize(posV), n) - .05, 0.),\n        dist = length(posV),\n        att  = 1. / (2. + (5. * dist));\n  return intens * att;\n}\n\nhighp float rand(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvec3 unpackColor(float d) {\n  vec3 ret;\n\n  ret.x = fract(d);\n  float zi = floor(d / 255.);\n  ret.z = fract(zi / 255.);\n  ret.y = fract( floor( d - ( zi * 255. ) ) / 255.);\n\n  return ret;\n}\n\nvec3 unpackNormal(in vec2 enc)\n{\n	const float SCALE = 1.7777;\n	vec2 nn = enc * (2.0 * SCALE) - SCALE;\n	float g = 2.0 / (dot(nn.xy, nn.xy) + 1.0);\n	vec3 normal;\n	normal.xy = g * nn.xy;\n	normal.z = g - 1.0;\n	return normal;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Main\n////////////////////////////////////////////////////////////////////////////////\n\n\nvoid main() {\n  /*vec3 lights[4];\n  lights[0] = vec3(6. - .025, .2, 6. - .025);\n  lights[1] = vec3(6. - .025, .2, 6. + .025);\n  lights[2] = vec3(6. + .025, .2, 6. + .025);\n  lights[3] = vec3(6. + .025, .2, 6. - .025);*/\n  /*vec4 t0 = fxaa(target0, coord, res),\n       t1 = fxaa(target1, coord, res),\n       t2 = fxaa(target2, coord, res);*/\n  /*vec2 fw = .5 * fwidth(coord),\n       nfw = vec2(fw.x, -fw.y),\n       c0 = coord - fw,\n       c1 = coord + fw,\n       c2 = coord - nfw,\n       c3 = coord + nfw;*/\n\n  vec4 t0 = texture2D(target0, coord);\n  /*vec4 t0 = texture2D(target0, coord),\n       t1 = texture2D(target1, coord),\n       t2 = texture2D(target2, coord);*/\n\n  vec3  vertex,\n        //normal = normalize(t1.xyz),\n        normal = normalize(unpackNormal(t0.xy)),\n        color  = unpackColor(t0.z);\n        //color  = t2.xyz;\n  float depth  = t0.w;\n\n  vec4 vertexFromDepth = inverseProjection * vec4(sscoord, depth, 1.);\n  vertex = vertexFromDepth.xyz / vertexFromDepth.w;\n\n  vec3 lightDir = lPos - vertex;\n  float lambert = max(dot(faceforward(-normal, lightDir, normal), normalize(lightDir)), 0.),\n        dist = length(lightDir),\n        att = min(1., 1. / (1. + 2.5 * dist + 5. * dist * dist));\n\n  /*float lambert = 0., att = 1.;\n  for(int i = 0; i < 4; i++) {\n    vec3 lightDir = (viewMatrix * vec4(lights[i], 1.)).xyz - vertex;\n    float llambert = max(dot(faceforward(-normal, lightDir, normal), normalize(lightDir)), 0.),\n          dist = length(lightDir),\n          latt = min(1., 1. / (1. + .5 * dist + 5. * dist * dist));\n    lambert += llambert * latt * .25;\n  }*/\n\n  //////////////////////////////////////////////////////////////////////////////\n  // SSAO\n  //////////////////////////////////////////////////////////////////////////////\n  vec2 kernel[4];\n  kernel[0] = vec2(0., 1.);\n  kernel[1] = vec2(1., 0.);\n  kernel[2] = vec2(0., -1.);\n  kernel[3] = vec2(-1., 0.);\n\n  const float sin45 = .707107, sRad = 80.;\n\n  float occlusion = 0., kRad = sRad * (1. - depth);\n\n  for(int i = 0; i < 4; ++i) {\n    vec2 k1 = reflect(kernel[i], .6 * vec2(rand(sin(coord)), rand(-coord)));\n    vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,\n                   k1.x * sin45 + k1.y * sin45);\n    occlusion += sample(vertex, normal, coord + k1 * kRad);\n    occlusion += sample(vertex, normal, coord + k1 * kRad * .75);\n    occlusion += sample(vertex, normal, coord + k1 * kRad * .5);\n    occlusion += sample(vertex, normal, coord + k1 * kRad * .25);\n  }\n  occlusion /= 16.;\n  occlusion = clamp(occlusion, 0., 1.);\n\n  color = clamp(color - occlusion, 0., 1.);\n  gl_FragColor = vec4(lambert * att * 2. * color, 1.);\n  //gl_FragColor = vec4(normal, 1.);\n  //gl_FragColor = vec4(color, 1.);\n}\n",p.clearColor(0,0,0,0),p.depthFunc(p.LESS),p.getExtension("OES_standard_derivatives"),p.getExtension("OES_texture_float"),o=p.getExtension("OES_texture_float_linear"),r=p.getExtension("WEBGL_depth_texture"),p.shaderSource(d,i),p.shaderSource(m,s),p.compileShader(d),p.compileShader(m),p.attachShader(v,d),p.attachShader(v,m),p.linkProgram(v),p.shaderSource(y,a),p.shaderSource(g,u),p.compileShader(y),p.compileShader(g),p.attachShader(x,y),p.attachShader(x,g),p.linkProgram(x),console.log("VP:",p.getShaderInfoLog(d),"FP:",p.getShaderInfoLog(m),"VL:",p.getShaderInfoLog(y),"FL:",p.getShaderInfoLog(g));var b=p.createTexture(),M=p.createTexture(),E=p.createFramebuffer();p.bindTexture(p.TEXTURE_2D,M),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,p.DEPTH_COMPONENT,f.w,f.h,0,p.DEPTH_COMPONENT,p.UNSIGNED_SHORT,null),p.bindTexture(p.TEXTURE_2D,b),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,null!==o?p.LINEAR:p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,null!==o?p.LINEAR:p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,f.w,f.h,0,p.RGBA,p.FLOAT,null),p.bindTexture(p.TEXTURE_2D,null),p.bindFramebuffer(p.FRAMEBUFFER,E),p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.TEXTURE_2D,M,0),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,b,0),p.bindFramebuffer(p.FRAMEBUFFER,null);for(var w=p.createBuffer(),T=(p.createBuffer(),[]),A=h.create(),z=h.create(),F=0;128>F;F++)T.push(1,-1,-1,-1,-1,1,1,-1,-1,1,1,1);p.bindBuffer(p.ARRAY_BUFFER,w),p.bufferData(p.ARRAY_BUFFER,new Float32Array([1,-1,-1,-1,-1,1,1,-1,-1,1,1,1]),p.STATIC_DRAW),p.bindBuffer(p.ARRAY_BUFFER,null),h.perspective(A,Math.PI/2,f.aspectRatio,.001,1e3),h.invert(z,A),["vertex","normal","uv","extra"].forEach(function(t){v[t]=p.getAttribLocation(v,t)}),["projection","viewmodel","normalM"].forEach(function(t){v[t]=p.getUniformLocation(v,t)}),["position","lightPosition"].forEach(function(t){x[t]=p.getAttribLocation(x,t)}),["target0","target1","target2","depthBuffer","inverseProjection","viewMatrix","lightPos"].forEach(function(t){x[t]=p.getUniformLocation(x,t)}),v.activate=function(t){p.useProgram(v),p.bindFramebuffer(p.FRAMEBUFFER,E),p.enable(p.DEPTH_TEST),p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);var n=h.create(),e=c.create();h.mul(n,t.view,t.model),c.normalFromMat4(e,n),p.uniformMatrix4fv(v.projection,!1,A),p.uniformMatrix4fv(v.viewmodel,!1,n),p.uniformMatrix3fv(v.normalM,!1,e),p.enableVertexAttribArray(v.vertex),p.enableVertexAttribArray(v.normal),p.enableVertexAttribArray(v.uv),p.enableVertexAttribArray(v.extra),t.meshes.forEach(function(t){p.bindBuffer(p.ARRAY_BUFFER,t.vBuf),p.vertexAttribPointer(v.vertex,3,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,t.nBuf),p.vertexAttribPointer(v.normal,3,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,t.uBuf),p.vertexAttribPointer(v.uv,3,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,t.eBuf),p.vertexAttribPointer(v.extra,3,p.FLOAT,!1,0,0),p.drawArrays(p.TRIANGLES,0,t.count)}),p.bindBuffer(p.ARRAY_BUFFER,null)};v.deactivate=function(){p.bindFramebuffer(p.FRAMEBUFFER,null),p.disableVertexAttribArray(v.vertex),p.disableVertexAttribArray(v.normal),p.disableVertexAttribArray(v.uv),p.disableVertexAttribArray(v.extra),p.disable(p.DEPTH_TEST)};x.activate=function(t){p.useProgram(x),p.enable(p.BLEND),p.blendFunc(p.ONE,p.ONE),p.clear(p.COLOR_BUFFER_BIT),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,b),p.uniform1i(x.target0,0),p.uniform1i(x.depthBuffer,3),p.uniformMatrix4fv(x.viewMatrix,!1,t.view),p.uniformMatrix4fv(x.inverseProjection,!1,z),p.bindBuffer(p.ARRAY_BUFFER,w),p.vertexAttribPointer(x.position,2,p.FLOAT,!1,0,0),p.enableVertexAttribArray(x.position),p.uniform3fv(x.lightPos,t.lightPos),p.drawArrays(p.TRIANGLES,0,6)},x.deactivate=function(){p.disableVertexAttribArray(x.position),p.disable(p.BLEND)},n.exports={render:function(t){v.activate(t),v.deactivate(),x.activate(t),x.deactivate()}}},{"./Context":1,"./generators/BuildingSHG.js":4,"./lib/glMatrixSubset":14,"./lib/util.js":15}],3:[function(t,n,e){var r=t("./PRNG"),o=t("./../lib/Geom"),i=(t("./../lib/ShapeGrammar"),function(t,n,e){return(1-e)*t+e*n}),a=function(t,n,e){var r,a,u,l,c,h,f,p,v,x,d,m,y,g=[],b=[],M=[],E=[];for(p=0,d=t.length;d>p;p++)for(r=(p+1)%d,a=(p+2)%d,u=(p-1+d)%d,l=o.lineIntersection(t[p],t[r],n[u],n[p]),c=o.lineIntersection(t[p],t[r],n[r],n[a]),h=l.x-c.x,f=l.y-c.y,y=Math.sqrt(h*h+f*f),ang=Math.atan2(f,h),x=~~(3*e.random()+2),b.push(x),M.push(ang),v=0;x>v;v++){var w=v/(x-1);px1=i(l.x,c.x,w),py1=i(l.y,c.y,w),px2=i(n[p].x,n[r].x,w),py2=i(n[p].y,n[r].y,w),g.push({x:i(l.x,c.x,w),y:i(l.y,c.y,w)},{x:i(n[p].x,n[r].x,w),y:i(n[p].y,n[r].y,w)})}for(g.push(g[0]),p=0,d=t.length;d>p;p++){for(m=[],v=0;v<b[p];v++)m.push(g.shift()),m.push(g.shift());m.push(t[(p+1)%d]),m.push(g[0]||t[0]);for(var T=0,x=m.length;x-2>T;T+=2)E.push(new s([m[T],m[(T+1)%x],m[(T+3)%x],m[(T+2)%x]],e.random()+.5,M[p]))}return E},s=function(t,n,e){this.poly=t,this.height=n,this.angle=e},u=function(t,n){var e=new r(n);this.poly=t,this.block=o.insetPolygon(this.poly,.05),this.lots=a(o.insetPolygon(this.block,.1),o.insetPolygon(this.block,.4),e);var i=t.reduce(function(t,n){return t.cx+=n.x,t.cy+=n.y,t.xm>n.x&&(t.xm=n.x),t.xM<n.x&&(t.xM=n.x),t.ym>n.y&&(t.ym=n.y),t.yM<n.y&&(t.yM=n.y),t},{xm:Number.POSITIVE_INFINITY,ym:Number.POSITIVE_INFINITY,xM:Number.NEGATIVE_INFINITY,yM:Number.NEGATIVE_INFINITY,cx:0,cy:0});this.x=i.cx/t.length,this.y=i.cy/t.length,this.w=Math.max(Math.abs(i.xM-i.xm),Math.abs(i.yM-i.ym))};n.exports=u},{"./../lib/Geom":8,"./../lib/ShapeGrammar":13,"./PRNG":6}],4:[function(t,n,e){var r=t("./../lib/ShapeGrammar"),o=t("../lib/SHAPE.js"),i=t("earcut"),a=t("./../lib/Geom"),s=t("./PRNG"),u=new r,l=new s(31337),c=new s(31338),h=new s(31339),f=new s(31337);u.define("Building",null,function(){for(var t=[],n=0,e=0,r=this.floorsLayout.length;r>e;e++){var o=this.floorsLayout[e],i={sym:o.type,height:o.height,params:o,points:this.points.map(function(t){return{x:t.x,y:t.y+n,z:t.z}})};"frontFacade"in this&&(i.frontFacade=this.frontFacade),n+=o.height,t.push(i)}return t}),u.define("FL_GndFloor",null,function(){2*Math.PI;return function(){var t=o.extrudeAll(this.points,this.height,"Facade",[0,1,0]),n=this.params.frontSide;switch(this.params.tiles){case"OneDoor":for(var e=0,r=Number.POSITIVE_INFINITY,i=0,a=t.length;a>i;i++)t[i].type="Windows";if("frontFacade"in this)e=this.frontFacade;else for(var i=0,a=t.length;a>i;i++){var s=t[i],u=s.points[0].x,l=s.points[0].z,c=s.points[3].x,h=s.points[3].z,f=Math.abs(Math.atan2(h-l,c-u)-n);r>f&&(r=f,e=i)}t[e].type="OneDoor"}return t}}()),u.define("FL_Floor",null,function(){for(var t=o.extrudeAll(this.points,this.height,"Facade",[0,1,0]),n=0,e=t.length;e>n;n++)t[n].type="Windows",t[n].windows=this.params.windows;return t}),u.define("FL_Ledge",null,function(){for(var t=[],n=this.height,e=0,r=this.points.length;r>e;e++){var i=this.points[e],a=this.points[(e+1)%r],s=Math.atan2(a.z-i.z,a.x-i.x),l=s-Math.PI/2,c=Math.cos(s)+Math.cos(l),h=Math.sin(s)+Math.sin(l);t.push({x:i.x-this.params.width*c,y:i.y,z:i.z-this.params.width*h})}var f=o.extrudeAll(t,this.height,"Quad",[0,1,0]);return f.forEach(function(t){var e=t.points[3].x-t.points[0].x,r=t.points[1].y-t.points[0].y,o=t.points[3].z-t.points[0].z,i=n/u.UVSCALE,a=i*Math.sqrt(e*e+o*o)/r;t.uvs=[{s:0,t:i},{s:0,t:0},{s:a,t:0},{s:a,t:i}],t.texID=6}),f.push({sym:"Poly",texID:6,points:t}),f.push({sym:"Poly",texID:6,points:t.map(function(t){return{x:t.x,y:t.y+n,z:t.z}})}),f}),u.define("FL_Rooftop",null,function(){for(var t=[],n=this.height,e=0,r=this.points.length;r>e;e++){var i=this.points[e],a=this.points[(e+1)%r],s=Math.atan2(a.z-i.z,a.x-i.x),l=s-Math.PI/2,c=Math.cos(s)+Math.cos(l),h=Math.sin(s)+Math.sin(l);t.push({x:i.x+this.params.width*c,y:i.y,z:i.z+this.params.width*h})}for(var f=o.extrudeAll(this.points,this.height,"Quad",[0,1,0]),p=o.extrudeAll(t,this.height,"Quad",[0,1,0]);f.length;)p.push(f.shift());p.forEach(function(t){var e=t.points[3].x-t.points[0].x,r=t.points[1].y-t.points[0].y,o=t.points[3].z-t.points[0].z,i=n/u.UVSCALE,a=i*Math.sqrt(e*e+o*o)/r;t.uvs=[{s:0,t:i},{s:0,t:0},{s:a,t:0},{s:a,t:i}],t.texID=6}),p.push({sym:"Poly",points:t,texID:3});for(var e=0,r=t.length;r>e;e++){var v=(e+1)%r,i=this.points[e],a=t[e],x=t[v],d=this.points[v],m={sym:"Poly",points:[i,a,x,i,x,d].map(function(t){return{x:t.x,y:t.y+n,z:t.z}}),texID:6};p.push(m)}return p}),u.define("Facade",function(){return"OneDoor"===this.type},function(){var t=this.points[3].x-this.points[0].x,n=this.points[1].y-this.points[0].y,e=this.points[3].z-this.points[0].z,r=n/u.UVSCALE,i=r*Math.sqrt(t*t+e*e)/n;this.uvs=[{s:0,t:r},{s:0,t:0},{s:i,t:0},{s:i,t:r}];var a=o.fit("x",this,"Window",1);a[~~(a.length/2)].sym="Door";for(var s=0,l=a.length;l>s;s++)a[s].normal=this.normal;return a}),u.define("Facade",null,function(){var t=this.points[3].x-this.points[0].x,n=this.points[1].y-this.points[0].y,e=this.points[3].z-this.points[0].z,r=n/u.UVSCALE,i=r*Math.sqrt(t*t+e*e)/n;this.uvs=[{s:0,t:r},{s:0,t:0},{s:i,t:0},{s:i,t:r}];for(var a=o.fit("x",this,"Window",1),s=0,l=a.length;l>s;s++)a[s].normal=this.normal;return a}),u.define("Window",null,function(){{var t=o.split(this,[.3,.4,.3],[1],"Quad"),n=o.split(t[1],[1],[.15,.7,.15],"Quad"),e=n[1];e.uvs}e.uvs=null,e.texID=l.random()>.3?4:5,t[0].texID=t[2].texID=n[0].texID=n[2].texID=6;var r=[t[0],t[2],n[0],n[2]],i=a.triToNormal([e.points[0].x,e.points[0].y,e.points[0].z,e.points[1].x,e.points[1].y,e.points[1].z,e.points[2].x,e.points[2].y,e.points[2].z]),s=o.extrudeAll(e.points,-.005,"Quad",i),u=i[0],c=i[1],h=i[2];u*=.005,c*=.005,h*=.005;for(var f=0,p=e.points.length;p>f;f++){var v=e.points[f];v.x-=u,v.y-=c,v.z-=h}for(var f=0,p=s.length;p>f;f++)s[f].texID=3,r.push(s[f]);return r.push(e),r}),u.define("Door",null,function(){{var t=o.split(this,[.15,.7,.15],[1],"Quad"),n=o.split(t[1],[1],[.7,.3],"Quad"),e=n[0];e.uvs}e.uvs=null,e.texID=l.random()>.3?4:5,t[0].texID=t[2].texID=n[1].texID=6;var r=[t[0],t[2],n[1]],i=a.triToNormal([e.points[0].x,e.points[0].y,e.points[0].z,e.points[1].x,e.points[1].y,e.points[1].z,e.points[2].x,e.points[2].y,e.points[2].z]),s=o.extrudeAll(e.points,-.005,"Quad",i),u=i[0],c=i[1],h=i[2];u*=.005,c*=.005,h*=.005;for(var f=0,p=e.points.length;p>f;f++){var v=e.points[f];v.x-=u,v.y-=c,v.z-=h}for(var f=0,p=s.length;p>f;f++)s[f].texID=3,r.push(s[f]);return r.push(e),r}),u.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var n,e,o,i,s,u,l,c,h,f,p,v,x=[],d=this.points;h=d[0],f=d[1],p=d[2],v=d[3],n=[h.x,h.y,h.z,f.x,f.y,f.z,p.x,p.y,p.z,h.x,h.y,h.z,p.x,p.y,p.z,v.x,v.y,v.z],o=this.normal||a.triToNormal(n);for(var m=0;6>m;m++)x.push(o[0],o[1],o[2]);return e=this.uvs||t,s=e[0],u=e[1],l=e[2],c=e[3],i=this.texID||0,e=[s.s,s.t,i,u.s,u.t,i,l.s,l.t,i,s.s,s.t,i,l.s,l.t,i,c.s,c.t,i],{sym:r.TERMINAL,vertices:n,normals:x,uvs:e}}}()),u.define("Poly",null,function(){var t,n,e,o,s,u,l,c=this.points.map(function(t){return[t.x,t.z]}),h=this.points[0].y,f=i([c]),p=f.reduce(function(t,n){return t.push(n[0],h,n[1]),t},[]),v=this.normal||a.triToNormal(p),x=[],d=[];t=n=Number.POSITIVE_INFINITY,e=o=Number.NEGATIVE_INFINITY;for(var m=0,y=this.points.length;y>m;m++)l=this.points[m],t>l.x&&(t=l.x),e<l.x&&(e=l.x),n>l.z&&(n=l.z),o<l.z&&(o=l.z);s=e-t,u=o-n;for(var m=0,y=p.length;y>m;m+=3){var g=p[m],b=p[m+2];d.push((g-t)/s,(b-n)/u,this.texID),x.push(v[0],v[1],v[2])}return{sym:r.TERMINAL,vertices:p,normals:x,uvs:d}});var p=[[.9,.65,.48],[.75,.73,.69],[.82,.67,.42],[.6,.39,.33]];u.UVSCALE=.1,n.exports={shg:u,create:function(t){var n=t.width/2,e=t.depth/2,r=t.x-n,o=t.x+n,i=t.y-e,a=t.y+e,s=Math.max(n/e,e/n),l=null,v=[];if(1.3>s&&c.random()<.3)for(var x=0;8>x;x++){var d=-t.angle-x*Math.PI/4;v.push({x:t.x+n*Math.cos(d),y:0,z:t.y+e*Math.sin(d)}),l=0}else s>1.5&&c.random()<.8?n>e?t.angle<.1?(v.push({x:r,y:0,z:i},{x:r,y:0,z:a},{x:r+2*n/3,y:0,z:a},{x:r+2*n/3,y:0,z:a-2*e/3},{x:o-2*n/3,y:0,z:a-2*e/3},{x:o-2*n/3,y:0,z:a},{x:o,y:0,z:a},{x:o,y:0,z:i}),l=3):(v.push({x:r,y:0,z:i},{x:r,y:0,z:a},{x:o,y:0,z:a},{x:o,y:0,z:i},{x:o-2*n/3,y:0,z:i},{x:o-2*n/3,y:0,z:i+2*e/3},{x:r+2*n/3,y:0,z:i+2*e/3},{x:r+2*n/3,y:0,z:i}),l=5):t.angle>0?(v.push({x:r,y:0,z:i},{x:r,y:0,z:i+2*e/3},{x:r+2*n/3,y:0,z:i+2*e/3},{x:r+2*n/3,y:0,z:a-2*e/3},{x:r,y:0,z:a-2*e/3},{x:r,y:0,z:a},{x:o,y:0,z:a},{x:o,y:0,z:i}),l=2):(v.push({x:r,y:0,z:i},{x:r,y:0,z:a},{x:o,y:0,z:a},{x:o,y:0,z:a-2*e/3},{x:o-2*n/3,y:0,z:a-2*e/3},{x:o-2*n/3,y:0,z:i+2*e/3},{x:o,y:0,z:i+2*e/3},{x:o,y:0,z:i}),l=4):(v.push({x:r,y:0,z:i},{x:r,y:0,z:a},{x:o,y:0,z:a},{x:o,y:0,z:i}),l=n>e?t.angle<.1?1:3:t.angle<0?2:0);var m=[],y=~~(2*h.random());switch(y){case 0:m.push({type:"FL_GndFloor",height:.1,tiles:"OneDoor",frontSide:t.angle},{type:"FL_Ledge",height:.025,width:.00625});for(var x=0,g=4+~~(10*f.random());g>x;x++)m.push({type:"FL_Floor",height:.1,windows:"Double"});m.push({type:"FL_Ledge",height:.025,width:.00625},{type:"FL_Floor",height:.15,windows:"Single"},{type:"FL_Rooftop",height:.025,width:.00625});break;case 1:m.push({type:"FL_GndFloor",height:.1,tiles:"OneDoor",frontSide:t.angle});for(var x=0,g=4+~~(10*f.random());g>x;x++)m.push({type:"FL_Floor",height:.1,windows:"Double"});m.push({type:"FL_Floor",height:.15,windows:"Single"},{type:"FL_Rooftop",height:.025,width:.00625})}var b={sym:"Building",floorsLayout:m,points:v};null!==l&&(b.frontFacade=l);var M=p[~~(f.random()*p.length)],E=u.run(b);return{geom:E,color:M}},getGeom:function(){return context}}},{"../lib/SHAPE.js":12,"./../lib/Geom":8,"./../lib/ShapeGrammar":13,"./PRNG":6,earcut:17}],5:[function(t,n,e){var r=new(t("./PRNG")),o=t("./../lib/Geom"),i=t("./Roads.js"),a=t("./Block.js"),s=(t("../lib/ShapeGrammar.js"),function(){var t=2*Math.PI;return function(n,e,r,i){var a,u,l,c=Math.atan2(-e.y+n.y,e.x-n.x),h={th:Number.POSITIVE_INFINITY,vertex:null};"traversed"in n||(n.traversed=[]),"traversed"in e||(e.traversed=[]),n.traversed.push(e);for(var f=0;f<e.conns.length;f++)u=e.conns[f],u===n||-1!==e.traversed.indexOf(u)||i&&u!==i[0]&&-1!==i.indexOf(u)||(a=Math.atan2(-u.y+e.y,u.x-e.x)-c,a>Math.PI?a-=t:a<-Math.PI&&(a+=t),a<h.th&&(h.th=a,h.vertex=e.conns[f]));return null===h.vertex?null:(i&&i.push(e),i&&h.vertex===i[0]?(l=o.isOverlapping(i,r))?null:(e.traversed.push(i[0]),i):(i=s(e,h.vertex,r,i||[n,e]),null===i&&e.traversed.splice(e.traversed.indexOf(h.vertex),1),i||null))}}()),u=function(t){r.seed(t);var n=[];this.roads=i(),this.blocks=[];for(var e=0;e<this.roads.length;e++)for(var u=0;u<this.roads[e].conns.length;u++){"traversed"in this.roads[e]||(this.roads[e].traversed=[]);var l=s(this.roads[e],this.roads[e].conns[u],this.roads);null===l||o.isPolyIn(l,n)||(n.push(l),this.blocks.push(new a(l,65536*r.random())))}this.roads.forEach(function(t){t.traversed=[]});var c=[];this.roads.forEach(function(t){t.conns.forEach(function(n){-1===n.traversed.indexOf(t)&&(c.push([t,n]),t.traversed.push(n),n.traversed.push(t))})}),this.roadQuads=c};n.exports=u},{"../lib/ShapeGrammar.js":13,"./../lib/Geom":8,"./Block.js":3,"./PRNG":6,"./Roads.js":7}],6:[function(t,n,e){var r=t("mersennetwister"),o=function(t){void 0!==t?this.seed(t):this.mt=new r};o.prototype.seed=function(t){this.mt=new r(t)},o.prototype.random=function(){return this.mt.random()},n.exports=o},{mersennetwister:18}],7:[function(t,n,e){var r=t("./PRNG"),o=8,i=0,a=2;n.exports=function(t){for(var n=[],e=new r(t),s=0;o>s;s++)for(var u=0;o>u;u++){var l=n[s*o+u]={x:a*u+i*e.random(),y:a*s+i*e.random(),conns:[]};u>0&&(l.conns.push(n[s*o+u-1]),n[s*o+u-1].conns.push(l)),s>0&&(l.conns.push(n[(s-1)*o+u]),n[(s-1)*o+u].conns.push(l))}return n}},{"./PRNG":6}],8:[function(t,n,e){var r=t("./glMatrixSubset"),o=(r.vec3,{pnpoly:function(t,n,e){var r,o,i,a,s=t.length,u=!1;for(r=0,o=s-1;s>r;o=r++)i=t[r],a=t[o],i.y>e!=a.y>e&&n<(a.x-i.x)*(e-i.y)/(a.y-i.y)+i.x&&(u=!u);return u},isOverlapping:function(t,n){for(var e=n.length-1;e--;)if(o.pnpoly(t,n[e].x,n[e].y)&&-1===t.indexOf(n[e]))return!0;return!1},isPolyIn:function(t,n){for(var e=n.length-1;e>0;e--)if(o.isEqualPoly(t,n[e]))return!0;return!1},isEqualPoly:function(t,n){if(t.length!==n.length)return!1;for(var e=t.length-1;e--;)if(-1===n.indexOf(t[e]))return!1;return!0},insetPolygon:function(t,n){var e,r,i,a=[];r=t[t.length-1];for(var s=0;s<t.length-1;s++)e=r,r=t[s],i=t[s+1],a.push(o.insetCorner(e,r,i,n));return a.push(o.insetCorner(r,i,t[0],n)),a},insetCorner:function(t,n,e,r){var i,a,s,u,l=n.x-t.x,c=t.y-n.y,h=e.x-n.x,f=n.y-e.y,p=Math.sqrt(l*l+c*c),v=Math.sqrt(h*h+f*f),x={x:n.x,y:n.y},d={x:n.x,y:n.y};return 0==p||0==v?null:(i=c/p*r,s=l/p*r,a=f/v*r,u=h/v*r,x.x+=i,x.y+=s,d.x+=a,d.y+=u,x.x===d.x&&x.y===d.y?x:o.lineIntersection({x:t.x+i,y:t.y+s},x,d,{x:e.x+a,y:e.y+u}))},lineIntersection:function(t,n,e,r){var o,i,a,s,u,l={x:t.x,y:t.y},c={x:n.x,y:n.y},h={x:e.x,y:e.y},f={x:r.x,y:r.y};return c.x-=l.x,h.x-=l.x,f.x-=l.x,c.y-=l.y,h.y-=l.y,f.y-=l.y,o=Math.sqrt(c.x*c.x+c.y*c.y),i=c.x/o,a=c.y/o,s=h.x*i+h.y*a,h.y=-h.x*a+h.y*i,h.x=s,s=f.x*i+f.y*a,f.y=-f.x*a+f.y*i,f.x=s,h.y==f.y?null:(u=f.x+(h.x-f.x)*f.y/(f.y-h.y),{x:l.x+u*i,y:l.y+u*a})},triToNormal:function(t){var n=t[0]-t[3],e=t[1]-t[4],r=t[2]-t[5],o=t[6]-t[3],i=t[7]-t[4],a=t[8]-t[5],s=e*a-r*i,u=n*a-r*o,l=n*i-e*o,c=1/Math.sqrt(s*s+u*u+l*l);return s*=c,u*=c,l*=c,[s,u,l]}});n.exports=o},{"./glMatrixSubset":14}],9:[function(t,n,e){var r=t("./../Context"),o={},a=document.createElement("ul");

a.style.position="absolute",a.style.top="7rem",a.style.left="1rem",a.style.color="#444",a.style.font='10px "Ubuntu Mono", monospace',a.style.lineHeight="1.5em",a.style.listStyleType="none",r.canvas.parentNode.appendChild(a),n.exports={progress:function(t,n){if(!(t in o)){var e=document.createElement("li");a.appendChild(e),o[t]={fns:[],li:e,value:0}}o[t].value=n,n>=1&&o[t].fns.forEach(function(t){t()})},subscribe:function(t,n){if(!(t in o)){var e=document.createElement("li");a.appendChild(e),o[t]={fns:[],li:e,value:0}}o[t].fns.push(n)},render:function(){for(i in o){for(var t=parseInt(100*o[i].value),n=""+t;n.length<4;)n="_"+n;n=n.replace(/_/g,"&nbsp;"),o[i].li.innerHTML="&nbsp;"+i+": "+n+"%&nbsp;\n";var e="linear-gradient(90deg, #0f0, #0f0 "+t+"%, #0b0 "+t+"%)";o[i].li.style.backgroundImage=e}}}},{"./../Context":1}],10:[function(t,n,e){var r=(t("./glMatrixSubset"),t("./../Context")),o=r.gl,i=function(t,n,e,r){this.vBuf=o.createBuffer(),this.nBuf=o.createBuffer(),this.uBuf=o.createBuffer(),this.eBuf=o.createBuffer(),this.count=t.length/3,o.bindBuffer(o.ARRAY_BUFFER,this.vBuf),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.nBuf),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.uBuf),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.eBuf),o.bufferData(o.ARRAY_BUFFER,new Float32Array(r),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null)};n.exports=i},{"./../Context":1,"./glMatrixSubset":14}],11:[function(t,n,e){var r=function(t,n,e,r){this.nw=this.sw=this.ne=this.se=null,this.x=t,this.y=n,this.w=e,this.limit=r,this.points=[]};r.prototype.contains=function(t){return Math.abs(t.x-this.x)<this.w&&Math.abs(t.y-this.y)<this.w},r.prototype.insert=function(t){return this.contains(t)?this.points.length<this.limit?(this.points.push(t),!0):(null===this.nw&&this.subdivide(),this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t)):!1},r.prototype.subdivide=function(){var t=this.x,n=this.y,e=this.w/2;this.nw=new r(t-e,n-e,e,this.limit),this.sw=new r(t-e,n+e,e,this.limit),this.ne=new r(t+e,n-e,e,this.limit),this.se=new r(t+e,n+e,e,this.limit)},r.prototype.intersect=function(t,n,e){return Math.abs(this.x-t)<this.w+e&&Math.abs(this.y-n)<this.w+e},r.prototype.query=function(t,n,e){var r=[],i=[],a=this.points;if(!this.intersect(t,n,e))return r;for(var s=0,u=a.length;u>s;s++)o(a[s],t,n,e)&&r.push(a[s]);if(null===this.nw)return r;i=this.nw.query(t,n,e);for(var s=0,u=i.length;u>s;s++)r.push(i[s]);i=this.ne.query(t,n,e);for(var s=0,u=i.length;u>s;s++)r.push(i[s]);i=this.sw.query(t,n,e);for(var s=0,u=i.length;u>s;s++)r.push(i[s]);i=this.se.query(t,n,e);for(var s=0,u=i.length;u>s;s++)r.push(i[s]);return r};var o=function(t,n,e,r){return Math.abs(t.x-n)<r&&Math.abs(t.y-e)<r};n.exports=r},{}],12:[function(t,n,e){var r={extrude:function(t,n,e,r,o){var i=0,a=r,s=0;return void 0!==o&&(i=o[0]*r,a=o[1]*r,s=o[2]*r),{sym:t,points:[{x:n.x,y:n.y,z:n.z},{x:n.x+i,y:n.y+a,z:n.z+s},{x:e.x+i,y:e.y+a,z:e.z+s},{x:e.x,y:e.y,z:e.z}]}},extrudeAll:function(t,n,e,o){for(var i=[],a=0,s=t.length;s>a;++a){var u=t[a],l=t[(a+1)%s];i.push(r.extrude(e instanceof Array?e[a]:e,u,l,n,o))}return i},split:function(t,n,e,o){var i=[],a=0,s=o instanceof Array,u=t.points,l=t.uvs,c=u[0],h=u[1],f=u[2],p=u[3],v=c.x,x=(h.x,f.x,p.x),d=c.y,m=h.y,y=(f.y,p.y,c.z),g=(h.z,f.z,p.z),b=1,M=1,E=0,w=0;l instanceof Array&&(b=l[3].s-l[0].s,M=l[1].t-l[0].t,E=l[0].s,w=l[1].t);for(var T=0,A=0,z=e.length;z>A;++A){for(var F=0,R=T+e[A],_=0,I=n.length;I>_;++_){var P=F+n[_],S=r.lerp(v,x,F),L=r.lerp(v,x,P),D=r.lerp(d,m,T),C=r.lerp(d,m,R),N=r.lerp(y,g,F),k=r.lerp(y,g,P);i.push({sym:s?o[a++]:o,points:[{x:S,y:D,z:N},{x:S,y:C,z:N},{x:L,y:C,z:k},{x:L,y:D,z:k}],uvs:[{s:E+b*F,t:w+M*T},{s:E+b*F,t:w+M*R},{s:E+b*P,t:w+M*R},{s:E+b*P,t:w+M*T}]}),F=P}T=R}return i},splitXZ:function(t,n,e,o){for(var i=[],a=0,s=t.points,u=s[0],l=s[1],c=s[2],h=s[3],f=u.x,p=(l.x,c.x,h.x),v=u.y,x=l.y,d=(c.y,h.y,u.z),m=l.z,y=(c.z,h.z,0),g=0,b=e.length;b>g;++g){for(var M=0,E=0,w=n.length;w>E;++E){var T=r.lerp(f,p,M),A=r.lerp(f,p,M+n[E]),z=r.lerp(v,x,M),F=r.lerp(v,x,M+n[E]),R=r.lerp(d,m,y),_=r.lerp(d,m,y+e[g]);i.push({sym:o instanceof Array?o[a++]:o,points:[{x:T,y:z,z:R},{x:T,y:z,z:_},{x:A,y:F,z:_},{x:A,y:F,z:R}]}),M+=n[E]}y+=e[g]}return i},splitZX:function(t,n,e,o){for(var i=[],a=0,s=t.points,u=s[0],l=s[1],c=s[2],h=s[3],f=u.x,p=l.x,v=(c.x,h.x,u.y),x=l.y,d=(c.y,h.y,u.z),m=(l.z,c.z,h.z),y=0,g=0,b=e.length;b>g;++g){for(var M=0,E=0,w=n.length;w>E;++E){var T=r.lerp(f,p,M),A=r.lerp(f,p,M+n[E]),z=r.lerp(v,x,M),F=r.lerp(v,x,M+n[E]),R=r.lerp(d,m,y),_=r.lerp(d,m,y+e[g]);i.push({sym:o instanceof Array?o[a++]:o,points:[{x:T,y:z,z:R},{x:T,y:z,z:_},{x:A,y:F,z:_},{x:A,y:F,z:R}]}),M+=n[E]}y+=e[g]}return i},fit:function(t,n,e,o){o=o||1;var i=n.points,a=i[0],s=i[1],u=i[2],l=i[3],c=a.x,h=(s.x,u.x,l.x),f=a.y,p=s.y,v=(u.y,l.y,a.z),x=s.z,d=(u.z,l.z),m=h-c,y=p-f,g=d-v,b=x-v;if("x"===t){var M=y,E=o*M,w=Math.sqrt(m*m+g*g),T=Math.round(w/E),A=[];E=w/T,T=Math.max(1,Math.abs(T));for(var z=0;T>z;z++)A.push(1/T);return r.split(n,A,[1],e)}if("y"===t){var E=h-c,M=E/o,F=Math.sqrt(y*y+b*b),T=Math.round(F/M),A=[];M=F/T;for(var z=0;T>z;z++)A.push(1/T);return r.split(n,A,[1],e)}},lerp:function(t,n,e){return t*(1-e)+n*e}};n.exports=r},{}],13:[function(t,n,e){var r=(t("./Geom"),t("./SHAPE.js"),t("./glMatrixSubset")),o=(t("earcut"),r.vec3,r.mat4,function(){this.rules=[]});o.prototype.define=function(t,n,e){this.rules.push({lhs:t,cond:n,rhs:e})},o.prototype.run=function(t){var n=[],e=this.rules,r=0;for(t=t instanceof Array?t:[t];t.length;){var i=t.shift();if(i.sym===o.TERMINAL)n.push(i);else for(var a=0,s=e.length;s>a;a++){var u=e[a];if(i.sym===u.lhs&&(null===u.cond||u.cond.call(i))){var l=u.rhs.call(i);l=l instanceof Array?l:[l];for(var c=0,h=l.length;h>c;c++)n.push(l[c]),++r;break}}}return r>0?this.run(n):n},o.TERMINAL="TERMINAL",n.exports=o},{"./Geom":8,"./SHAPE.js":12,"./glMatrixSubset":14,earcut:17}],14:[function(t,n,e){var r=Float32Array,o={};o.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.clone=function(t){var n=new r(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.transpose=function(t,n){if(t===n){var e=n[1],r=n[2],o=n[3],i=n[6],a=n[7],s=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=i,t[11]=n[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},o.invert=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=n[4],s=n[5],u=n[6],l=n[7],c=n[8],h=n[9],f=n[10],p=n[11],v=n[12],x=n[13],d=n[14],m=n[15],y=e*s-r*a,g=e*u-o*a,b=e*l-i*a,M=r*u-o*s,E=r*l-i*s,w=o*l-i*u,T=c*x-h*v,A=c*d-f*v,z=c*m-p*v,F=h*d-f*x,R=h*m-p*x,_=f*m-p*d,I=y*_-g*R+b*F+M*z-E*A+w*T;return I?(I=1/I,t[0]=(s*_-u*R+l*F)*I,t[1]=(o*R-r*_-i*F)*I,t[2]=(x*w-d*E+m*M)*I,t[3]=(f*E-h*w-p*M)*I,t[4]=(u*z-a*_-l*A)*I,t[5]=(e*_-o*z+i*A)*I,t[6]=(d*b-v*w-m*g)*I,t[7]=(c*w-f*b+p*g)*I,t[8]=(a*R-s*z+l*T)*I,t[9]=(r*z-e*R-i*T)*I,t[10]=(v*E-x*b+m*y)*I,t[11]=(h*b-c*E-p*y)*I,t[12]=(s*A-a*F-u*T)*I,t[13]=(e*F-r*A+o*T)*I,t[14]=(x*g-v*M-d*y)*I,t[15]=(c*M-h*g+f*y)*I,t):null},o.adjoint=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=n[4],s=n[5],u=n[6],l=n[7],c=n[8],h=n[9],f=n[10],p=n[11],v=n[12],x=n[13],d=n[14],m=n[15];return t[0]=s*(f*m-p*d)-h*(u*m-l*d)+x*(u*p-l*f),t[1]=-(r*(f*m-p*d)-h*(o*m-i*d)+x*(o*p-i*f)),t[2]=r*(u*m-l*d)-s*(o*m-i*d)+x*(o*l-i*u),t[3]=-(r*(u*p-l*f)-s*(o*p-i*f)+h*(o*l-i*u)),t[4]=-(a*(f*m-p*d)-c*(u*m-l*d)+v*(u*p-l*f)),t[5]=e*(f*m-p*d)-c*(o*m-i*d)+v*(o*p-i*f),t[6]=-(e*(u*m-l*d)-a*(o*m-i*d)+v*(o*l-i*u)),t[7]=e*(u*p-l*f)-a*(o*p-i*f)+c*(o*l-i*u),t[8]=a*(h*m-p*x)-c*(s*m-l*x)+v*(s*p-l*h),t[9]=-(e*(h*m-p*x)-c*(r*m-i*x)+v*(r*p-i*h)),t[10]=e*(s*m-l*x)-a*(r*m-i*x)+v*(r*l-i*s),t[11]=-(e*(s*p-l*h)-a*(r*p-i*h)+c*(r*l-i*s)),t[12]=-(a*(h*d-f*x)-c*(s*d-u*x)+v*(s*f-u*h)),t[13]=e*(h*d-f*x)-c*(r*d-o*x)+v*(r*f-o*h),t[14]=-(e*(s*d-u*x)-a*(r*d-o*x)+v*(r*u-o*s)),t[15]=e*(s*f-u*h)-a*(r*f-o*h)+c*(r*u-o*s),t},o.determinant=function(t){var n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],p=t[12],v=t[13],x=t[14],d=t[15],m=n*a-e*i,y=n*s-r*i,g=n*u-o*i,b=e*s-r*a,M=e*u-o*a,E=r*u-o*s,w=l*v-c*p,T=l*x-h*p,A=l*d-f*p,z=c*x-h*v,F=c*d-f*v,R=h*d-f*x;return m*R-y*F+g*z+b*A-M*T+E*w},o.multiply=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=n[9],p=n[10],v=n[11],x=n[12],d=n[13],m=n[14],y=n[15],g=e[0],b=e[1],M=e[2],E=e[3];return t[0]=g*r+b*s+M*h+E*x,t[1]=g*o+b*u+M*f+E*d,t[2]=g*i+b*l+M*p+E*m,t[3]=g*a+b*c+M*v+E*y,g=e[4],b=e[5],M=e[6],E=e[7],t[4]=g*r+b*s+M*h+E*x,t[5]=g*o+b*u+M*f+E*d,t[6]=g*i+b*l+M*p+E*m,t[7]=g*a+b*c+M*v+E*y,g=e[8],b=e[9],M=e[10],E=e[11],t[8]=g*r+b*s+M*h+E*x,t[9]=g*o+b*u+M*f+E*d,t[10]=g*i+b*l+M*p+E*m,t[11]=g*a+b*c+M*v+E*y,g=e[12],b=e[13],M=e[14],E=e[15],t[12]=g*r+b*s+M*h+E*x,t[13]=g*o+b*u+M*f+E*d,t[14]=g*i+b*l+M*p+E*m,t[15]=g*a+b*c+M*v+E*y,t},o.mul=o.multiply,o.translate=function(t,n,e){var r,o,i,a,s,u,l,c,h,f,p,v,x=e[0],d=e[1],m=e[2];return n===t?(t[12]=n[0]*x+n[4]*d+n[8]*m+n[12],t[13]=n[1]*x+n[5]*d+n[9]*m+n[13],t[14]=n[2]*x+n[6]*d+n[10]*m+n[14],t[15]=n[3]*x+n[7]*d+n[11]*m+n[15]):(r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=n[9],p=n[10],v=n[11],t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=v,t[12]=r*x+s*d+h*m+n[12],t[13]=o*x+u*d+f*m+n[13],t[14]=i*x+l*d+p*m+n[14],t[15]=a*x+c*d+v*m+n[15]),t},o.scale=function(t,n,e){var r=e[0],o=e[1],i=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=n[7]*o,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=n[11]*i,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},o.rotate=function(t,n,e,r){var o,i,a,s,u,l,c,h,f,p,v,x,d,m,y,g,b,M,E,w,T,A,z,F,R=r[0],_=r[1],I=r[2],P=Math.sqrt(R*R+_*_+I*I);return Math.abs(P)<GLMAT_EPSILON?null:(P=1/P,R*=P,_*=P,I*=P,o=Math.sin(e),i=Math.cos(e),a=1-i,s=n[0],u=n[1],l=n[2],c=n[3],h=n[4],f=n[5],p=n[6],v=n[7],x=n[8],d=n[9],m=n[10],y=n[11],g=R*R*a+i,b=_*R*a+I*o,M=I*R*a-_*o,E=R*_*a-I*o,w=_*_*a+i,T=I*_*a+R*o,A=R*I*a+_*o,z=_*I*a-R*o,F=I*I*a+i,t[0]=s*g+h*b+x*M,t[1]=u*g+f*b+d*M,t[2]=l*g+p*b+m*M,t[3]=c*g+v*b+y*M,t[4]=s*E+h*w+x*T,t[5]=u*E+f*w+d*T,t[6]=l*E+p*w+m*T,t[7]=c*E+v*w+y*T,t[8]=s*A+h*z+x*F,t[9]=u*A+f*z+d*F,t[10]=l*A+p*z+m*F,t[11]=c*A+v*z+y*F,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},o.rotateX=function(t,n,e){var r=Math.sin(e),o=Math.cos(e),i=n[4],a=n[5],s=n[6],u=n[7],l=n[8],c=n[9],h=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=i*o+l*r,t[5]=a*o+c*r,t[6]=s*o+h*r,t[7]=u*o+f*r,t[8]=l*o-i*r,t[9]=c*o-a*r,t[10]=h*o-s*r,t[11]=f*o-u*r,t},o.rotateY=function(t,n,e){var r=Math.sin(e),o=Math.cos(e),i=n[0],a=n[1],s=n[2],u=n[3],l=n[8],c=n[9],h=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=i*o-l*r,t[1]=a*o-c*r,t[2]=s*o-h*r,t[3]=u*o-f*r,t[8]=i*r+l*o,t[9]=a*r+c*o,t[10]=s*r+h*o,t[11]=u*r+f*o,t},o.rotateZ=function(t,n,e){var r=Math.sin(e),o=Math.cos(e),i=n[0],a=n[1],s=n[2],u=n[3],l=n[4],c=n[5],h=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=i*o+l*r,t[1]=a*o+c*r,t[2]=s*o+h*r,t[3]=u*o+f*r,t[4]=l*o-i*r,t[5]=c*o-a*r,t[6]=h*o-s*r,t[7]=f*o-u*r,t},o.fromRotationTranslation=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=n[3],s=r+r,u=o+o,l=i+i,c=r*s,h=r*u,f=r*l,p=o*u,v=o*l,x=i*l,d=a*s,m=a*u,y=a*l;return t[0]=1-(p+x),t[1]=h+y,t[2]=f-m,t[3]=0,t[4]=h-y,t[5]=1-(c+x),t[6]=v+d,t[7]=0,t[8]=f+m,t[9]=v-d,t[10]=1-(c+p),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},o.fromQuat=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=e+e,s=r+r,u=o+o,l=e*a,c=r*a,h=r*s,f=o*a,p=o*s,v=o*u,x=i*a,d=i*s,m=i*u;return t[0]=1-h-v,t[1]=c+m,t[2]=f-d,t[3]=0,t[4]=c-m,t[5]=1-l-v,t[6]=p+x,t[7]=0,t[8]=f+d,t[9]=p-x,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.frustum=function(t,n,e,r,o,i,a){var s=1/(e-n),u=1/(o-r),l=1/(i-a);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(e+n)*s,t[9]=(o+r)*u,t[10]=(a+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*l,t[15]=0,t},o.perspective=function(t,n,e,r,o){var i=1/Math.tan(n/2),a=1/(r-o);return t[0]=i/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*r*a,t[15]=0,t},o.ortho=function(t,n,e,r,o,i,a){var s=1/(n-e),u=1/(r-o),l=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(n+e)*s,t[13]=(o+r)*u,t[14]=(a+i)*l,t[15]=1,t},o.lookAt=function(t,n,e,r){var i,a,s,u,l,c,h,f,p,v,x=n[0],d=n[1],m=n[2],y=r[0],g=r[1],b=r[2],M=e[0],E=e[1],w=e[2];return Math.abs(x-M)<GLMAT_EPSILON&&Math.abs(d-E)<GLMAT_EPSILON&&Math.abs(m-w)<GLMAT_EPSILON?o.identity(t):(h=x-M,f=d-E,p=m-w,v=1/Math.sqrt(h*h+f*f+p*p),h*=v,f*=v,p*=v,i=g*p-b*f,a=b*h-y*p,s=y*f-g*h,v=Math.sqrt(i*i+a*a+s*s),v?(v=1/v,i*=v,a*=v,s*=v):(i=0,a=0,s=0),u=f*s-p*a,l=p*i-h*s,c=h*a-f*i,v=Math.sqrt(u*u+l*l+c*c),v?(v=1/v,u*=v,l*=v,c*=v):(u=0,l=0,c=0),t[0]=i,t[1]=u,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=p,t[11]=0,t[12]=-(i*x+a*d+s*m),t[13]=-(u*x+l*d+c*m),t[14]=-(h*x+f*d+p*m),t[15]=1,t)},o.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof e&&(e.mat4=o);var i={};i.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},i.clone=function(t){var n=new r(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},i.fromValues=function(t,n,e){var o=new r(3);return o[0]=t,o[1]=n,o[2]=e,o},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},i.set=function(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t},i.add=function(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t},i.subtract=function(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t},i.sub=i.subtract,i.multiply=function(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t},i.mul=i.multiply,i.divide=function(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t},i.div=i.divide,i.min=function(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t},i.max=function(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t},i.scale=function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t},i.scaleAndAdd=function(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t},i.distance=function(t,n){var e=n[0]-t[0],r=n[1]-t[1],o=n[2]-t[2];return Math.sqrt(e*e+r*r+o*o)},i.dist=i.distance,i.squaredDistance=function(t,n){var e=n[0]-t[0],r=n[1]-t[1],o=n[2]-t[2];return e*e+r*r+o*o},i.sqrDist=i.squaredDistance,i.length=function(t){var n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)},i.len=i.length,i.squaredLength=function(t){var n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r},i.sqrLen=i.squaredLength,i.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},i.normalize=function(t,n){var e=n[0],r=n[1],o=n[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i),t},i.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},i.cross=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=e[0],s=e[1],u=e[2];return t[0]=o*u-i*s,t[1]=i*a-r*u,t[2]=r*s-o*a,t},i.lerp=function(t,n,e,r){var o=n[0],i=n[1],a=n[2];return t[0]=o+r*(e[0]-o),t[1]=i+r*(e[1]-i),t[2]=a+r*(e[2]-a),t},i.random=function(t,n){n=n||1;var e=2*GLMAT_RANDOM()*Math.PI,r=2*GLMAT_RANDOM()-1,o=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*o,t[1]=Math.sin(e)*o,t[2]=r*n,t},i.transformMat4=function(t,n,e){var r=n[0],o=n[1],i=n[2];return t[0]=e[0]*r+e[4]*o+e[8]*i+e[12],t[1]=e[1]*r+e[5]*o+e[9]*i+e[13],t[2]=e[2]*r+e[6]*o+e[10]*i+e[14],t},i.transformMat3=function(t,n,e){var r=n[0],o=n[1],i=n[2];return t[0]=r*e[0]+o*e[3]+i*e[6],t[1]=r*e[1]+o*e[4]+i*e[7],t[2]=r*e[2]+o*e[5]+i*e[8],t},i.transformQuat=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=e[0],s=e[1],u=e[2],l=e[3],c=l*r+s*i-u*o,h=l*o+u*r-a*i,f=l*i+a*o-s*r,p=-a*r-s*o-u*i;return t[0]=c*l+p*-a+h*-u-f*-s,t[1]=h*l+p*-s+f*-a-c*-u,t[2]=f*l+p*-u+c*-s-h*-a,t},i.rotateX=function(t,n,e,r){var o=[],i=[];return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t},i.rotateY=function(t,n,e,r){var o=[],i=[];return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t},i.rotateZ=function(t,n,e,r){var o=[],i=[];return o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t},i.forEach=function(){var t=i.create();return function(n,e,r,o,i,a){var s,u;for(e||(e=3),r||(r=0),u=o?Math.min(o*e+r,n.length):n.length,s=r;u>s;s+=e)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],i(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2];return n}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof e&&(e.vec3=i);var a={};a.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat4=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},a.clone=function(t){var n=new r(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},a.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,n){if(t===n){var e=n[1],r=n[2],o=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=o}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},a.invert=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=n[4],s=n[5],u=n[6],l=n[7],c=n[8],h=c*a-s*l,f=-c*i+s*u,p=l*i-a*u,v=e*h+r*f+o*p;return v?(v=1/v,t[0]=h*v,t[1]=(-c*r+o*l)*v,t[2]=(s*r-o*a)*v,t[3]=f*v,t[4]=(c*e-o*u)*v,t[5]=(-s*e+o*i)*v,t[6]=p*v,t[7]=(-l*e+r*u)*v,t[8]=(a*e-r*i)*v,t):null},a.adjoint=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=n[4],s=n[5],u=n[6],l=n[7],c=n[8];return t[0]=a*c-s*l,t[1]=o*l-r*c,t[2]=r*s-o*a,t[3]=s*u-i*c,t[4]=e*c-o*u,t[5]=o*i-e*s,t[6]=i*l-a*u,t[7]=r*u-e*l,t[8]=e*a-r*i,t},a.determinant=function(t){var n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return n*(l*i-a*u)+e*(-l*o+a*s)+r*(u*o-i*s)},a.multiply=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=e[0],p=e[1],v=e[2],x=e[3],d=e[4],m=e[5],y=e[6],g=e[7],b=e[8];return t[0]=f*r+p*a+v*l,t[1]=f*o+p*s+v*c,t[2]=f*i+p*u+v*h,t[3]=x*r+d*a+m*l,t[4]=x*o+d*s+m*c,t[5]=x*i+d*u+m*h,t[6]=y*r+g*a+b*l,t[7]=y*o+g*s+b*c,t[8]=y*i+g*u+b*h,t},a.mul=a.multiply,a.translate=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=e[0],p=e[1];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+p*a+l,t[7]=f*o+p*s+c,t[8]=f*i+p*u+h,t},a.rotate=function(t,n,e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=Math.sin(e),p=Math.cos(e);return t[0]=p*r+f*a,t[1]=p*o+f*s,t[2]=p*i+f*u,t[3]=p*a-f*r,t[4]=p*s-f*o,t[5]=p*u-f*i,t[6]=l,t[7]=c,t[8]=h,t},a.scale=function(t,n,e){var r=e[0],o=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=o*n[3],t[4]=o*n[4],t[5]=o*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},a.fromMat2d=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},a.fromQuat=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=e+e,s=r+r,u=o+o,l=e*a,c=r*a,h=r*s,f=o*a,p=o*s,v=o*u,x=i*a,d=i*s,m=i*u;return t[0]=1-h-v,t[3]=c-m,t[6]=f+d,t[1]=c+m,t[4]=1-l-v,t[7]=p-x,t[2]=f-d,t[5]=p+x,t[8]=1-l-h,t},a.normalFromMat4=function(t,n){var e=n[0],r=n[1],o=n[2],i=n[3],a=n[4],s=n[5],u=n[6],l=n[7],c=n[8],h=n[9],f=n[10],p=n[11],v=n[12],x=n[13],d=n[14],m=n[15],y=e*s-r*a,g=e*u-o*a,b=e*l-i*a,M=r*u-o*s,E=r*l-i*s,w=o*l-i*u,T=c*x-h*v,A=c*d-f*v,z=c*m-p*v,F=h*d-f*x,R=h*m-p*x,_=f*m-p*d,I=y*_-g*R+b*F+M*z-E*A+w*T;return I?(I=1/I,t[0]=(s*_-u*R+l*F)*I,t[1]=(u*z-a*_-l*A)*I,t[2]=(a*R-s*z+l*T)*I,t[3]=(o*R-r*_-i*F)*I,t[4]=(e*_-o*z+i*A)*I,t[5]=(r*z-e*R-i*T)*I,t[6]=(x*w-d*E+m*M)*I,t[7]=(d*b-v*w-m*g)*I,t[8]=(v*E-x*b+m*y)*I,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof e&&(e.mat3=a),n.exports={mat4:o,mat3:a,vec3:i}},{}],15:[function(t,n,e){n.exports={hsl2rgb:function(t,n,e){var r,o,i,a,s,u;return isFinite(t)||(t=0),isFinite(n)||(n=0),isFinite(e)||(e=0),t/=60,0>t&&(t=6- -t%6),t%=6,n=Math.max(0,Math.min(1,n/100)),e=Math.max(0,Math.min(1,e/100)),s=(1-Math.abs(2*e-1))*n,u=s*(1-Math.abs(t%2-1)),1>t?(r=s,o=u,i=0):2>t?(r=u,o=s,i=0):3>t?(r=0,o=s,i=u):4>t?(r=0,o=u,i=s):5>t?(r=u,o=0,i=s):(r=s,o=0,i=u),a=e-s/2,r=Math.round(255*(r+a)),o=Math.round(255*(o+a)),i=Math.round(255*(i+a)),{r:r,g:o,b:i}}}},{}],16:[function(t,n,e){function r(){0===p&&requestAnimationFrame(r),l.render()}function o(t){isNaN(o.t0)&&(o.t0=t),f.begin(),u.render(h),h.update(t-o.t0),f.end(),requestAnimationFrame(o)}var i=(t("./lib/glMatrixSubset"),t("./Context")),a=i.canvas,s=i.gl,u=t("./Renderer.js"),l=t("./lib/Loader"),c=(t("./generators/City.js"),t("stats-js")),h=t("./scenes/MainScene.js"),f=new c;f.setMode(0),f.domElement.style.position="absolute",f.domElement.style.right="1rem",f.domElement.style.top="1rem",a.parentNode.appendChild(f.domElement);var p=0,v=0/0;l.subscribe("Blocks",function(){console.log("Loading complete"),p=1,v=0/0,o()}),s.viewport(0,0,i.w,i.h),r()},{"./Context":1,"./Renderer.js":2,"./generators/City.js":5,"./lib/Loader":9,"./lib/glMatrixSubset":14,"./scenes/MainScene.js":20,"stats-js":19}],17:[function(t,n,e){"use strict";function r(t,n){var e=i(o(t[0],!0)),r=n?{vertices:[],indices:[]}:[];if(!e)return r;var s,u,l,c,f,p,v,x,d,m=80;for(d=0;m>=0&&d<t.length;d++)m-=t[d].length;if(0>m){s=e.next,u=c=s.p[0],l=f=s.p[1];do p=s.p[0],v=s.p[1],u>p&&(u=p),l>v&&(l=v),p>c&&(c=p),v>f&&(f=v),s=s.next;while(s!==e);x=Math.max(c-u,f-l)}return t.length>1&&(e=h(t,e)),a(e,r,u,l,x),r}function o(t,n){var e,r,o,i,a,s=0,u=t.length;for(e=0,r=u-1;u>e;r=e++)o=t[e],i=t[r],s+=(i[0]-o[0])*(o[1]+i[1]);if(n===s>0)for(e=0;u>e;e++)a=F(t[e],a);else for(e=u-1;e>=0;e--)a=F(t[e],a);return a}function i(t,n){n||(n=t);var e,r=t;do if(e=!1,b(r.p,r.next.p)||0===g(r.prev.p,r.p,r.next.p)){if(r.prev.next=r.next,r.next.prev=r.prev,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ),r=n=r.prev,r===r.next)return null;e=!0}else r=r.next;while(e||r!==n);return n}function a(t,n,e,r,o,h){if(t){var f=void 0!==n.vertices;h||void 0===e||v(t,e,r,o);for(var p,x,d=t;t.prev!==t.next;)if(p=t.prev,x=t.next,u(t,e,r,o))f?(s(n,p),s(n,t),s(n,x)):(n.push(p.p),n.push(t.p),n.push(x.p)),x.prev=p,p.next=x,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t=x.next,d=x.next;else if(t=x,t===d){h?1===h?(t=l(t,n),a(t,n,e,r,o,2)):2===h&&c(t,n,e,r,o):a(i(t),n,e,r,o,1);break}}}function s(t,n){n.source&&(n=n.source);var e=n.index;if(null===e){var r=n.p.length,o=t.vertices;n.index=e=o.length/r;for(var i=0;r>i;i++)o.push(n.p[i])}t.indices.push(e)}function u(t,n,e,r){var o=t.prev.p,i=t.p,a=t.next.p,s=o[0],u=i[0],l=a[0],c=o[1],h=i[1],f=a[1],p=s*h-c*u,v=s*f-c*l,x=l*h-f*u,m=p-v-x;if(0>=m)return!1;var y,g,b,M,E,w,T,A=f-c,z=s-l,F=c-h,R=u-s;if(void 0!==n){var _=u>s?l>s?s:l:l>u?u:l,I=h>c?f>c?c:f:f>h?h:f,P=s>u?s>l?s:l:u>l?u:l,S=c>h?c>f?c:f:h>f?h:f,L=d(_,I,n,e,r),D=d(P,S,n,e,r);for(T=t.nextZ;T&&T.z<=D;)if(y=T.p,T=T.nextZ,y!==o&&y!==a&&(g=y[0],b=y[1],M=A*g+z*b-v,M>=0&&(E=F*g+R*b+p,E>=0&&(w=m-M-E,w>=0&&(M&&E||M&&w||E&&w)))))return!1;for(T=t.prevZ;T&&T.z>=L;)if(y=T.p,T=T.prevZ,y!==o&&y!==a&&(g=y[0],b=y[1],M=A*g+z*b-v,M>=0&&(E=F*g+R*b+p,E>=0&&(w=m-M-E,w>=0&&(M&&E||M&&w||E&&w)))))return!1}else for(T=t.next.next;T!==t.prev;)if(y=T.p,T=T.next,g=y[0],b=y[1],M=A*g+z*b-v,M>=0&&(E=F*g+R*b+p,E>=0&&(w=m-M-E,w>=0&&(M&&E||M&&w||E&&w))))return!1;return!0}function l(t,n){var e=!!n.vertices,r=t;do{var o=r.prev,i=r.next.next;if(o.p!==i.p&&M(o.p,r.p,r.next.p,i.p)&&w(o,i)&&w(i,o)){e?(s(n,o),s(n,r),s(n,i)):(n.push(o.p),n.push(r.p),n.push(i.p)),o.next=i,i.prev=o;var a=r.prevZ,u=r.nextZ&&r.nextZ.nextZ;a&&(a.nextZ=u),u&&(u.prevZ=a),r=t=i}r=r.next}while(r!==t);return r}function c(t,n,e,r,o){var s=t;do{for(var u=s.next.next;u!==s.prev;){if(s.p!==u.p&&y(s,u)){var l=z(s,u);return s=i(s,s.next),l=i(l,l.next),a(s,n,e,r,o),void a(l,n,e,r,o)}u=u.next}s=s.next}while(s!==t)}function h(t,n){for(var e=t.length,r=[],a=1;e>a;a++){var s=i(o(t[a],!1));s&&r.push(m(s))}for(r.sort(A),a=0;a<r.length;a++)f(r[a],n),n=i(n,n.next);return n}function f(t,n){if(n=p(t,n)){var e=z(n,t);i(e,e.next)}}function p(t,n){var e,r,o,i=n,a=t.p,s=a[0],u=a[1],l=-(1/0);do{if(r=i.p,o=i.next.p,u<=r[1]&&u>=o[1]){var c=r[0]+(u-r[1])*(o[0]-r[0])/(o[1]-r[1]);s>=c&&c>l&&(l=c,e=r[0]<o[0]?i:i.next)}i=i.next}while(i!==n);if(!e)return null;var h,f,p,v,x,d,m=e.p[0],y=e.p[1],g=s*y-u*m,b=s*u-u*l,M=u-u,E=s-l,T=u-y,A=m-s,z=g-b-(l*y-u*m),F=0>=z?-1:1,R=e,_=1/0;for(i=e.next;i!==R;)h=i.p[0],f=i.p[1],p=s-h,p>=0&&h>=m&&(v=(M*h+E*f-b)*F,v>=0&&(x=(T*h+A*f+g)*F,x>=0&&z*F-v-x>=0&&(d=Math.abs(u-f)/p,_>d&&w(i,t)&&(e=i,_=d)))),i=i.next;return e}function v(t,n,e,r){var o=t;do null===o.z&&(o.z=d(o.p[0],o.p[1],n,e,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,x(o)}function x(t){for(var n,e,r,o,i,a,s,u,l=1;;){for(e=t,t=null,i=null,a=0;e;){for(a++,r=e,s=0,n=0;l>n&&(s++,r=r.nextZ,r);n++);for(u=l;s>0||u>0&&r;)0===s?(o=r,r=r.nextZ,u--):0!==u&&r?e.z<=r.z?(o=e,e=e.nextZ,s--):(o=r,r=r.nextZ,u--):(o=e,e=e.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;e=r}if(i.nextZ=null,1>=a)return t;l*=2}}function d(t,n,e,r,o){return t=1e3*(t-e)/o,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),n=1e3*(n-r)/o,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),t|n<<1}function m(t){var n=t,e=t;do n.p[0]<e.p[0]&&(e=n),n=n.next;while(n!==t);return e}function y(t,n){return!E(t,t.p,n.p)&&w(t,n)&&w(n,t)&&T(t,t.p,n.p)}function g(t,n,e){var r=(n[1]-t[1])*(e[0]-n[0])-(n[0]-t[0])*(e[1]-n[1]);return r>0?1:0>r?-1:0}function b(t,n){return t[0]===n[0]&&t[1]===n[1]}function M(t,n,e,r){return g(t,n,e)!==g(t,n,r)&&g(e,r,t)!==g(e,r,n)}function E(t,n,e){var r=t;do{var o=r.p,i=r.next.p;if(o!==n&&i!==n&&o!==e&&i!==e&&M(o,i,n,e))return!0;r=r.next}while(r!==t);return!1}function w(t,n){return-1===g(t.prev.p,t.p,t.next.p)?-1!==g(t.p,n.p,t.next.p)&&-1!==g(t.p,t.prev.p,n.p):-1===g(t.p,n.p,t.prev.p)||-1===g(t.p,t.next.p,n.p)}function T(t,n,e){var r=t,o=!1,i=(n[0]+e[0])/2,a=(n[1]+e[1])/2;do{var s=r.p,u=r.next.p;s[1]>a!=u[1]>a&&i<(u[0]-s[0])*(a-s[1])/(u[1]-s[1])+s[0]&&(o=!o),r=r.next}while(r!==t);return o}function A(t,n){return t.p[0]-n.p[0]}function z(t,n){var e=new R(t.p),r=new R(n.p),o=t.next,i=n.prev;return e.source=t,r.source=n,t.next=n,n.prev=t,e.next=o,o.prev=e,r.next=e,e.prev=r,i.next=r,r.prev=i,r}function F(t,n){var e=new R(t);return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function R(t){this.p=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.source=null,this.index=null}n.exports=r},{}],18:[function(t,n,e){!function(t,r){"use strict";"object"==typeof e?n.exports=r():"function"==typeof define&&define.amd?define(r):t.MersenneTwister=r()}(this,function(){"use strict";var t=4294967296,n=624,e=397,r=2147483648,o=2147483647,i=2567483615,a=function(t){"undefined"==typeof t&&(t=(new Date).getTime()),this.mt=new Array(n),this.mti=n+1,this.seed(t)};a.prototype.seed=function(t){var e;for(this.mt[0]=t>>>0,this.mti=1;this.mti<n;this.mti++)e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0},a.prototype.seedArray=function(t){var e,r=1,o=0,i=n>t.length?n:t.length;for(this.seed(19650218);i>0;i--)e=this.mt[r-1]^this.mt[r-1]>>>30,this.mt[r]=(this.mt[r]^(1664525*((4294901760&e)>>>16)<<16)+1664525*(65535&e))+t[o]+o,this.mt[r]>>>=0,r++,o++,r>=n&&(this.mt[0]=this.mt[n-1],r=1),o>=t.length&&(o=0);for(i=n-1;i;i--)e=this.mt[r-1]^this.mt[r-1]>>>30,this.mt[r]=(this.mt[r]^(1566083941*((4294901760&e)>>>16)<<16)+1566083941*(65535&e))-r,this.mt[r]>>>=0,r++,r>=n&&(this.mt[0]=this.mt[n-1],r=1);this.mt[0]=2147483648},a.prototype.int=function(){var t,a,s=new Array(0,i);if(this.mti>=n){for(this.mti===n+1&&this.seed(5489),a=0;n-e>a;a++)t=this.mt[a]&r|this.mt[a+1]&o,this.mt[a]=this.mt[a+e]^t>>>1^s[1&t];for(;n-1>a;a++)t=this.mt[a]&r|this.mt[a+1]&o,this.mt[a]=this.mt[a+(e-n)]^t>>>1^s[1&t];t=this.mt[n-1]&r|this.mt[0]&o,this.mt[n-1]=this.mt[e-1]^t>>>1^s[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},a.prototype.int31=function(){return this.int()>>>1},a.prototype.real=function(){return this.int()*(1/(t-1))},a.prototype.realx=function(){return(this.int()+.5)*(1/t)},a.prototype.rnd=function(){return this.int()*(1/t)},a.prototype.random=a.prototype.rnd,a.prototype.rndHiRes=function(){var t=this.int()>>>5,n=this.int()>>>6;return(67108864*t+n)*(1/9007199254740992)};var s=new a;return a.random=function(){return s.rnd()},a})},{}],19:[function(t,n,e){var r=function(){var t=Date.now(),n=t,e=0,r=1/0,o=0,i=0,a=1/0,s=0,u=0,l=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(t){t.preventDefault(),y(++l%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var h=document.createElement("div");h.id="fps",h.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(h);var f=document.createElement("div");f.id="fpsText",f.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.innerHTML="FPS",h.appendChild(f);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",h.appendChild(p);74>p.children.length;){var v=document.createElement("span");v.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(v)}var x=document.createElement("div");x.id="ms",x.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(x);var d=document.createElement("div");d.id="msText",d.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="MS",x.appendChild(d);var m=document.createElement("div");for(m.id="msGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",x.appendChild(m);74>m.children.length;)v=document.createElement("span"),
v.style.cssText="width:1px;height:30px;float:left;background-color:#131",m.appendChild(v);var y=function(t){switch(l=t){case 0:h.style.display="block",x.style.display="none";break;case 1:h.style.display="none",x.style.display="block"}};return{REVISION:12,domElement:c,setMode:y,begin:function(){t=Date.now()},end:function(){var l=Date.now();e=l-t,r=Math.min(r,e),o=Math.max(o,e),d.textContent=e+" MS ("+r+"-"+o+")";var c=Math.min(30,30-30*(e/200));return m.appendChild(m.firstChild).style.height=c+"px",u++,l>n+1e3&&(i=Math.round(1e3*u/(l-n)),a=Math.min(a,i),s=Math.max(s,i),f.textContent=i+" FPS ("+a+"-"+s+")",c=Math.min(30,30-30*(i/100)),p.appendChild(p.firstChild).style.height=c+"px",n=l,u=0),l},update:function(){t=this.end()}}};"object"==typeof n&&(n.exports=r)},{}],20:[function(t,n,e){var r=t("./../lib/glMatrixSubset"),o=t("./../Context"),i=t("./../lib/Mesh"),a=(t("./../lib/Geom"),t("./../lib/QuadTree")),s=t("./../lib/Loader"),u=r.vec3,l=r.mat4,c=(o.gl,t("../generators/BuildingSHG.js")),h=t("../generators/City.js"),f=function(t,n){for(var e=[],r=[],o=[],a=[],s=[],u=0,l=t.lots.length;l>u;u++){var h,f,p,v,x,d,m,y,g;h=t.lots[u],f=h.height,p=h.angle,h=h.poly,v=x=0,d=y=Number.POSITIVE_INFINITY,m=g=Number.NEGATIVE_INFINITY;for(var b=0,M=h.length;M>b;b++){var E=h[b];v+=E.x,x+=E.y,d=Math.min(d,E.x),m=Math.max(m,E.x),y=Math.min(y,E.y),g=Math.max(g,E.y)}v/=h.length,x/=h.length;for(var w=c.create({x:v,y:x,width:.9*Math.abs(m-d),depth:.9*Math.abs(g-y),angle:p}),T=w.geom,A=w.color,z=0,F=T.length;F>z;z++){var R=T[z];if("LIGHT"===R.sym)s.push(R.lightPos);else for(var b=0,M=R.vertices.length;M>b;b++)e.push(R.vertices[b]),r.push(R.normals[b]),o.push(R.uvs[b]),a.push(A[b%3]);T[z]=null}}return{mesh:new i(e,r,o,a),lights:s,x:t.x,y:t.y,w:t.w}},p=new h(0),v={quadtree:null,quadtreeLights:null,fixedMeshes:[]},x=document.createElement("pre");x.style.background="white",x.style.color="black",x.style.position="absolute",x.style.right="1rem",x.style.top="7rem",o.canvas.parentElement.appendChild(x),function(){for(var t,n,e,r=[],o=[],u=[],l=[],c=[],h=0,x=p.blocks.length;p.blocks.length;)t=p.blocks.shift(),setTimeout(function(){var t=f(this);c.push(t),h++,s.progress("Blocks",h/x)}.bind(t),0);s.subscribe("Blocks",function(t,r){return function(){var o,i,s,u;o=i=Number.POSITIVE_INFINITY,s=u=Number.NEGATIVE_INFINITY,r.forEach(function(t){o=Math.min(o,t.x-t.w),s=Math.max(s,t.x+t.w),i=Math.min(i,t.y-t.w),u=Math.max(u,t.y+t.w)});var l=Math.abs(s-o)/2,c=Math.abs(u-i)/2;n=new a(l,c,Math.max(l,c),4),e=new a(l,c,Math.max(l,c),8),r.forEach(function(t){n.insert(t)}),t.quadtree=n,t.quadtreeLights=e,console.log(t.quadtreeLights.query(6,6,.25).length)}}(v,c)),r.push.apply(r,[-20,-.001,-20,-20,-.001,20,20,-.001,20,-20,-.001,-20,20,-.001,20,20,-.001,-20]),o.push.apply(o,[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]),u.push.apply(u,[0,0,3,0,40,3,40,40,3,0,0,3,40,40,3,40,0,3]),l.push.apply(l,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(var d=p.roadQuads.reduce(function(){var t,n;return t=[0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[0,0,2,0,1,2,1,1,2,0,0,2,1,1,2,1,0,2],function(e,r){for(var o=r[0],i=r[1],a=Math.atan2(i.y-o.y,i.x-o.x)+Math.PI/2,s=Math.abs(.09*Math.cos(a)),u=Math.abs(.09*Math.sin(a)),l={x:o.x+u,y:o.y+s},c={x:i.x-u,y:i.y-s},h=Math.sqrt(Math.pow(c.y-l.y,2)+Math.pow(c.x-l.x,2)),f=[l.x-s,0,l.y-u,c.x-s,0,c.y-u,c.x+s,0,c.y+u,l.x-s,0,l.y-u,c.x+s,0,c.y+u,l.x+s,0,l.y+u],p=n.map(function(t,n){switch(n%3){case 0:return t;case 1:return t*h;default:return t}return t}),v=0,x=f.length;x>v;v++)e.vertices.push(f[v]),e.normals.push(t[v]),e.uvs.push(p[v]),e.extra.push(0);return e}}(),{vertices:[],normals:[],uvs:[],extra:[]}),m=0,y=d.vertices.length;y>m;m++)r.push(d.vertices[m]),o.push(d.normals[m]),u.push(d.uvs[m]),l.push(d.extra[m]);v.fixedMeshes=[new i(r,o,u,l)]}();var d={meshes:[],lights:[],lightPos:u.create(),view:l.create(),model:l.create(),count:0};console.log(v);var m=0,y=function(t,n){return t.push(n),t},g=6,b=.05,M=6,E=0,w=0,T=0,A=0;d.update=function(t){g+=(Math.cos(w)*T-Math.sin(w)*A)*Math.cos(E),b+=Math.sin(E)*A,M+=(Math.sin(w)*T+Math.cos(w)*A)*Math.cos(E),x.textContent=[g,b,M].map(function(t){return t.toFixed(2)}).join(", ")+" "+(Math.PI/E).toFixed(2)+" "+(Math.PI/w).toFixed(2),u.set(d.lightPos,6,.05,6),l.identity(d.view),l.rotateX(d.view,d.view,E),l.rotateY(d.view,d.view,w),l.translate(d.view,d.view,[-g,-b,-M]),d.meshes=v.fixedMeshes.reduce(y,[]),d.meshes=v.quadtree.query(g,M,4).map(function(t){return t.mesh}).reduce(y,d.meshes),x.textContent=d.meshes.reduce(function(t,n){return t+n.count},0),d.lights=v.quadtreeLights.query(g,M,.5).map(function(t){return[t.l.x,t.l.y,t.l.z]}),m+=.001},document.body.addEventListener("keydown",function(t){switch(t.which){case 87:A=-.008;break;case 83:A=.008;break;case 65:T=-.008;break;case 68:T=.008}}),document.body.addEventListener("keyup",function(t){switch(t.which){case 87:A=0;break;case 83:A=0;break;case 65:T=0;break;case 68:T=0}}),o.canvas.addEventListener("mousedown",function(t){var n,e,r=t.clientX,i=t.clientY;n=function(t){var n=t.clientX-r,e=t.clientY-i;E+=.005*e,w+=.005*n,r=t.clientX,i=t.clientY,x.textContent=[g,b,M].map(function(t){return t.toFixed(2)}).join(", ")+" "+(Math.PI/E).toFixed(2)+" "+(Math.PI/w).toFixed(2)},e=function(t){o.canvas.removeEventListener("mousemove",n),o.canvas.removeEventListener("mouseup",e)},o.canvas.addEventListener("mousemove",n),o.canvas.addEventListener("mouseup",e)}),n.exports=d},{"../generators/BuildingSHG.js":4,"../generators/City.js":5,"./../Context":1,"./../lib/Geom":8,"./../lib/Loader":9,"./../lib/Mesh":10,"./../lib/QuadTree":11,"./../lib/glMatrixSubset":14}]},{},[16]);
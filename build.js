!function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){var r=e[a][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){(function(t){var r,n,i=document.getElementById("thesis-canvas"),o=i.getContext("webgl");"production"!==t.env.NODE_ENV?(bcr=i.getBoundingClientRect(),r=bcr.width,n=bcr.height):(r=innerWidth,n=innerHeight),i.width=r,i.height=n,i.style.background="black",e.exports={canvas:i,gl:o,w:r,h:n,aspectRatio:r/n}}).call(this,t("_process"))},{_process:19}],2:[function(t,e,r){var n,i,o,a,s,u,h,l=t("./lib/glMatrixSubset"),c=l.mat3,p=l.mat4,f=t("./Context"),x=f.gl,v=x.createProgram(),d=x.createProgram(),m=x.createProgram(),y=x.createProgram(),g=x.createShader(x.VERTEX_SHADER),z=x.createShader(x.FRAGMENT_SHADER),E=x.createShader(x.VERTEX_SHADER),b=x.createShader(x.FRAGMENT_SHADER),T=x.createShader(x.VERTEX_SHADER),M=x.createShader(x.FRAGMENT_SHADER),w=x.createShader(x.VERTEX_SHADER),R=x.createShader(x.FRAGMENT_SHADER);n="uniform mat4 projection,viewmodel;uniform mat3 normalM;attribute vec3 vertex,normal,uv,extra;varying vec4 vPosition,clipPosition;varying vec3 texUV,vExtra;void main(){vec4 viewPos=viewmodel*vec4(vertex,1.);clipPosition=projection*viewPos;gl_Position=clipPosition;vPosition=viewPos;vExtra=extra;texUV=uv;}",o="\n#extension GL_OES_standard_derivatives : require\nprecision highp float;uniform sampler2D mainScene,roomScene;varying vec4 vPosition,clipPosition;varying vec3 texUV,vExtra;vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 permute(vec3 x){return mod289(((x*34.0)+1.0)*x);}float snoise(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}vec3 bumpMap(vec3 fvert,vec3 fnorm,float bump){vec3 ddx=normalize(dFdx(fvert)),ddy=normalize(dFdy(fvert)),bU=dFdx(bump)*cross(fnorm,ddy),bV=dFdy(bump)*cross(ddx,fnorm),bD=fnorm+(bU+bV);return normalize(bD);}struct TTextureInfo{vec3 color;vec3 normal;};\n#define textureBrickI(x, p, notp) ((floor(x)*(p))+max(fract(x)-(notp), 0.0))\nTTextureInfo textureBrick(vec3 fvert,vec3 fnorm,float fdepth,vec2 uv,vec3 brickColor){const float bW=.0625,bH=.03125,mS=1./256.,mWf=mS*.5/bW,mHf=mS*.5/bH;const vec3 mortarColor=vec3(.68,.68,.71);float u=uv.s/bW,v=uv.t/bH,brU=floor(u),brV=floor(v);if(mod(v*.5,1.)>.5) u+=.5;brU=floor(u);float noisev=1.+snoise(uv*256.)*.125;float brickDamp=1.+.125*sin(1.57*(brU+1.))*sin(2.*(brV+1.));vec2 uuv=vec2(u,v),nuv=fract(uuv),fw=2.*vec2(fwidth(uuv.x),fwidth(uuv.y)),mortarPct=vec2(mWf,mHf),brickPct=vec2(1.,1.)-mortarPct,ub=(textureBrickI(uuv+fw,brickPct,mortarPct)-textureBrickI(uuv,brickPct,mortarPct))/fw;vec3 color=mix(mortarColor,brickColor*brickDamp,ub.x*ub.y);vec2 ubSample,ubKernel=fwidth(ub),noiseKernel=fwidth(uv);float bump=0.,invd=1./11.;for(int x=-1;x<=1;x++){for(int y=-1;y<=1;y++){ubSample=ub+vec2(float(x),float(y))*ubKernel;bump+=.1111111*ubSample.x*ubSample.y;}}bump*=1.75;bump-=8.*(1.-smoothstep(0.,.00125,max(noiseKernel.x,noiseKernel.y)))*noisev;return TTextureInfo(color,bumpMap(fvert,fnorm,bump));}TTextureInfo textureWindow(vec3 fvert,vec3 fnorm,float fdepth,vec2 uv,vec3 windowColor){const vec2 patternPct=vec2(1.,1.),patternStart=vec2(0.,0.),patternEnd=patternStart+patternPct,framePct=vec2(1./32.,1./32.),frameStart=patternStart+framePct,frameEnd=patternEnd-framePct;const vec3 frameColor=vec3(.5,.5,.5);vec2 fk=fwidth(uv)*2.,uuv=mod(uv,.5-1./64.),patF=(smoothstep(frameEnd,frameEnd+fk,uuv)-smoothstep(frameStart,frameStart+fk,uuv));float noisep=1.+snoise(-uv*.5)*.25;float noisev=1.+snoise(uv*16.)*.0625+abs(snoise(uv*512.))*.0625;float bump=patF.x*patF.y;return TTextureInfo(mix(frameColor,windowColor*noisep,patF.x*patF.y),bumpMap(fvert,fnorm,bump));}vec3 textureRoad(vec2 uuv){const float padding=1./32.,tapeW=1./32.,tapeL0=padding,tapeL1=padding+tapeW,tapeR1=1.-tapeL0,tapeR0=1.-tapeL1,tapeC0=.5-tapeW*.5,tapeC1=.5+tapeW*.5,vertDiv=4.;const vec3 asphaltColor=vec3(.2,.2,.2),stripColor=vec3(.8,.8,.8);vec2 uv=uuv+vec2(0,.5),fk=fwidth(uv);float csSpacing=mod(.25+uv.t*vertDiv,1.),q=(smoothstep(tapeL0,tapeL0+fk.x,uv.s)-smoothstep(tapeL1,tapeL1+fk.x,uv.s))+(smoothstep(tapeR0,tapeR0+fk.x,uv.s)-smoothstep(tapeR1,tapeR1+fk.x,uv.s))+(smoothstep(tapeC0,tapeC0+fk.x,uv.s)-smoothstep(tapeC1,tapeC1+fk.x,uv.s))*(smoothstep(.5-fk.y,.5+fk.y,csSpacing)*(1.-smoothstep(1.-2.*fk.y,1.,csSpacing)));float noiseA=1.+abs(snoise(uv*16.))*.0625+abs(snoise(uv*32.))*.0625+abs(snoise(uv*128.))*.125,noiseS=1.+abs(snoise(uv*128.))*.125;return mix(asphaltColor*noiseA,stripColor*noiseS,q);}vec3 textureIntersection(vec2 uuv){const float padding=1./32.,tapeW=1./32.,s2=1.4142135623730951;const vec3 asphaltColor=vec3(.2,.2,.2),stripColor=vec3(.8,.8,.8);vec2 uv=uuv+vec2(0,.5),fk=fwidth(uv);float noiseA=1.+abs(snoise(uv*16.))*.0625+abs(snoise(uv*32.))*.0625+abs(snoise(uv*128.))*.125,noiseS=1.+abs(snoise(uv*128.))*.125;vec2 nuv=vec2(min(uuv.x,1.-uuv.x),min(uuv.y,1.-uuv.y));float l=length(nuv),f=min(fk.x,fk.y),q=(smoothstep(padding,padding+f,l)-smoothstep(padding+tapeW,padding+tapeW+f,l));return mix(asphaltColor*noiseA,stripColor*noiseS,q);}vec3 textureAsphalt(vec2 uuv){const vec3 asphaltColor=vec3(.2,.2,.2);vec2 uv=uuv+vec2(0,.5);float noiseA=1.+abs(snoise(uv*16.))*.0625+abs(snoise(uv*32.))*.0625+abs(snoise(uv*128.))*.125;return asphaltColor*2.5*noiseA;}vec3 textureWood(vec3 str){const vec3 color0=vec3(.64,.48,.11),color1=vec3(.49,.34,.08);float noise=.5*snoise(str.xz*.125)*snoise(str.xy*.125)+.25*(snoise(str.xz*.25)*snoise(str.xy*.25))+.125*(snoise(str.xz*.5)*snoise(str.xy*.5))+.0625*(snoise(str.xz)*snoise(str.xy));return mix(color0,color1,mod(length(str.xz)+noise,1.));}float packColor(vec3 v){const float u=255./256.;return fract(v.x*u)+floor(v.y*u*255.)+floor(v.z*u*255.)*255.;}vec2 packNormal(in vec3 normal){const float SCALE=1.7777;float scalar1=(normal.z+1.0)*(SCALE*2.0);return normal.xy/scalar1+0.5;}void main(){TTextureInfo ti;vec3 color,normal;float depth=clipPosition.z/clipPosition.w;normal=cross(dFdx(vPosition.xyz),dFdy(vPosition.xyz));if(texUV.z>31.1){color=texture2D(mainScene,texUV.xy).rgb;}else if(texUV.z>7.1){color=textureIntersection(mod(texUV.xy,1.));}else if(texUV.z>6.1){color=textureWood(8.*(vExtra-.5));}else if(texUV.z>5.1){ti=textureBrick(vPosition.xyz,normal,gl_FragCoord.z,mod(texUV.xy,1.),vExtra);color=ti.color;normal=ti.normal;}else if(texUV.z>4.1){ti=textureWindow(vPosition.xyz,normal,gl_FragCoord.z,mod(texUV.yx,1.),vec3(1.,1.,.7));color=ti.color;normal=ti.normal;}else if(texUV.z>3.1){ti=textureWindow(vPosition.xyz,normal,gl_FragCoord.z,mod(texUV.yx,1.),vec3(.3,.3,.3));color=ti.color;normal=ti.normal;}else if(texUV.z>2.1) color=textureAsphalt(mod(texUV.yx,1.));else if(texUV.z>1.1) color=textureRoad(mod(texUV.xy,1.));else color=textureAsphalt(mod(texUV.yx,1.));color=clamp(.2*color,0.,1.);gl_FragColor=vec4(packNormal(normalize(normal)),packColor(color),depth);}",i="uniform mat4 viewMatrix;attribute vec3 lightPos;attribute vec2 position;varying vec2 sscoord,coord;varying vec3 lPos;void main(){gl_Position=vec4(position,0.,1.);coord=.5+.5*position;sscoord=position;lPos=(viewMatrix*vec4(lightPos,1.)).xyz;}",a="\n#extension GL_OES_standard_derivatives : enable\nprecision highp float;uniform sampler2D target0;uniform mat4 inverseProjection,viewMatrix;uniform vec4 lightParameters;varying vec2 sscoord,coord;varying vec3 lPos;vec3 unpackColor(float d){vec3 ret;ret.x=fract(d);float zi=floor(d/255.);ret.z=fract(zi/255.);ret.y=fract(floor(d-(zi*255.))/255.);return ret;}vec3 unpackNormal(in vec2 enc){const float SCALE=1.7777;vec2 nn=enc*(2.0*SCALE)-SCALE;float g=2.0/(dot(nn.xy,nn.xy)+1.0);vec3 normal;normal.xy=g*nn.xy;normal.z=g-1.0;return normal;}void main(){vec4 t0=texture2D(target0,coord);float depth=t0.w;vec4 vertexFromDepth=inverseProjection*vec4(sscoord,depth,1.);vec3 vertex=vertexFromDepth.xyz/vertexFromDepth.w;vec3 lightDir=lPos-vertex;float dist=length(lightDir);vec3 normal=normalize(unpackNormal(t0.xy)),color=unpackColor(t0.z);normal=faceforward(normal,normal,vertex);float lambert=max(dot(normal,normalize(lightDir)),0.),specular=step(0.,lambert)*pow(dot(normal,normalize(lightDir-vertex)),64.),att=lightParameters.x*min(1.,1./(lightParameters.y+lightParameters.z*dist+lightParameters.w*dist*dist));gl_FragColor=vec4((lambert)*att*color,1.);}",vsrcSSAO="uniform mat4 viewMatrix;attribute vec2 position;varying vec2 coord;void main(){gl_Position=vec4(position,0.,1.);coord=.5+.5*position;}",s="\n#extension GL_OES_standard_derivatives : enable\nprecision highp float;uniform sampler2D target0,lightBuffer;varying vec2 coord;\n#define DL 2.399963229728653\n\n#define EULER 2.718281828459045\nvec2 vrand(const vec2 coord){vec2 noise;float nx=dot(coord,vec2(12.9898,78.233));float ny=dot(coord,vec2(12.9898,78.233)*2.0);noise=clamp(fract(43758.5453*sin(vec2(nx,ny))),0.0,1.0);return (noise*2.0-1.0)*.0003;}float readDepth(const vec2 coord){return (96.*.001)/(1000.001-texture2D(target0,coord).w*999.999);}float cmpDepth(const float d1,const float d2,inout int far){float ga=2.,diff=(d1-d2)*100.;if(diff<.4) ga=.3;else far=1;float dd=diff-.4,gauss=pow(EULER,-2.*dd*dd/(ga*ga));return gauss;}float calcAO(float depth,vec2 uv,float dw,float dh){float dd=5.-depth*5.;vec2 vv=vec2(dw,dh),coord1=uv+dd*vv,coord2=uv-dd*vv;int far=0;float tmp1=0.,tmp2=0.;tmp1=cmpDepth(depth,readDepth(coord1),far);if(far>0){tmp2=cmpDepth(readDepth(coord2),depth,far);tmp1+=(1.-tmp1)*tmp2;}return tmp1;}void main(){vec3 color=texture2D(lightBuffer,coord).rgb;float occlusion=0.,vdepth=readDepth(coord),tt=clamp(vdepth,.5,1.);vec2 noisev=vrand(coord);float w=(1./1280.)/tt+(noisev.x*(1.-noisev.x)),h=(1./800.)/tt+(noisev.y*(1.-noisev.y)),dz=1./16.,z=1.-dz*.5,l=0.;for(int i=0;i<16;i++){float r=sqrt(1.-z),pw=cos(l)*r,ph=sin(l)*r;occlusion+=calcAO(vdepth,coord,pw*w,ph*h);z-=dz;l+=DL;}occlusion*=dz;color=mix(color,vec3(0.),occlusion);gl_FragColor=vec4(color,1.);}",u="attribute vec2 position;varying vec2 coord;void main(){gl_Position=vec4(position,0.,1.);coord=.5+.5*position;}",h="\n#extension GL_OES_standard_derivatives : require\nprecision highp float;uniform sampler2D tex;uniform float fade;varying vec2 coord;void main(){vec3 color=texture2D(tex,coord).rgb;color=mix(vec3(0.),color,fade);gl_FragColor=vec4(color,1.);}",x.clearColor(0,0,0,0),x.depthFunc(x.LESS),x.blendFunc(x.ONE,x.ONE);var A,I;A=x.getExtension("OES_standard_derivatives"),I=x.getExtension("OES_texture_float"),x.shaderSource(g,n),x.shaderSource(z,o),x.compileShader(g),x.compileShader(z),x.attachShader(v,g),x.attachShader(v,z),x.linkProgram(v),x.shaderSource(T,vsrcSSAO),x.shaderSource(M,s),x.compileShader(T),x.compileShader(M),x.attachShader(m,T),x.attachShader(m,M),x.linkProgram(m),x.shaderSource(E,i),x.shaderSource(b,a),x.compileShader(E),x.compileShader(b),x.attachShader(d,E),x.attachShader(d,b),x.linkProgram(d),x.shaderSource(w,u),x.shaderSource(R,h),x.compileShader(w),x.compileShader(R),x.attachShader(y,w),x.attachShader(y,R),x.linkProgram(y),console.log("VP:",x.getShaderInfoLog(g),"\nFP:",x.getShaderInfoLog(z),"\nLP:",x.getProgramInfoLog(v),"\nVL:",x.getShaderInfoLog(E),"\nFL:",x.getShaderInfoLog(b),"\nLL:",x.getProgramInfoLog(d),"\nVS:",x.getShaderInfoLog(T),"\nFS:",x.getShaderInfoLog(M),"\nLS:",x.getProgramInfoLog(m),"\nVT:",x.getShaderInfoLog(w),"\nFT:",x.getShaderInfoLog(R),"\nLT:",x.getProgramInfoLog(y),"\nExt:",null!==A?"OES_standard derivatives":"",null!==I?"OES_texture_float":"");var F=x.createTexture(),_=x.createTexture(),N=x.createRenderbuffer(),S=x.createFramebuffer(),P=x.createFramebuffer(),D=x.createFramebuffer();x.bindRenderbuffer(x.RENDERBUFFER,N),x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_COMPONENT16,f.w,f.h),x.bindTexture(x.TEXTURE_2D,F),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,f.w,f.h,0,x.RGBA,x.FLOAT,null),x.bindTexture(x.TEXTURE_2D,_),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,f.w,f.h,0,x.RGBA,x.UNSIGNED_BYTE,null),x.bindTexture(x.TEXTURE_2D,null),x.bindFramebuffer(x.FRAMEBUFFER,S),x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,N),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,F,0),x.bindFramebuffer(x.FRAMEBUFFER,P),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,_,0),x.bindFramebuffer(x.FRAMEBUFFER,null);for(var L=x.createBuffer(),C=x.createBuffer(),U=new Float32Array(9216),B=[],X=p.create(),k=p.create(),O=0;512>O;O++)B.push(1,-1,-1,-1,-1,1,1,-1,-1,1,1,1);x.bindBuffer(x.ARRAY_BUFFER,L),x.bufferData(x.ARRAY_BUFFER,new Float32Array(B),x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,C),x.bufferData(x.ARRAY_BUFFER,U,x.STREAM_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),p.perspective(X,Math.PI/2,f.aspectRatio,.001,1e3),p.invert(k,X),[v,d,m,y].forEach(function(t){for(var e=0,r=x.getProgramParameter(t,x.ACTIVE_ATTRIBUTES);r>e;e++){var n=x.getActiveAttrib(t,e).name;t[n]=x.getAttribLocation(t,n)}for(var e=0,r=x.getProgramParameter(t,x.ACTIVE_UNIFORMS);r>e;e++){var n=x.getActiveUniform(t,e).name;t[n]=x.getUniformLocation(t,n)}}),v.activate=function(t){x.useProgram(v),x.bindFramebuffer(x.FRAMEBUFFER,S),x.enable(x.DEPTH_TEST),x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT);var e=p.create(),r=c.create();p.mul(e,t.view,t.model),c.normalFromMat4(r,e),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,v.textures.mainScene),x.activeTexture(x.TEXTURE1),x.bindTexture(x.TEXTURE_2D,v.textures.roomScene),x.uniform1i(v.mainScene,0),x.uniform1i(v.roomScene,1),x.uniformMatrix4fv(v.projection,!1,X),x.uniformMatrix4fv(v.viewmodel,!1,e),x.uniformMatrix3fv(v.normalM,!1,r),x.enableVertexAttribArray(v.vertex),x.enableVertexAttribArray(v.normal),x.enableVertexAttribArray(v.uv),x.enableVertexAttribArray(v.extra),t.meshes.forEach(function(t){x.bindBuffer(x.ARRAY_BUFFER,t.vBuf),x.vertexAttribPointer(v.vertex,3,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,t.uBuf),x.vertexAttribPointer(v.uv,3,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,t.eBuf),x.vertexAttribPointer(v.extra,3,x.FLOAT,!1,0,0),x.drawArrays(x.TRIANGLES,0,t.count)})},v.deactivate=function(){x.bindFramebuffer(x.FRAMEBUFFER,null),x.disableVertexAttribArray(v.vertex),x.disableVertexAttribArray(v.normal),x.disableVertexAttribArray(v.uv),x.disableVertexAttribArray(v.extra),x.disable(x.DEPTH_TEST)},d.activate=function(t){x.useProgram(d),x.bindFramebuffer(x.FRAMEBUFFER,P),x.enable(x.BLEND),x.clear(x.COLOR_BUFFER_BIT),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,F),x.uniform1i(d.target0,0),x.uniform4fv(d.lightParameters,t.lightParameters),x.uniformMatrix4fv(d.viewMatrix,!1,t.view),x.uniformMatrix4fv(d.inverseProjection,!1,k),x.bindBuffer(x.ARRAY_BUFFER,L),x.vertexAttribPointer(d.position,2,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,C),x.vertexAttribPointer(d.lightPos,3,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,C);var e=Math.min(t.lights.length,U.length),r=U.subarray(0,e);r.set(t.lights),x.bufferSubData(x.ARRAY_BUFFER,0,r),x.enableVertexAttribArray(d.position),x.enableVertexAttribArray(d.lightPos),x.drawArrays(x.TRIANGLES,0,t.lights.length/3)},d.deactivate=function(){x.bindFramebuffer(x.FRAMEBUFFER,null),x.disableVertexAttribArray(d.position),x.disableVertexAttribArray(d.lightPos),x.disable(x.BLEND)},m.activate=function(t){x.useProgram(m),x.bindFramebuffer(x.FRAMEBUFFER,D),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,t.texture,0),x.clear(x.COLOR_BUFFER_BIT),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,F),x.activeTexture(x.TEXTURE1),x.bindTexture(x.TEXTURE_2D,_),x.uniform1i(m.target0,0),x.uniform1i(m.lightBuffer,1),x.bindBuffer(x.ARRAY_BUFFER,L),x.vertexAttribPointer(m.position,2,x.FLOAT,!1,0,0),x.enableVertexAttribArray(m.position),x.drawArrays(x.TRIANGLES,0,6)},m.deactivate=function(){x.disableVertexAttribArray(m.position),x.bindFramebuffer(x.FRAMEBUFFER,null)},y.activate=function(t){x.useProgram(y),x.clear(x.COLOR_BUFFER_BIT),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,t.texture),x.uniform1i(y.tex,0),x.uniform1f(y.fade,"fade"in t?t.fade:1),x.bindBuffer(x.ARRAY_BUFFER,L),x.vertexAttribPointer(y.position,2,x.FLOAT,!1,0,0),x.enableVertexAttribArray(y.position),x.drawArrays(x.TRIANGLES,0,6)},e.exports={init:function(t,e){v.textures={mainScene:t.texture,roomScene:e.texture}},render:function(t,e){v.activate(t),v.deactivate(),d.activate(t),d.deactivate(),m.activate(t),m.deactivate(),e===!0&&y.activate(t)}}},{"./Context":1,"./lib/glMatrixSubset":18}],3:[function(t,e,r){var n=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=t("./../lib/Geom"),a=new n,s=new n;a.define("Balcony",null,function(){var t=this.points,e={sym:"BalconyFloor",points:[{x:t[0].x,y:t[0].y,z:t[0].z},{x:t[1].x,y:t[1].y,z:t[1].z},{x:t[2].x,y:t[2].y,z:t[2].z},{x:t[3].x,y:t[3].y,z:t[3].z}],extrudeBorders:this.floorHeight},r={sym:"BalconyFloor",points:[{x:t[0].x,y:t[0].y+this.floorHeight,z:t[0].z},{x:t[1].x,y:t[1].y+this.floorHeight,z:t[1].z},{x:t[2].x,y:t[2].y+this.floorHeight,z:t[2].z},{x:t[3].x,y:t[3].y+this.floorHeight,z:t[3].z}]},n=i.extrudeAll(e.points,this.floorHeight,"TQuad"),o=i.extrudeAll(r.points,this.fenceHeight,"Fence");return o.pop(),n.push.apply(n,o),n.push(e,r),n}),a.define("BalconyFloor",null,function(){var t=i.splitXZ(this,[.8,.15,.05],[.05,.45,.5],"TQuad"),e=t.splice(4,1).shift().points;if("extrudeBorders"in this){var r=i.extrudeAll([{x:e[0].x,y:e[0].y,z:e[0].z},{x:e[1].x,y:e[1].y,z:e[1].z},{x:e[2].x,y:e[2].y,z:e[2].z},{x:e[3].x,y:e[3].y,z:e[3].z}],this.extrudeBorders,"TQuad");t.push.apply(t,r)}return t}),a.define("Fence",null,function(){var t=i.fit("x",this,"StickBase",.25),e=this.points[0],r=this.points[1],n=this.points[3],o=n.x-e.x,a=n.z-e.z,s=Math.atan2(a,o)-Math.PI/2,u=.05*Math.cos(s),h=.05*Math.sin(s),l={sym:"TQuad",points:[{x:e.x,y:r.y,z:e.z},{x:e.x+u,y:r.y,z:e.z+h},{x:n.x+u,y:r.y,z:n.z+h},{x:n.x,y:r.y,z:n.z}]},c={sym:"TQuad",points:[{x:e.x,y:r.y+.05,z:e.z},{x:e.x+u,y:r.y+.05,z:e.z+h},{x:n.x+u,y:r.y+.05,z:n.z+h},{x:n.x,y:r.y+.05,z:n.z}]};t.push(l),t.push(c);var p=l.points;return t.push.apply(t,i.extrudeAll([{x:p[0].x,y:p[0].y,z:p[0].z},{x:p[1].x,y:p[1].y,z:p[1].z},{x:p[2].x,y:p[2].y,z:p[2].z},{x:p[3].x,y:p[3].y,z:p[3].z}],.05,"TQuad")),t}),a.define("StickBase",null,function(){var t=i.split(this,[.45,.1,.45],[1],null),e=t[1],r=e.points,n=r[3].x-r[0].x,o=r[1].y-r[0].y,a=r[3].z-r[0].z,s=Math.atan2(a,n)-Math.PI/2,u=Math.sqrt(n*n+a*a),h=Math.abs(o),l=Math.cos(s)*u,c=Math.sin(s)*u;return{sym:"Stick",points:[{x:r[0].x,y:r[0].y,z:r[0].z},{x:r[0].x+l,y:r[0].y,z:r[0].z+c},{x:r[3].x+l,y:r[0].y,z:r[3].z+c},{x:r[3].x,y:r[0].y,z:r[3].z}],stickHeight:h}}),a.define("Stick",null,function(){var t=this.points;return i.extrudeAll([{x:t[0].x,y:t[0].y,z:t[0].z},{x:t[1].x,y:t[1].y,z:t[1].z},{x:t[2].x,y:t[2].y,z:t[2].z},{x:t[3].x,y:t[3].y,z:t[3].z}],this.stickHeight,"TQuad")}),a.define("TQuad",null,function(){var t,e=[],r=[],i=[];this.uvs=this.uvs||[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];var a=this.points[0],s=this.points[1],u=this.points[2],h=this.points[3];e=[a.x,a.y,a.z,s.x,s.y,s.z,u.x,u.y,u.z,a.x,a.y,a.z,u.x,u.y,u.z,h.x,h.y,h.z],i=[0,1,2,0,2,3].reduce(function(t,e){return t.push(this.uvs[e].s,this.uvs[e].t,this.texID||0),t}.bind(this),[]),t=o.triToNormal(e);for(var l=0;6>l;l++)r.push.apply(r,t);return{sym:n.TERMINAL,vertices:e,normals:r,uvs:i}}),s.define("Staircase",null,function(){for(var t=this.stairHeight+this.stairSpace,e=this.height/t,r=this.width/e,n=[],i=0;e>=i;i++)n.push({sym:"Stair",x:this.x+r*i,y:this.y+t*i,z:this.z,height:this.stairHeight,width:r,depth:this.stairDepth});return n.push({sym:"TQuad",points:[{x:this.x-r/2,y:this.y,z:this.z-this.stairDepth/2},{x:this.x-r/2+this.width,y:this.y+this.height,z:this.z-this.stairDepth/2},{x:this.x+r/2+this.width,y:this.y+this.height,z:this.z-this.stairDepth/2},{x:this.x+r/2,y:this.y,z:this.z-this.stairDepth/2}]},{sym:"TQuad",points:[{x:this.x-r/2,y:this.y,z:this.z+this.stairDepth/2},{x:this.x-r/2+this.width,y:this.y+this.height,z:this.z+this.stairDepth/2},{x:this.x+r/2+this.width,y:this.y+this.height,z:this.z+this.stairDepth/2},{x:this.x+r/2,y:this.y,z:this.z+this.stairDepth/2}]}),n}),s.define("Stair",null,function(){var t=this.width/2,e=this.height/2,r=this.depth/2,n=[{sym:"TQuad",points:[{x:this.x-t,y:this.y-e,z:this.z-r},{x:this.x-t,y:this.y-e,z:this.z+r},{x:this.x+t,y:this.y-e,z:this.z+r},{x:this.x+t,y:this.y-e,z:this.z-r}]},{sym:"TQuad",points:[{x:this.x-t,y:this.y+e,z:this.z-r},{x:this.x-t,y:this.y+e,z:this.z+r},{x:this.x+t,y:this.y+e,z:this.z+r},{x:this.x+t,y:this.y+e,z:this.z-r}]}];return n.push.apply(n,i.extrudeAll(n[0].points,this.height,"TQuad")),n}),s.define("TQuad",null,function(){var t,e=[],r=[],i=[];this.uvs=this.uvs||[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];var a=this.points[0],s=this.points[1],u=this.points[2],h=this.points[3];e=[a.x,a.y,a.z,s.x,s.y,s.z,u.x,u.y,u.z,a.x,a.y,a.z,u.x,u.y,u.z,h.x,h.y,h.z],i=[0,1,2,0,2,3].reduce(function(t,e){return t.push(this.uvs[e].s,this.uvs[e].t,this.texID||0),t}.bind(this),[]),t=o.triToNormal(e);for(var l=0;6>l;l++)r.push.apply(r,t);return{sym:n.TERMINAL,vertices:e,normals:r,uvs:i}});var u,h;u=a.run({sym:"Balcony",points:[{x:-.5,y:0,z:0},{x:-.5,y:0,z:1},{x:.5,y:0,z:1},{x:.5,y:0,z:0}],floorHeight:.025,fenceHeight:.4}).reduce(function(t,e){for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);return t},{vertices:[],normals:[],uvs:[]}),h=s.run({sym:"Staircase",x:-0.2375,y:.0125,z:.35,height:1,width:.7,stairDepth:.2,stairHeight:.025,stairSpace:.0625}).reduce(function(t,e){for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);return t},{vertices:u.vertices.slice(),normals:u.normals.slice(),uvs:u.uvs.slice()});var l=function(t){var e=t.vertices,r=t.normals,n=t.uvs;return function(t){for(var i=t.angle,o=Math.cos(i),a=Math.sin(i),s=t.x1-t.x0,u=t.z1-t.z0,h=t.x0+s/2,l=t.z0+u/2,c=t.y,p=t.width,f=t.height,x=t.depth,v=e.length,d=new Float32Array(v),m=new Float32Array(v),y=new Float32Array(n),g=0;v>g;g+=3){var z=e[g]*p,E=e[g+1]*f+c,b=e[g+2]*x;d[g]=z*o+b*a+h,d[g+1]=E,d[g+2]=-z*a+b*o+l,z=r[g],E=r[g+1],b=r[g+2],z=z*o+b*a+h,b=-z*a+b*o+l,m[g]=z,m[g+1]=E,m[g+2]=b}return{vertices:d,normals:m,uvs:y}}};e.exports={createBalcony:l(u),createBalconyWithStairs:l(h)}},{"../lib/SHAPE.js":15,"./../lib/Geom":11,"./../lib/ShapeGrammar":16}],4:[function(t,e,r){var n=t("./PRNG"),i=t("./../lib/Geom"),o=function(t,e,r){return(1-r)*t+r*e},a=function(t,e,r){var n,a,u,h,l,c,p,f,x,v,d,m,y,g=[],z=[],E=[],b=[];for(f=0,d=t.length;d>f;f++)for(n=(f+1)%d,a=(f+2)%d,u=(f-1+d)%d,h=i.lineIntersection(t[f],t[n],e[u],e[f]),l=i.lineIntersection(t[f],t[n],e[n],e[a]),c=h.x-l.x,p=h.y-l.y,y=Math.sqrt(c*c+p*p),ang=Math.atan2(p,c),v=2,z.push(v),E.push(ang),x=0;v>x;x++){var T=x/(v-1);px1=o(h.x,l.x,T),py1=o(h.y,l.y,T),px2=o(e[f].x,e[n].x,T),py2=o(e[f].y,e[n].y,T),g.push({x:o(h.x,l.x,T),y:o(h.y,l.y,T)},{x:o(e[f].x,e[n].x,T),y:o(e[f].y,e[n].y,T)})}for(g.push(g[0]),f=0,d=t.length;d>f;f++){for(m=[],x=0;x<z[f];x++)m.push(g.shift()),m.push(g.shift());m.push(t[(f+1)%d]),m.push(g[0]||t[0]);for(var M=0,v=m.length;v-2>M;M+=2)b.push(new s([m[M],m[(M+1)%v],m[(M+3)%v],m[(M+2)%v]],r.random()+.5,E[f]))}return b},s=function(t,e,r){this.poly=t,this.height=e,this.angle=r},u=function(t,e){var r=new n(e);this.poly=t,this.block=i.insetPolygon(this.poly,.05),this.lots=a(i.insetPolygon(this.block,.1),i.insetPolygon(this.block,.6),r);var o=t.reduce(function(t,e){return t.cx+=e.x,t.cy+=e.y,t.xm>e.x&&(t.xm=e.x),t.xM<e.x&&(t.xM=e.x),t.ym>e.y&&(t.ym=e.y),t.yM<e.y&&(t.yM=e.y),t},{xm:Number.POSITIVE_INFINITY,ym:Number.POSITIVE_INFINITY,xM:Number.NEGATIVE_INFINITY,yM:Number.NEGATIVE_INFINITY,cx:0,cy:0});this.x=o.cx/t.length,this.y=o.cy/t.length,this.w=Math.max(Math.abs(o.xM-o.xm),Math.abs(o.yM-o.ym))};e.exports=u},{"./../lib/Geom":11,"./PRNG":8}],5:[function(t,e,r){var n=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=t("earcut"),a=t("./../lib/Geom"),s=t("./PRNG"),u=t("./BalconySHG.js"),h=new n,l=new s(31337),c=new s(31338),p=new s(31339),f=new s(31337);h.define("Building",null,function(){for(var t=[],e=0,r=0,n=this.floorsLayout.length;n>r;r++){var i=this.floorsLayout[r],o={sym:i.type,height:i.height,params:i,points:this.points.map(function(t){return{x:t.x,y:t.y+e,z:t.z}}),facadeLayout:this.facadeLayout};"frontFacade"in this&&(o.frontFacade=this.frontFacade),"hasBalcony"in this&&(o.hasBalcony=this.hasBalcony,r>=n-2&&(o.hasBalconyTop=this.hasBalcony)),e+=i.height,t.push(o)}return t}),h.define("FL_GndFloor",null,function(){return function(){var t=i.extrudeAll(this.points,this.height,"Facade",[0,1,0]);switch(this.params.tiles){case"OneDoor":for(var e=0,r=t.length;r>e;e++)t[e].type=this.facadeLayout[e]||"Windows";t[this.frontFacade].type="OneDoor"}return t}}()),h.define("FL_Floor",null,function(){for(var t=i.extrudeAll(this.points,this.height,"Facade",[0,1,0]),e=0,r=t.length;r>e;e++)t[e].type=this.facadeLayout[e]||"Windows",t[e].windows=this.params.windows;return"hasBalcony"in this&&(t[this.frontFacade].hasBalcony=this.hasBalcony),"hasBalconyTop"in this&&(t[this.frontFacade].hasBalconyTop=this.hasBalconyTop),t}),h.define("FL_Ledge",null,function(){var t=[],e=this.height,r=this.points[0].y;t=a.insetPolygon(this.points.map(function(t){return{x:t.x,y:t.z}}),this.params.width).map(function(t){return{x:t.x,y:r,z:t.y}});var n=i.extrudeAll(t,this.height,"Quad",[0,1,0]);return n.forEach(function(t){var r=t.points[3].x-t.points[0].x,n=t.points[1].y-t.points[0].y,i=t.points[3].z-t.points[0].z,o=e/h.UVSCALE,a=o*Math.sqrt(r*r+i*i)/n;t.uvs=[{s:0,t:o},{s:0,t:0},{s:a,t:0},{s:a,t:o}],t.texID=6}),n.push({sym:"Poly",texID:6,points:t}),n.push({sym:"Poly",texID:6,points:t.map(function(t){return{x:t.x,y:t.y+e,z:t.z}})}),n}),h.define("FL_Rooftop",null,function(){var t=[],e=this.height,r=this.points[0].y;t=a.insetPolygon(this.points.map(function(t){return{x:t.x,y:t.z}}),-this.params.width).map(function(t){return{x:t.x,y:r,z:t.y}});for(var n=i.extrudeAll(this.points,this.height,"Quad",[0,1,0]),o=i.extrudeAll(t,this.height,"Quad",[0,1,0]);n.length;)o.push(n.shift());o.forEach(function(t){var r=t.points[3].x-t.points[0].x,n=t.points[1].y-t.points[0].y,i=t.points[3].z-t.points[0].z,o=e/h.UVSCALE,a=o*Math.sqrt(r*r+i*i)/n;t.uvs=[{s:0,t:o},{s:0,t:0},{s:a,t:0},{s:a,t:o}],t.texID=6}),o.push({sym:"Poly",points:t,texID:3});for(var s=0,u=t.length;u>s;s++){var l=(s+1)%u,c=this.points[s],p=t[s],f=t[l],x=this.points[l],v={sym:"Poly",points:[c,p,f,c,f,x].map(function(t){return{x:t.x,y:t.y+e,z:t.z}}),texID:6};o.push(v)}return o}),h.define("Facade",function(){return"OneDoor"===this.type},function(){var t=this.points[3].x-this.points[0].x,e=this.points[1].y-this.points[0].y,r=this.points[3].z-this.points[0].z,n=e/h.UVSCALE,o=n*Math.sqrt(t*t+r*r)/e;this.uvs=[{s:0,t:n},{s:0,t:0},{s:o,t:0},{s:o,t:n}];var a=i.fit("x",this,"Window",1);return a[~~(a.length/2)].sym="Door",a}),h.define("Facade",null,function(){var t=this.points[3].x-this.points[0].x,e=this.points[1].y-this.points[0].y,r=this.points[3].z-this.points[0].z,o=Math.sqrt(t*t+r*r),a=e/h.UVSCALE,s=a*o/e,l=null;this.uvs=[{s:0,t:a},{s:0,t:0},{s:s,t:0},{s:s,t:a}];var c=i.fit("x",this,"Window",1);if("Window"===this.type);else if("function"==typeof this.type)for(var p=0,f=c.length;f>p;p++)this.type(p)||(c[p].sym="Quad",c[p].texID=6);if(this.hasBalcony){var x=(c.length%2===0?2:3)/c.length,v={x0:this.points[0].x,z0:this.points[0].z,x1:this.points[3].x,z1:this.points[3].z,y:this.points[0].y,height:e,width:.9*o*x,depth:.4*o*x,angle:Math.atan2(-r,t)};l=this.hasBalconyTop?u.createBalcony(v):u.createBalconyWithStairs(v),l.sym=n.TERMINAL}return null!==l&&c.push(l),c}),h.define("Window",null,function(){var t=i.split(this,[.3,.4,.3],[1],"Quad"),e=i.split(t[1],[1],[.15,.7,.15],"Quad"),r=e[1],n=l.random()>.8;r.uvs=null,r.texID=n?5:4,t[0].texID=t[2].texID=e[0].texID=e[2].texID=6;var o=[t[0],t[2],e[0],e[2]],s=this.normal||a.triToNormal([r.points[0].x,r.points[0].y,r.points[0].z,r.points[1].x,r.points[1].y,r.points[1].z,r.points[2].x,r.points[2].y,r.points[2].z]),u=i.extrudeAll(r.points,-.0025,"Quad",s),h=s[0],c=s[1],p=s[2];h*=.0025,c*=.0025,p*=.0025;for(var f=0,x=r.points.length;x>f;f++){var v=r.points[f];v.x-=h,v.y-=c,v.z-=p}for(var f=0,x=u.length;x>f;f++)u[f].texID=3,o.push(u[f]);return o.push(r),o}),h.define("Door",null,function(){var t=i.split(this,[.15,.7,.15],[1],"Quad"),e=i.split(t[1],[1],[.7,.3],"Quad"),r=e[0];r.uvs=null,r.texID=l.random()>.3?4:5,t[0].texID=t[2].texID=e[1].texID=6;var n=[t[0],t[2],e[1]],o=a.triToNormal([r.points[0].x,r.points[0].y,r.points[0].z,r.points[1].x,r.points[1].y,r.points[1].z,r.points[2].x,r.points[2].y,r.points[2].z]),s=i.extrudeAll(r.points,-.005,"Quad",o),u=o[0],h=o[1],c=o[2];u*=.005,h*=.005,c*=.005;for(var p=0,f=r.points.length;f>p;p++){var x=r.points[p];x.x-=u,x.y-=h,x.z-=c}for(var p=0,f=s.length;f>p;p++)s[p].texID=3,n.push(s[p]);return n.push(r),n}),h.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var e,r,i,o,a,s,u,h,l,c,p,f=this.points;return h=f[0],l=f[1],c=f[2],p=f[3],e=[h.x,h.y,h.z,l.x,l.y,l.z,c.x,c.y,c.z,h.x,h.y,h.z,c.x,c.y,c.z,p.x,p.y,p.z],r=this.uvs||t,o=r[0],a=r[1],s=r[2],u=r[3],i=this.texID||0,r=[o.s,o.t,i,a.s,a.t,i,s.s,s.t,i,o.s,o.t,i,s.s,s.t,i,u.s,u.t,i],{sym:n.TERMINAL,vertices:e,uvs:r}}}()),h.define("Poly",null,function(){var t,e,r,i,a,s,u,h=this.points.map(function(t){return[t.x,t.z]}),l=this.points[0].y,c=o([h]),p=c.reduce(function(t,e){return t.push(e[0],l,e[1]),t},[]),f=[];t=e=Number.POSITIVE_INFINITY,r=i=Number.NEGATIVE_INFINITY;for(var x=0,v=this.points.length;v>x;x++)u=this.points[x],t>u.x&&(t=u.x),r<u.x&&(r=u.x),e>u.z&&(e=u.z),i<u.z&&(i=u.z);a=r-t,s=i-e;for(var x=0,v=p.length;v>x;x+=3){var d=p[x],m=p[x+2];f.push((d-t)/a,(m-e)/s,this.texID)}return{sym:n.TERMINAL,vertices:p,uvs:f}});var x=[[.9,.65,.48],[.75,.73,.69],[.82,.67,.42],[.6,.39,.33]];h.UVSCALE=.1,e.exports={shg:h,create:function(t){var e=t.width/2,r=t.depth/2,n=t.x-e,i=t.x+e,o=t.y-r,a=t.y+r,s=Math.max(e/r,r/e),u=1e3*(i+n+a+o),v=null,d=!1;l.seed(u),c.seed(u),p.seed(u);var m=[];if(1.3>s&&c.random()<.3)for(var y=0;8>y;y++){var g=-t.angle-y*Math.PI/4;m.push({x:t.x+e*Math.cos(g),y:0,z:t.y+r*Math.sin(g)}),v=0}else if(s>1.1&&c.random()<.8){d=!0;var z=2/2.7;e>r?t.angle<.1?(m.push({x:n,y:0,z:o},{x:n,y:0,z:a},{x:n+e*z,y:0,z:a},{x:n+e*z,y:0,z:a-r*z},{x:i-e*z,y:0,z:a-r*z},{x:i-e*z,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),v=3):(m.push({x:n,y:0,z:o},{x:n,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o},{x:i-e*z,y:0,z:o},{x:i-e*z,y:0,z:o+r*z},{x:n+e*z,y:0,z:o+r*z},{x:n+e*z,y:0,z:o}),v=5):t.angle>0?(m.push({x:n,y:0,z:o},{x:n,y:0,z:o+r*z},{x:n+e*z,y:0,z:o+r*z},{x:n+e*z,y:0,z:a-r*z},{x:n,y:0,z:a-r*z},{x:n,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),v=2):(m.push({x:n,y:0,z:o},{x:n,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:a-r*z},{x:i-e*z,y:0,z:a-r*z},{x:i-e*z,y:0,z:o+r*z},{x:i,y:0,z:o+r*z},{x:i,y:0,z:o}),v=4)}else m.push({x:n,
y:0,z:o},{x:n,y:0,z:a},{x:i,y:0,z:a},{x:i,y:0,z:o}),v=e>r?t.angle<.1?1:3:t.angle<0?2:0;var E=[],b=~~(2*p.random()),T=[];switch(b){case 0:E.push({type:"FL_GndFloor",height:.05,tiles:"OneDoor",frontSide:t.angle},{type:"FL_Ledge",height:.00625,width:.00625});for(var y=0,M=4+~~(20*f.random());M>y;y++)E.push({type:"FL_Floor",height:.05,windows:"Double"});E.push({type:"FL_Ledge",height:.00625,width:.00625},{type:"FL_Floor",height:.0625,windows:"Single"},{type:"FL_Rooftop",height:.00625,width:.00625});break;case 1:E.push({type:"FL_GndFloor",height:.05,tiles:"OneDoor",frontSide:t.angle});for(var y=0,M=4+~~(10*f.random());M>y;y++)E.push({type:"FL_Floor",height:.05,windows:"Double"});E.push({type:"FL_Floor",height:.05,windows:"Single"},{type:"FL_Rooftop",height:.00625,width:.00625})}for(var y=0,M=m.length;M>y;y++){var w=~~(3*f.random());switch(w){case 0:T[y]="Windows";break;case 1:T[y]=function(t){return!(t%3===0)};break;case 2:T[y]=function(t){return t%2===0}}}var R={sym:"Building",floorsLayout:E,facadeLayout:T,points:m};null!==v&&(R.frontFacade=v),d&&(R.hasBalcony=!0);var A=x[~~(f.random()*x.length)],I=h.run(R);return{geom:I,color:A}},getGeom:function(){return context}}},{"../lib/SHAPE.js":15,"./../lib/Geom":11,"./../lib/ShapeGrammar":16,"./BalconySHG.js":3,"./PRNG":8,earcut:20}],6:[function(t,e,r){var n=new(t("./PRNG")),i=t("./../lib/Geom"),o=t("./Roads.js"),a=t("./Block.js"),s=function(){var t=2*Math.PI;return function(e,r,n,o){var a,u,h,l=Math.atan2(-r.y+e.y,r.x-e.x),c={th:Number.POSITIVE_INFINITY,vertex:null};"traversed"in e||(e.traversed=[]),"traversed"in r||(r.traversed=[]),e.traversed.push(r);for(var p=0;p<r.conns.length;p++)u=r.conns[p],u===e||-1!==r.traversed.indexOf(u)||o&&u!==o[0]&&-1!==o.indexOf(u)||(a=Math.atan2(-u.y+r.y,u.x-r.x)-l,a>Math.PI?a-=t:a<-Math.PI&&(a+=t),a<c.th&&(c.th=a,c.vertex=r.conns[p]));return null===c.vertex?null:(o&&o.push(r),o&&c.vertex===o[0]?(h=i.isOverlapping(o,n))?null:(r.traversed.push(o[0]),o):(o=s(r,c.vertex,n,o||[e,r]),null===o&&r.traversed.splice(r.traversed.indexOf(c.vertex),1),o||null))}}(),u=function(t){n.seed(t);var e=[];this.roads=o(),this.blocks=[];for(var r=0;r<this.roads.length;r++)for(var u=0;u<this.roads[r].conns.length;u++){"traversed"in this.roads[r]||(this.roads[r].traversed=[]);var h=s(this.roads[r],this.roads[r].conns[u],this.roads);null===h||i.isPolyIn(h,e)||(e.push(h),this.blocks.push(new a(h,65536*n.random())))}this.roads.forEach(function(t){t.traversed=[]});var l=[];this.roads.forEach(function(t){t.conns.forEach(function(e){-1===e.traversed.indexOf(t)&&(l.push([t,e]),t.traversed.push(e),e.traversed.push(t))})}),this.roadQuads=l};e.exports=u},{"./../lib/Geom":11,"./Block.js":4,"./PRNG":8,"./Roads.js":9}],7:[function(t,e,r){var n=t("./../lib/ShapeGrammar"),i=t("../lib/SHAPE.js"),o=t("./../lib/Geom"),a=new n,s=function(t){return function(e,r){return e=e.concat(i.extrudeAll(r,t,"Quad",[0,-1,0])),e.push({sym:"Quad",points:r}),e.push({sym:"Quad",points:r.map(function(e){return{x:e.x,y:e.y-t,z:e.z}})}),e}},u=function(t){var e=t.vertices.reduce(function(t,e,r){var n=r%3;switch(n){case 0:t.mX=Math.min(t.mX,e),t.MX=Math.max(t.MX,e);break;case 1:t.mY=Math.min(t.mY,e),t.MY=Math.max(t.MY,e);break;case 2:t.mZ=Math.min(t.mZ,e),t.MZ=Math.max(t.MZ,e)}return t},{mX:Number.POSITIVE_INFINITY,MX:Number.NEGATIVE_INFINITY,mY:Number.POSITIVE_INFINITY,MY:Number.NEGATIVE_INFINITY,mZ:Number.POSITIVE_INFINITY,MZ:Number.NEGATIVE_INFINITY});e.lX=e.MX-e.mX,e.lY=e.MY-e.mY,e.lZ=e.MZ-e.mZ;for(var r=t.extra,n=t.vertices,i=0,o=t.vertices.length;o>i;i+=3)r[i]=(n[i]-e.mX)/e.lX,r[i+1]=(n[i+1]-e.mY)/e.lY,r[i+2]=(n[i+2]-e.mZ)/e.lZ;return t};a.define("Chair",null,function(){var t=this.woodThk,e=this.width,r=this.height,n=2*t-.5,i=-n,o=this.cy,a=e/2,u=r/2,h=2*t,l=[{x:n,z:n},{x:n,z:i},{x:i,z:i},{x:i,z:n}].map(function(r){return[{x:e*r.x-t,y:o,z:e*r.z-t},{x:e*r.x-t,y:o,z:e*r.z+t},{x:e*r.x+t,y:o,z:e*r.z+t},{x:e*r.x+t,y:o,z:e*r.z-t}]}),c=[];return c=l.reduce(s(u),c),c=s(-h).call(null,c,[{x:-a,y:o,z:a},{x:-a,y:o,z:-a},{x:a,y:o,z:-a},{x:a,y:o,z:a}]),c=s(-u).call(null,c,[{x:-a,y:h+o,z:-a+h},{x:-a,y:h+o,z:-a},{x:a,y:h+o,z:-a},{x:a,y:h+o,z:-a+h}]).map(function(t){return t.texID=7,t})}),a.define("Table",null,function(){var t=this.woodThk,e=this.width,r=this.height,n=2*t-.5,i=-n,o=this.cy,a=e/2,u=2*t,h=[{x:n,z:n},{x:n,z:i},{x:i,z:i},{x:i,z:n}].map(function(r){return[{x:e*r.x-t,y:o,z:e*r.z-t},{x:e*r.x-t,y:o,z:e*r.z+t},{x:e*r.x+t,y:o,z:e*r.z+t},{x:e*r.x+t,y:o,z:e*r.z-t}]}),l=[];return l=h.reduce(s(r),l),l=s(-u).call(null,l,[{x:-a,y:o,z:a},{x:-a,y:o,z:-a},{x:a,y:o,z:-a},{x:a,y:o,z:a}]).map(function(t){return t.texID=7,t})}),a.define("Lamp",null,function(){for(var t=this.rings,e=this.sectors,r=null,n=[],i=[],o=0;t>o;o++){for(var a=0;e>a;a++){var s=Math.sin(.5*Math.PI*(o+1)/t)*this.radius;n.push({x:Math.cos(2*Math.PI*a/e)*s,z:Math.sin(2*Math.PI*a/e)*s,y:-o/t*this.height})}if(null!==r)for(var a=0;e>a;a++){var u=n[a],h=r[a],l=r[(a+1)%e],c=n[(a+1)%e];i.push({sym:"Quad",texID:7,points:[{x:u.x,y:u.y,z:u.z},{x:h.x,y:h.y,z:h.z},{x:l.x,y:l.y,z:l.z},{x:c.x,y:c.y,z:c.z}]})}r=n,n=[]}return i}),a.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var e,r,i,a,s,u,h,l,c,p,f,x,v=[],d=this.points;c=d[0],p=d[1],f=d[2],x=d[3],e=[c.x,c.y,c.z,p.x,p.y,p.z,f.x,f.y,f.z,c.x,c.y,c.z,f.x,f.y,f.z,x.x,x.y,x.z],i=this.normal||o.triToNormal(e);for(var m=0;6>m;m++)v.push(i[0],i[1],i[2]);return r=this.uvs||t,s=r[0],u=r[1],h=r[2],l=r[3],a=this.texID||0,r=[s.s,s.t,a,u.s,u.t,a,h.s,h.t,a,s.s,s.t,a,h.s,h.t,a,l.s,l.t,a],{sym:n.TERMINAL,vertices:e,normals:v,uvs:r}}}());var h=a.run({sym:"Table",cy:.4,width:.75,height:.4,woodThk:.025}).reduce(function(t,e){for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);return t},{vertices:[],normals:[],uvs:[],extra:[]}),l=a.run({sym:"Chair",cy:-.5,width:.5,height:1,woodThk:.03125}).reduce(function(t,e){for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);return t},{vertices:[],normals:[],uvs:[],extra:[]}),c=a.run({sym:"Lamp",rings:8,sectors:16,radius:.125,height:.25}).reduce(function(t,e){for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);return t},{vertices:[],normals:[],uvs:[],extra:[]});c=u(c),l=u(l),h=u(h);var p=function(t){return function(e,r,n){return{vertices:t.vertices.map(function(t,i){switch(i%3){case 0:return t+e;case 1:return t+r;case 2:return t+n}}),normals:t.normals,uvs:t.uvs,extra:t.extra}}};e.exports={lamp:p(c),table:p(h),chair:p(l)}},{"../lib/SHAPE.js":15,"./../lib/Geom":11,"./../lib/ShapeGrammar":16}],8:[function(t,e,r){var n=t("mersennetwister"),i=function(t){void 0!==t?this.seed(t):this.mt=new n};i.prototype.seed=function(t){this.mt=new n(t)},i.prototype.random=function(){return this.mt.random()},e.exports=i},{mersennetwister:21}],9:[function(t,e,r){var n=t("./PRNG"),i=4,o=0,a=2;e.exports=function(t){for(var e=[],r=new n(t),s=0;i>s;s++)for(var u=0;i>u;u++){var h=e[s*i+u]={x:a*u+o*r.random(),y:a*s+o*r.random(),conns:[]};u>0&&(h.conns.push(e[s*i+u-1]),e[s*i+u-1].conns.push(h)),s>0&&(h.conns.push(e[(s-1)*i+u]),e[(s-1)*i+u].conns.push(h))}return e}},{"./PRNG":8}],10:[function(t,e,r){var n=t("./../lib/ShapeGrammar"),i=t("./../Context"),o=t("../lib/SHAPE.js"),a=t("./../lib/Geom"),s=t("./PRNG"),u=t("./FurnitureSHG.js"),h=new n,l=new s(12345);h.define("Apartment",null,function(){var t=o.extrudeAll(this.points.slice().reverse(),h.floorHeight,"Quad",[0,1,0]);return t.push({sym:"Room",points:this.points}),t}),h.define("Room",function(){var t=o.bounds(this);return t.width>t.depth&&(t.width>h.minWidth&&l.random()<h.density||t.width>h.maxWidth)},function(){var t=o.splitXZ(this,[h.ratio,1-h.ratio],[1],"Room");return t}),h.define("Room",function(){var t=o.bounds(this);return t.width<=t.depth&&(t.depth>h.minWidth&&l.random()<h.density||t.width>h.maxWidth)},function(){var t=o.splitXZ(this,[1],[h.ratio,1-h.ratio],"Room");return t}),h.define("Room",null,function(t){for(var e=this.points,r=[],n=o.inset(this.points,.05),i=o.bounds(this),r=[],a=0,s=e.length;s>a;a++){var u,l,c=n[a],p=n[(a+1)%s],f=p.x-c.x,x=p.z-c.z,v=Math.atan2(x,f),d=v+Math.PI/2,m=Math.sin(v),y=Math.cos(v),g=Math.sin(d),z=Math.cos(d);u={x:c.x+.3*y,y:c.y,z:c.z+.3*m},l={x:p.x-.3*y,y:p.y,z:p.z-.3*m},r.push({sym:"Wall",points:[e[a],e[(a+1)%s]],p0:u,p1:l,boundaries:[{x:u.x-.1*z,z:u.z-.1*g},{x:u.x+.1*z,z:u.z+.1*g},{x:l.x+.1*z,z:l.z+.1*g},{x:l.x-.1*z,z:l.z-.1*g}].reduce(function(t,e){return{maxX:Math.max(t.maxX,e.x),maxZ:Math.max(t.maxZ,e.z),minX:Math.min(t.minX,e.x),minZ:Math.min(t.minZ,e.z)}},{maxX:Number.NEGATIVE_INFINITY,maxZ:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minZ:Number.POSITIVE_INFINITY}),length:Math.sqrt(f*f+x*x),angle:v})}r.push({sym:"Quad",points:this.points}),r.push({sym:"Quad",points:this.points.map(function(t){return{x:t.x,y:t.y+h.floorHeight,z:t.z}})});var E=1/e.length,b={sym:"GraphNode",isTerminal:!0,neighbors:[],width:i.width,depth:i.depth,roomCentroid:this.points.reduce(function(t,e){return t.x+=E*e.x,t.y+=E*e.y,t.z+=E*e.z,t},{x:0,y:0,z:0})};return r.forEach(function(t){"Wall"===t.sym&&(t.room=b)}),r.push({sym:"LastRoomCandidate",node:b,points:e}),r.push({sym:"Lamp",isTerminal:!0,point:{x:b.roomCentroid.x,y:this.points[0].y+h.floorHeight,z:b.roomCentroid.z}}),i.width*i.depth>10&&r.push({sym:"Table",isTerminal:!0,point:{x:b.roomCentroid.x+.7*i.width*(Math.random()-.5),y:this.points[0].y,z:b.roomCentroid.z+.7*i.depth*(Math.random()-.5)}}),r}),h.define("LastRoomCandidate",function(t){return t.filter(function(t){return"Room"===t.sym}).length>0},function(t){return this}),h.define("LastRoomCandidate",function(t){return 0===t.filter(function(t){return"LastRoomCandidate"===t.sym}).indexOf(this)},function(t){return this.node.isFirst=!0,this.node}),h.define("LastRoomCandidate",function(t){return 0===t.filter(function(t){return"LastRoomCandidate"===t.sym}).reverse().indexOf(this)},function(t){return this.node.isLast=!0,[this.node,{sym:"LastRoom",node:this.node}]}),h.define("LastRoomCandidate",null,function(t){return this.node}),h.define("LastRoom",function(t){return t.filter(function(t){return"OccludedWall"===t.sym}).length>0},function(){return this}),h.define("LastRoom",null,function(){var t,e=this.node.neighbors.map(function(t){return t.r.roomCentroid}),r=this.node.roomCentroid,n=.9*this.node.width/2,o=.9*this.node.depth/2;t=[{x:r.x,y:r.y,z:r.z+o,mdd:Number.POSITIVE_INFINITY,th:Math.atan2(o,0)},{x:r.x,y:r.y,z:r.z-o,mdd:Number.POSITIVE_INFINITY,th:Math.atan2(-o,0)},{x:r.x+n,y:r.y,z:r.z,mdd:Number.POSITIVE_INFINITY,th:Math.atan2(0,n)},{x:r.x-n,y:r.y,z:r.z,mdd:Number.POSITIVE_INFINITY,th:Math.atan2(0,-n)}],t.forEach(function(t){e.forEach(function(e){var r=e.x-t.x,n=e.z-t.z;t.mdd=Math.min(t.mdd,r*r+n*n)})});var a=t.sort(function(t,e){return t.mdd>e.mdd?-1:e.mdd>t.mdd?1:0}).shift(),s=.15,u=Math.sin(a.th)*s*i.aspectRatio,h=Math.cos(a.th)*s*i.aspectRatio,l={sym:"Quad",texID:32,points:[{x:a.x+u,y:a.y+.75+s,z:a.z-h},{x:a.x+u,y:a.y+.75-s,z:a.z-h},{x:a.x-u,y:a.y+.75-s,z:a.z+h},{x:a.x-u,y:a.y+.75+s,z:a.z+h}]},c={sym:"GraphFinalNode",isTerminal:!0,roomCentroid:{x:a.x-.519*h,y:a.y,z:a.z-.519*u},neighbors:[this.node],isMonitor:!0,door:{angle:a.th,point:r}};return this.node.neighbors.push({r:c,via:c.door}),[l,c]}),h.define("Wall",function(t){return!t.reduce(function(t,e){return t||"Room"===e.sym},!1)},function(t){for(var e=this.boundaries.maxX,r=this.boundaries.maxZ,n=this.boundaries.minX,i=this.boundaries.minZ,o=this.length,a=!1,s=null,u=0,h=t.length;h>u&&!a;u++){var l=t[u];if(!a&&!l.occluded&&l!==this&&"Wall"===l.sym){var c=l.boundaries;l.length>=o&&!(e<c.minX||c.maxX<n||r<c.minZ||c.maxZ<i)&&(a=!0,s=l.room)}}return a?(this.occluded=!0,{sym:"OccludedWall",points:this.points,angle:this.angle,connects:[this.room,s],length:this.length}):[]}),h.define("Wall",null,function(){return this}),h.define("OccludedWall",null,function(){var t,e=this.points[0],r=this.points[1],n=Math.atan2(e.x-r.x,r.z-e.z),i=Math.sin(n)*h.wallDepth/2,a=Math.cos(n)*h.wallDepth/2,s={x:e.x+a,y:e.y,z:e.z+i},u={x:r.x+a,y:r.y,z:r.z+i},l={x:e.x-a,y:e.y,z:e.z-i},c={x:r.x-a,y:r.y,z:r.z-i},p=o.extrude("OccludedWall",s,u,h.floorHeight,[0,1,0]),f=o.extrude("OccludedWall",c,l,h.floorHeight,[0,1,0]),x=.5/this.length,v=(1-x)/2,d=o.split(p,[v,x,v],[1],"Quad"),m=o.split(d[1],[1],[.7,.3],"Quad"),y=o.split(f,[v,x,v],[1],"Quad"),g=o.split(y[1],[1],[.7,.3],"Quad"),z=m[0],E=g[0],b=(1-x/8)/2,T=b+x/8,M={x:o.lerp(e.x,r.x,b),y:o.lerp(e.y,r.y,b),z:o.lerp(e.z,r.z,b)},w={x:o.lerp(e.x,r.x,T),y:o.lerp(e.y,r.y,T),z:o.lerp(e.z,r.z,T)};return t={sym:"Door",angle:n,point:{x:.5*(e.x+r.x),y:.5*(e.y+r.y),z:.5*(e.z+r.z)}},this.connects[0].neighbors.push({r:this.connects[1],via:t}),this.connects[1].neighbors.push({r:this.connects[0],via:t}),[d[0],d[2],m[1],y[0],y[2],g[1],{sym:"Quad",points:[E.points[0],E.points[1],z.points[2],z.points[3]]},{sym:"Quad",points:[E.points[2],E.points[1],z.points[2],z.points[1]]},{sym:"Quad",points:[E.points[3],E.points[2],z.points[1],z.points[0]]},t,{sym:"WallSegment",points:[e,M]},{sym:"WallSegment",points:[w,r]}]}),h.define("Quad",null,function(){var t=[{s:0,t:1},{s:0,t:0},{s:1,t:0},{s:1,t:1}];return function(){var e,r,n,i,o,s,u,h,l,c,p,f,x=[],v=this.points;l=v[0],c=v[1],p=v[2],f=v[3],e=[l.x,l.y,l.z,c.x,c.y,c.z,p.x,p.y,p.z,l.x,l.y,l.z,p.x,p.y,p.z,f.x,f.y,f.z],n=this.normal||a.triToNormal(e);for(var d=0;6>d;d++)x.push(n[0],n[1],n[2]);return r=this.uvs||t,o=r[0],s=r[1],u=r[2],h=r[3],i=this.texID||3,r=[o.s,o.t,i,s.s,s.t,i,u.s,u.t,i,o.s,o.t,i,u.s,u.t,i,h.s,h.t,i],{sym:"Quad",isTerminal:!0,vertices:e,normals:x,uvs:r}}}()),h.define("Door",null,function(){return{sym:"Door",isTerminal:!0,point:this.point,angle:this.angle}}),h.define("WallSegment",null,function(){return{sym:"WallT",isTerminal:!0,p0:this.points[0],p1:this.points[1]}}),h.minWidth=4,h.maxWidth=7,h.density=.8,h.ratio=.61,h.floorHeight=1.5,h.wallDepth=.2,e.exports={shg:h,create:function(t){var e=h.run({sym:"Apartment",points:t}).reduce(function(t,e){switch(e.sym){case"Quad":for(var r=0,n=e.vertices.length;n>r;r++)t.vertices.push(e.vertices[r]),t.normals.push(e.normals[r]),t.uvs.push(e.uvs[r]);break;case"Lamp":for(var i=u.lamp(e.point.x,e.point.y,e.point.z),r=0,n=i.vertices.length;n>r;r++)t.lamp.vertices.push(i.vertices[r]),t.lamp.normals.push(i.normals[r]),t.lamp.uvs.push(i.uvs[r]),t.lamp.extra.push(i.extra[r]);break;case"Table":for(var o=u.table(e.point.x,e.point.y,e.point.z),r=0,n=o.vertices.length;n>r;r++)t.table.vertices.push(o.vertices[r]),t.table.normals.push(o.normals[r]),t.table.uvs.push(o.uvs[r]),t.table.extra.push(o.extra[r]);break;case"Chair":for(var a=u.chair(e.point.x,e.point.y,e.point.z),r=0,n=a.vertices.length;n>r;r++)t.chair.vertices.push(a.vertices[r]),t.chair.normals.push(a.normals[r]),t.chair.uvs.push(a.uvs[r]),t.chair.extra.push(a.extra[r]);break;case"WallT":t.walls.push(e);break;case"Door":t.doors.push(e);break;case"GraphNode":t.rooms.push(e),t.nodes.push(e);break;case"GraphFinalNode":t.monitor=e}return t},{vertices:[],normals:[],uvs:[],walls:[],rooms:[],nodes:[],arcs:[],doors:[],lamp:{vertices:[],normals:[],uvs:[],extra:[]},table:{vertices:[],normals:[],uvs:[],extra:[]},chair:{vertices:[],normals:[],uvs:[],extra:[]},monitor:null}),r=t.reduce(function(t,e){return t.minX=Math.min(e.x,t.minX),t.minZ=Math.min(e.z,t.minZ),t.maxX=Math.max(e.x,t.maxX),t.maxZ=Math.max(e.z,t.maxZ),t},{minX:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,minZ:Number.POSITIVE_INFINITY,maxZ:Number.NEGATIVE_INFINITY});return r.lenX=r.maxX-r.minX,r.lenZ=r.maxZ-r.minZ,e.lines=e.walls.reduce(function(t,e){return t.push((e.p0.x-r.minX)/r.lenX,(e.p0.z-r.minZ)/r.lenZ,(e.p1.x-r.minX)/r.lenX,(e.p1.z-r.minZ)/r.lenZ),t},[]),e.roomsWorld=e.rooms.map(function(t){return t.roomCentroid}),e.rooms=e.rooms.reduce(function(t,e){return t.push({x:(e.roomCentroid.x-r.minX)/r.lenX,y:(e.roomCentroid.y-r.minY)/r.lenY,z:(e.roomCentroid.z-r.minZ)/r.lenZ}),t},[]),e.width=r.lenX,e.height=r.lenZ,e.bbox=r,e}}},{"../lib/SHAPE.js":15,"./../Context":1,"./../lib/Geom":11,"./../lib/ShapeGrammar":16,"./FurnitureSHG.js":7,"./PRNG":8}],11:[function(t,e,r){var n={pnpoly:function(t,e,r){var n,i,o,a,s=t.length,u=!1;for(n=0,i=s-1;s>n;i=n++)o=t[n],a=t[i],o.y>r!=a.y>r&&e<(a.x-o.x)*(r-o.y)/(a.y-o.y)+o.x&&(u=!u);return u},isOverlapping:function(t,e){for(var r=e.length-1;r--;)if(n.pnpoly(t,e[r].x,e[r].y)&&-1===t.indexOf(e[r]))return!0;return!1},isPolyIn:function(t,e){for(var r=e.length-1;r>0;r--)if(n.isEqualPoly(t,e[r]))return!0;return!1},isEqualPoly:function(t,e){if(t.length!==e.length)return!1;for(var r=t.length-1;r--;)if(-1===e.indexOf(t[r]))return!1;return!0},insetPolygon:function(t,e){var r,i,o,a=[];i=t[t.length-1];for(var s=0;s<t.length-1;s++)r=i,i=t[s],o=t[s+1],a.push(n.insetCorner(r,i,o,e));return a.push(n.insetCorner(i,o,t[0],e)),a},insetCorner:function(t,e,r,i){var o,a,s,u,h=e.x-t.x,l=t.y-e.y,c=r.x-e.x,p=e.y-r.y,f=Math.sqrt(h*h+l*l),x=Math.sqrt(c*c+p*p),v={x:e.x,y:e.y},d={x:e.x,y:e.y};return 0==f||0==x?null:(o=l/f*i,s=h/f*i,a=p/x*i,u=c/x*i,v.x+=o,v.y+=s,d.x+=a,d.y+=u,v.x===d.x&&v.y===d.y?v:n.lineIntersection({x:t.x+o,y:t.y+s},v,d,{x:r.x+a,y:r.y+u}))},lineIntersection:function(t,e,r,n){var i,o,a,s,u,h={x:t.x,y:t.y},l={x:e.x,y:e.y},c={x:r.x,y:r.y},p={x:n.x,y:n.y};return l.x-=h.x,c.x-=h.x,p.x-=h.x,l.y-=h.y,c.y-=h.y,p.y-=h.y,i=Math.sqrt(l.x*l.x+l.y*l.y),o=l.x/i,a=l.y/i,s=c.x*o+c.y*a,c.y=-c.x*a+c.y*o,c.x=s,s=p.x*o+p.y*a,p.y=-p.x*a+p.y*o,p.x=s,c.y==p.y?null:(u=p.x+(c.x-p.x)*p.y/(p.y-c.y),{x:h.x+u*o,y:h.y+u*a})},triToNormal:function(t){var e=t[0]-t[3],r=t[1]-t[4],n=t[2]-t[5],i=t[6]-t[3],o=t[7]-t[4],a=t[8]-t[5],s=r*a-n*o,u=e*a-n*i,h=e*o-r*i,l=1/Math.sqrt(s*s+u*u+h*h);return s*=l,u*=l,h*=l,[s,u,h]}};e.exports=n},{}],12:[function(t,e,r){var n=t("./../Context"),i={},o=document.createElement("ul");o.style.position="absolute",o.style.top="7rem",o.style.left="1rem",o.style.color="#444",o.style.font='10px "Ubuntu Mono", monospace',o.style.lineHeight="1.5em",o.style.listStyleType="none",n.canvas.parentNode.appendChild(o),e.exports={progress:function(t,e){if(!(t in i)){var r=document.createElement("li");o.appendChild(r),i[t]={fns:[],li:r,value:0}}i[t].value=e,e>=1&&i[t].fns.forEach(function(t){t()})},subscribe:function(t,e){if(!(t in i)){var r=document.createElement("li");o.appendChild(r),i[t]={fns:[],li:r,value:0}}i[t].fns.push(e)},render:function(){for(var t in i){for(var e=parseInt(100*i[t].value),r=""+e;r.length<4;)r="_"+r;r=r.replace(/_/g,"&nbsp;"),i[t].li.innerHTML="&nbsp;"+t+": "+r+"%&nbsp;\n";var n="linear-gradient(90deg, #0f0, #0f0 "+e+"%, #0b0 "+e+"%)";i[t].li.style.backgroundImage=n}},remove:function(){n.canvas.parentNode.removeChild(o)}}},{"./../Context":1}],13:[function(t,e,r){var n=t("./../Context"),i=n.gl,o=function(t,e,r){this.vBuf=i.createBuffer(),this.uBuf=i.createBuffer(),this.eBuf=i.createBuffer(),this.count=t.length/3,i.bindBuffer(i.ARRAY_BUFFER,this.vBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.uBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.eBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)};e.exports=o},{"./../Context":1}],14:[function(t,e,r){var n=function(t,e,r,n){this.nw=this.sw=this.ne=this.se=null,this.x=t,this.y=e,this.w=Math.abs(r),this.limit=n,this.points=[]};n.prototype.contains=function(t){return Math.abs(t.x-this.x)<this.w&&Math.abs(t.y-this.y)<this.w},n.prototype.insert=function(t){return this.contains(t)?this.points.length<this.limit?(this.points.push(t),!0):(null===this.nw&&this.subdivide(),this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t)):!1},n.prototype.subdivide=function(){var t=this.x,e=this.y,r=this.w/2;this.nw=new n(t-r,e-r,r,this.limit),this.sw=new n(t-r,e+r,r,this.limit),this.ne=new n(t+r,e-r,r,this.limit),this.se=new n(t+r,e+r,r,this.limit)},n.prototype.intersect=function(t,e,r){return Math.abs(this.x-t)<this.w+r&&Math.abs(this.y-e)<this.w+r},n.prototype.query=function(t,e,r){var n=[],o=[],a=this.points;if(!this.intersect(t,e,r))return n;for(var s=0,u=a.length;u>s;s++)i(a[s],t,e,r)&&n.push(a[s]);if(null===this.nw)return n;o=this.nw.query(t,e,r);for(var s=0,u=o.length;u>s;s++)n.push(o[s]);o=this.ne.query(t,e,r);for(var s=0,u=o.length;u>s;s++)n.push(o[s]);o=this.sw.query(t,e,r);for(var s=0,u=o.length;u>s;s++)n.push(o[s]);o=this.se.query(t,e,r);for(var s=0,u=o.length;u>s;s++)n.push(o[s]);return n};var i=function(t,e,r,n){return Math.abs(t.x-e)<n&&Math.abs(t.y-r)<n};e.exports=n},{}],15:[function(t,e,r){var n=t("./Geom"),i={extrude:function(t,e,r,n,i){var o=0,a=n,s=0;return void 0!==i&&(o=i[0]*n,a=i[1]*n,s=i[2]*n),{sym:t,points:[{x:e.x,y:e.y,z:e.z},{x:e.x+o,y:e.y+a,z:e.z+s},{x:r.x+o,y:r.y+a,z:r.z+s},{x:r.x,y:r.y,z:r.z}]}},extrudeAll:function(t,e,r,n){for(var o=[],a=0,s=t.length;s>a;++a){var u=t[a],h=t[(a+1)%s];o.push(i.extrude(r instanceof Array?r[a]:r,u,h,e,n))}return o},split:function(t,e,r,n){var o=[],a=0,s=n instanceof Array,u=t.points,h=t.uvs,l=u[0],c=u[1],p=u[3],f=l.x,x=p.x,v=l.y,d=c.y,m=l.z,y=p.z,g=1,z=1,E=0,b=0;h instanceof Array&&(g=h[3].s-h[0].s,z=h[1].t-h[0].t,E=h[0].s,b=h[1].t);for(var T=0,M=0,w=r.length;w>M;++M){for(var R=0,A=T+r[M],I=0,F=e.length;F>I;++I){var _=R+e[I],N=i.lerp(f,x,R),S=i.lerp(f,x,_),P=i.lerp(v,d,T),D=i.lerp(v,d,A),L=i.lerp(m,y,R),C=i.lerp(m,y,_);o.push({sym:s?n[a++]:n,points:[{x:N,y:P,z:L},{x:N,y:D,z:L},{x:S,y:D,z:C},{x:S,y:P,z:C}],uvs:[{s:E+g*R,t:b+z*T},{s:E+g*R,t:b+z*A},{s:E+g*_,t:b+z*A},{s:E+g*_,t:b+z*T}]}),R=_}T=A}return o},splitXZ:function(t,e,r,n){for(var o=[],a=0,s=t.points,u=s[0],h=s[1],l=s[3],c=u.x,p=l.x,f=u.y,x=h.y,v=u.z,d=h.z,m=0,y=0,g=r.length;g>y;++y){for(var z=0,E=0,b=e.length;b>E;++E){var T=i.lerp(c,p,z),M=i.lerp(c,p,z+e[E]),w=i.lerp(f,x,z),R=i.lerp(f,x,z+e[E]),A=i.lerp(v,d,m),I=i.lerp(v,d,m+r[y]);o.push({sym:n instanceof Array?n[a++]:n,points:[{x:T,y:w,z:A},{x:T,y:w,z:I},{x:M,y:R,z:I},{x:M,y:R,z:A}]}),z+=e[E]}m+=r[y]}return o},splitZX:function(t,e,r,n){for(var o=[],a=0,s=t.points,u=s[0],h=s[1],l=s[3],c=u.x,p=h.x,f=u.y,x=h.y,v=u.z,d=l.z,m=0,y=0,g=r.length;g>y;++y){for(var z=0,E=0,b=e.length;b>E;++E){var T=i.lerp(c,p,z),M=i.lerp(c,p,z+e[E]),w=i.lerp(f,x,z),R=i.lerp(f,x,z+e[E]),A=i.lerp(v,d,m),I=i.lerp(v,d,m+r[y]);o.push({sym:n instanceof Array?n[a++]:n,points:[{x:T,y:w,z:A},{x:T,y:w,z:I},{x:M,y:R,z:I},{x:M,y:R,z:A}]}),z+=e[E]}m+=r[y]}return o},fit:function(t,e,r,n){n=n||1;var o=e.points,a=o[0],s=o[1],u=o[3],h=a.x,l=u.x,c=a.y,p=s.y,f=a.z,x=s.z,v=u.z,d=l-h,m=p-c,y=v-f,g=x-f;if("x"===t){var z=m,E=n*z,b=Math.sqrt(d*d+y*y),T=Math.round(b/E),M=[];E=b/T,T=Math.max(1,Math.abs(T));for(var w=0;T>w;w++)M.push(1/T);return i.split(e,M,[1],r)}if("y"===t){var E=l-h,z=E/n,R=Math.sqrt(m*m+g*g),T=Math.round(R/z),M=[];z=R/T;for(var w=0;T>w;w++)M.push(1/T);return i.split(e,M,[1],r)}},bounds:function(t){var e,r,n,i,o=t.points;e=r=Number.POSITIVE_INFINITY,n=i=Number.NEGATIVE_INFINITY;for(var a=0,s=o.length;s>a;a++){var u=o[a];e=Math.min(u.x,e),r=Math.min(u.z,r),n=Math.max(u.x,n),i=Math.max(u.z,i)}return{width:n-e,depth:i-r}},inset:function(t,e){return n.insetPolygon(t.map(function(t){return{x:t.x,y:t.z}}),-e).map(function(e){return{x:e.x,y:t[0].y,z:e.y}})},lerp:function(t,e,r){return t*(1-r)+e*r}};e.exports=i},{"./Geom":11}],16:[function(t,e,r){var n=function(){this.rules=[]};n.prototype.define=function(t,e,r){this.rules.push({lhs:t,cond:e,rhs:r})},n.prototype.run=function(t){var e=[],r=this.rules,i=0;t=t instanceof Array?t:[t];for(var o=0,a=t.length;a>o;o++){var s=t[o];if(s.sym===n.TERMINAL||s.isTerminal)e.push(s);else for(var u=0,h=r.length;h>u;u++){var l=r[u];if(s.sym===l.lhs&&(null===l.cond||l.cond.call(s,t))){var c=l.rhs.call(s,t);c=c instanceof Array?c:[c];for(var p=0,f=c.length;f>p;p++)e.push(c[p]),++i;break}}}return i>0?this.run(e):e},n.TERMINAL="TERMINAL",e.exports=n},{}],17:[function(t,e,r){var n={no:function(t){return 0},lin:function(t){return t},in2:function(t){return t*t},out2:function(t){var e=1-t;return 1-e*e},in3:function(t){return t*t*t},out3:function(t){var e=1-t;return 1-e*e*e},h01:function(t){return t*t*(3-2*t)}},i=function(t,e,r,n){var o=r+Math.floor((n-r)/2);return 1>=n-r||e[o].time===t?o:e[o].time<t?i(t,e,o,n):i(t,e,r,o)},o=function(t,e,r){return Math.max(Math.min((r-t)/(e-t),1),0)},a=function(){this.keyframes=[]};a.prototype.at=function(t,e,r){var n=this.keyframes;return n.push({time:t,value:e,easing:r||"linear"}),this.count=n.length,this},a.prototype.update=function(t){var e=i(t,this.keyframes,0,this.count),r=this.keyframes[e],a=this.keyframes[Math.min(e+1,this.count-1)],s=r.value,u=a.value,h=n[a.easing].call(null,o(r.time,a.time,t));return s*(1-h)+u*h};var s=function(){this.properties={}};s.prototype.property=function(t){return t in this.properties||(this.properties[t]=new a),this.properties[t]},s.prototype.update=function(t){var e={};for(var r in this.properties)e[r]=this.properties[r].update(t);return e},e.exports=s},{}],18:[function(t,e,r){var n=Float32Array,i={};i.create=function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.clone=function(t){var e=new n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},i.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],p=e[10],f=e[11],x=e[12],v=e[13],d=e[14],m=e[15],y=r*s-n*a,g=r*u-i*a,z=r*h-o*a,E=n*u-i*s,b=n*h-o*s,T=i*h-o*u,M=l*v-c*x,w=l*d-p*x,R=l*m-f*x,A=c*d-p*v,I=c*m-f*v,F=p*m-f*d,_=y*F-g*I+z*A+E*R-b*w+T*M;return _?(_=1/_,t[0]=(s*F-u*I+h*A)*_,t[1]=(i*I-n*F-o*A)*_,t[2]=(v*T-d*b+m*E)*_,t[3]=(p*b-c*T-f*E)*_,t[4]=(u*R-a*F-h*w)*_,t[5]=(r*F-i*R+o*w)*_,t[6]=(d*z-x*T-m*g)*_,t[7]=(l*T-p*z+f*g)*_,t[8]=(a*I-s*R+h*M)*_,t[9]=(n*R-r*I-o*M)*_,t[10]=(x*b-v*z+m*y)*_,t[11]=(c*z-l*b-f*y)*_,t[12]=(s*w-a*A-u*M)*_,t[13]=(r*A-n*w+i*M)*_,t[14]=(v*g-x*E-d*y)*_,t[15]=(l*E-c*g+p*y)*_,t):null},i.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],p=e[10],f=e[11],x=e[12],v=e[13],d=e[14],m=e[15];return t[0]=s*(p*m-f*d)-c*(u*m-h*d)+v*(u*f-h*p),t[1]=-(n*(p*m-f*d)-c*(i*m-o*d)+v*(i*f-o*p)),t[2]=n*(u*m-h*d)-s*(i*m-o*d)+v*(i*h-o*u),t[3]=-(n*(u*f-h*p)-s*(i*f-o*p)+c*(i*h-o*u)),t[4]=-(a*(p*m-f*d)-l*(u*m-h*d)+x*(u*f-h*p)),t[5]=r*(p*m-f*d)-l*(i*m-o*d)+x*(i*f-o*p),t[6]=-(r*(u*m-h*d)-a*(i*m-o*d)+x*(i*h-o*u)),t[7]=r*(u*f-h*p)-a*(i*f-o*p)+l*(i*h-o*u),t[8]=a*(c*m-f*v)-l*(s*m-h*v)+x*(s*f-h*c),t[9]=-(r*(c*m-f*v)-l*(n*m-o*v)+x*(n*f-o*c)),t[10]=r*(s*m-h*v)-a*(n*m-o*v)+x*(n*h-o*s),t[11]=-(r*(s*f-h*c)-a*(n*f-o*c)+l*(n*h-o*s)),t[12]=-(a*(c*d-p*v)-l*(s*d-u*v)+x*(s*p-u*c)),t[13]=r*(c*d-p*v)-l*(n*d-i*v)+x*(n*p-i*c),t[14]=-(r*(s*d-u*v)-a*(n*d-i*v)+x*(n*u-i*s)),t[15]=r*(s*p-u*c)-a*(n*p-i*c)+l*(n*u-i*s),t},i.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8],l=t[9],c=t[10],p=t[11],f=t[12],x=t[13],v=t[14],d=t[15],m=e*a-r*o,y=e*s-n*o,g=e*u-i*o,z=r*s-n*a,E=r*u-i*a,b=n*u-i*s,T=h*x-l*f,M=h*v-c*f,w=h*d-p*f,R=l*v-c*x,A=l*d-p*x,I=c*d-p*v;return m*I-y*A+g*R+z*w-E*M+b*T},i.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=e[9],f=e[10],x=e[11],v=e[12],d=e[13],m=e[14],y=e[15],g=r[0],z=r[1],E=r[2],b=r[3];return t[0]=g*n+z*s+E*c+b*v,t[1]=g*i+z*u+E*p+b*d,t[2]=g*o+z*h+E*f+b*m,t[3]=g*a+z*l+E*x+b*y,g=r[4],z=r[5],E=r[6],b=r[7],t[4]=g*n+z*s+E*c+b*v,t[5]=g*i+z*u+E*p+b*d,t[6]=g*o+z*h+E*f+b*m,t[7]=g*a+z*l+E*x+b*y,g=r[8],z=r[9],E=r[10],b=r[11],t[8]=g*n+z*s+E*c+b*v,t[9]=g*i+z*u+E*p+b*d,t[10]=g*o+z*h+E*f+b*m,t[11]=g*a+z*l+E*x+b*y,g=r[12],z=r[13],E=r[14],b=r[15],t[12]=g*n+z*s+E*c+b*v,t[13]=g*i+z*u+E*p+b*d,t[14]=g*o+z*h+E*f+b*m,t[15]=g*a+z*l+E*x+b*y,t},i.mul=i.multiply,i.translate=function(t,e,r){var n,i,o,a,s,u,h,l,c,p,f,x,v=r[0],d=r[1],m=r[2];return e===t?(t[12]=e[0]*v+e[4]*d+e[8]*m+e[12],t[13]=e[1]*v+e[5]*d+e[9]*m+e[13],t[14]=e[2]*v+e[6]*d+e[10]*m+e[14],t[15]=e[3]*v+e[7]*d+e[11]*m+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=e[9],f=e[10],x=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h,t[7]=l,t[8]=c,t[9]=p,t[10]=f,t[11]=x,t[12]=n*v+s*d+c*m+e[12],t[13]=i*v+u*d+p*m+e[13],t[14]=o*v+h*d+f*m+e[14],t[15]=a*v+l*d+x*m+e[15]),t},i.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.rotate=function(t,e,r,n){var i,o,a,s,u,h,l,c,p,f,x,v,d,m,y,g,z,E,b,T,M,w,R,A,I=n[0],F=n[1],_=n[2],N=Math.sqrt(I*I+F*F+_*_);return Math.abs(N)<GLMAT_EPSILON?null:(N=1/N,I*=N,F*=N,_*=N,i=Math.sin(r),o=Math.cos(r),a=1-o,s=e[0],u=e[1],h=e[2],l=e[3],c=e[4],p=e[5],f=e[6],x=e[7],v=e[8],d=e[9],m=e[10],y=e[11],g=I*I*a+o,z=F*I*a+_*i,E=_*I*a-F*i,b=I*F*a-_*i,T=F*F*a+o,M=_*F*a+I*i,w=I*_*a+F*i,R=F*_*a-I*i,A=_*_*a+o,t[0]=s*g+c*z+v*E,t[1]=u*g+p*z+d*E,t[2]=h*g+f*z+m*E,t[3]=l*g+x*z+y*E,t[4]=s*b+c*T+v*M,t[5]=u*b+p*T+d*M,t[6]=h*b+f*T+m*M,t[7]=l*b+x*T+y*M,t[8]=s*w+c*R+v*A,t[9]=u*w+p*R+d*A,t[10]=h*w+f*R+m*A,t[11]=l*w+x*R+y*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},i.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],l=e[9],c=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+h*n,t[5]=a*i+l*n,t[6]=s*i+c*n,t[7]=u*i+p*n,t[8]=h*i-o*n,t[9]=l*i-a*n,t[10]=c*i-s*n,t[11]=p*i-u*n,t},i.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],l=e[9],c=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-h*n,t[1]=a*i-l*n,t[2]=s*i-c*n,t[3]=u*i-p*n,t[8]=o*n+h*i,t[9]=a*n+l*i,t[10]=s*n+c*i,t[11]=u*n+p*i,t},i.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],h=e[4],l=e[5],c=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+h*n,t[1]=a*i+l*n,t[2]=s*i+c*n,t[3]=u*i+p*n,t[4]=h*i-o*n,t[5]=l*i-a*n,t[6]=c*i-s*n,t[7]=p*i-u*n,t},i.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,h=o+o,l=n*s,c=n*u,p=n*h,f=i*u,x=i*h,v=o*h,d=a*s,m=a*u,y=a*h;return t[0]=1-(f+v),t[1]=c+y,t[2]=p-m,t[3]=0,t[4]=c-y,t[5]=1-(l+v),t[6]=x+d,t[7]=0,t[8]=p+m,t[9]=x-d,t[10]=1-(l+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},i.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,h=r*a,l=n*a,c=n*s,p=i*a,f=i*s,x=i*u,v=o*a,d=o*s,m=o*u;return t[0]=1-c-x,t[1]=l+m,t[2]=p-d,t[3]=0,t[4]=l-m,t[5]=1-h-x,t[6]=f+v,t[7]=0,t[8]=p+d,t[9]=f-v,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.frustum=function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),h=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*h,t[15]=0,t},i.perspective=function(t,e,r,n,i){var o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t},i.ortho=function(t,e,r,n,i,o,a){
var s=1/(e-r),u=1/(n-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*h,t[15]=1,t},i.lookAt=function(t,e,r,n){var o,a,s,u,h,l,c,p,f,x,v=e[0],d=e[1],m=e[2],y=n[0],g=n[1],z=n[2],E=r[0],b=r[1],T=r[2];return Math.abs(v-E)<GLMAT_EPSILON&&Math.abs(d-b)<GLMAT_EPSILON&&Math.abs(m-T)<GLMAT_EPSILON?i.identity(t):(c=v-E,p=d-b,f=m-T,x=1/Math.sqrt(c*c+p*p+f*f),c*=x,p*=x,f*=x,o=g*f-z*p,a=z*c-y*f,s=y*p-g*c,x=Math.sqrt(o*o+a*a+s*s),x?(x=1/x,o*=x,a*=x,s*=x):(o=0,a=0,s=0),u=p*s-f*a,h=f*o-c*s,l=c*a-p*o,x=Math.sqrt(u*u+h*h+l*l),x?(x=1/x,u*=x,h*=x,l*=x):(u=0,h=0,l=0),t[0]=o,t[1]=u,t[2]=c,t[3]=0,t[4]=a,t[5]=h,t[6]=p,t[7]=0,t[8]=s,t[9]=l,t[10]=f,t[11]=0,t[12]=-(o*v+a*d+s*m),t[13]=-(u*v+h*d+l*m),t[14]=-(c*v+p*d+f*m),t[15]=1,t)},i.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof r&&(r.mat4=i);var o={};o.create=function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,r){var i=new n(3);return i[0]=t,i[1]=e,i[2]=r,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},o.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},o.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},o.sub=o.subtract,o.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},o.mul=o.multiply,o.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.div=o.divide,o.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},o.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},o.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},o.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},o.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t},o.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t},o.random=function(t,e){e=e||1;var r=2*GLMAT_RANDOM()*Math.PI,n=2*GLMAT_RANDOM()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t},o.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12],t[1]=r[1]*n+r[5]*i+r[9]*o+r[13],t[2]=r[2]*n+r[6]*i+r[10]*o+r[14],t},o.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},o.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],h=r[3],l=h*n+s*o-u*i,c=h*i+u*n-a*o,p=h*o+a*i-s*n,f=-a*n-s*i-u*o;return t[0]=l*h+f*-a+c*-u-p*-s,t[1]=c*h+f*-s+p*-a-l*-u,t[2]=p*h+f*-u+l*-s-c*-a,t},o.rotateX=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},o.rotateY=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},o.rotateZ=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},o.forEach=function(){var t=o.create();return function(e,r,n,i,o,a){var s,u;for(r||(r=3),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof r&&(r.vec3=o);var a={};a.create=function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.clone=function(t){var e=new n(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=l*a-s*h,p=-l*o+s*u,f=h*o-a*u,x=r*c+n*p+i*f;return x?(x=1/x,t[0]=c*x,t[1]=(-l*n+i*h)*x,t[2]=(s*n-i*a)*x,t[3]=p*x,t[4]=(l*r-i*u)*x,t[5]=(-s*r+i*o)*x,t[6]=f*x,t[7]=(-h*r+n*u)*x,t[8]=(a*r-n*o)*x,t):null},a.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8];return t[0]=a*l-s*h,t[1]=i*h-n*l,t[2]=n*s-i*a,t[3]=s*u-o*l,t[4]=r*l-i*u,t[5]=i*o-r*s,t[6]=o*h-a*u,t[7]=n*u-r*h,t[8]=r*a-n*o,t},a.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8];return e*(h*o-a*u)+r*(-h*i+a*s)+n*(u*i-o*s)},a.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=r[0],f=r[1],x=r[2],v=r[3],d=r[4],m=r[5],y=r[6],g=r[7],z=r[8];return t[0]=p*n+f*a+x*h,t[1]=p*i+f*s+x*l,t[2]=p*o+f*u+x*c,t[3]=v*n+d*a+m*h,t[4]=v*i+d*s+m*l,t[5]=v*o+d*u+m*c,t[6]=y*n+g*a+z*h,t[7]=y*i+g*s+z*l,t[8]=y*o+g*u+z*c,t},a.mul=a.multiply,a.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=p*n+f*a+h,t[7]=p*i+f*s+l,t[8]=p*o+f*u+c,t},a.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=Math.sin(r),f=Math.cos(r);return t[0]=f*n+p*a,t[1]=f*i+p*s,t[2]=f*o+p*u,t[3]=f*a-p*n,t[4]=f*s-p*i,t[5]=f*u-p*o,t[6]=h,t[7]=l,t[8]=c,t},a.scale=function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},a.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,h=r*a,l=n*a,c=n*s,p=i*a,f=i*s,x=i*u,v=o*a,d=o*s,m=o*u;return t[0]=1-c-x,t[3]=l-m,t[6]=p+d,t[1]=l+m,t[4]=1-h-x,t[7]=f-v,t[2]=p-d,t[5]=f+v,t[8]=1-h-c,t},a.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],l=e[8],c=e[9],p=e[10],f=e[11],x=e[12],v=e[13],d=e[14],m=e[15],y=r*s-n*a,g=r*u-i*a,z=r*h-o*a,E=n*u-i*s,b=n*h-o*s,T=i*h-o*u,M=l*v-c*x,w=l*d-p*x,R=l*m-f*x,A=c*d-p*v,I=c*m-f*v,F=p*m-f*d,_=y*F-g*I+z*A+E*R-b*w+T*M;return _?(_=1/_,t[0]=(s*F-u*I+h*A)*_,t[1]=(u*R-a*F-h*w)*_,t[2]=(a*I-s*R+h*M)*_,t[3]=(i*I-n*F-o*A)*_,t[4]=(r*F-i*R+o*w)*_,t[5]=(n*R-r*I-o*M)*_,t[6]=(v*T-d*b+m*E)*_,t[7]=(d*z-x*T-m*g)*_,t[8]=(x*b-v*z+m*y)*_,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof r&&(r.mat3=a),e.exports={mat4:i,mat3:a,vec3:o}},{}],19:[function(t,e,r){function n(){l=!1,s.length?h=s.concat(h):c=-1,h.length&&i()}function i(){if(!l){var t=setTimeout(n);l=!0;for(var e=h.length;e;){for(s=h,h=[];++c<e;)s[c].run();c=-1,e=h.length}s=null,l=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},h=[],l=!1,c=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new o(t,e)),l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],20:[function(t,e,r){"use strict";function n(t,e){var r=o(i(t[0],!0)),n=e?{vertices:[],indices:[]}:[];if(!r)return n;var s,u,h,l,p,f,x,v,d,m=80;for(d=0;m>=0&&d<t.length;d++)m-=t[d].length;if(0>m){s=r.next,u=l=s.p[0],h=p=s.p[1];do f=s.p[0],x=s.p[1],u>f&&(u=f),h>x&&(h=x),f>l&&(l=f),x>p&&(p=x),s=s.next;while(s!==r);v=Math.max(l-u,p-h)}return t.length>1&&(r=c(t,r)),a(r,n,u,h,v),n}function i(t,e){var r,n,i,o,a,s=0,u=t.length;for(r=0,n=u-1;u>r;n=r++)i=t[r],o=t[n],s+=(o[0]-i[0])*(i[1]+o[1]);if(e===s>0)for(r=0;u>r;r++)a=A(t[r],a);else for(r=u-1;r>=0;r--)a=A(t[r],a);return a}function o(t,e){e||(e=t);var r,n=t;do if(r=!1,z(n.p,n.next.p)||0===g(n.prev.p,n.p,n.next.p)){if(n.prev.next=n.next,n.next.prev=n.prev,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ),n=e=n.prev,n===n.next)return null;r=!0}else n=n.next;while(r||n!==e);return e}function a(t,e,r,n,i,c){if(t){var p=void 0!==e.vertices;c||void 0===r||x(t,r,n,i);for(var f,v,d=t;t.prev!==t.next;)if(f=t.prev,v=t.next,u(t,r,n,i))p?(s(e,f),s(e,t),s(e,v)):(e.push(f.p),e.push(t.p),e.push(v.p)),v.prev=f,f.next=v,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t=v.next,d=v.next;else if(t=v,t===d){c?1===c?(t=h(t,e),a(t,e,r,n,i,2)):2===c&&l(t,e,r,n,i):a(o(t),e,r,n,i,1);break}}}function s(t,e){e.source&&(e=e.source);var r=e.index;if(null===r){var n=e.p.length,i=t.vertices;e.index=r=i.length/n;for(var o=0;n>o;o++)i.push(e.p[o])}t.indices.push(r)}function u(t,e,r,n){var i=t.prev.p,o=t.p,a=t.next.p,s=i[0],u=o[0],h=a[0],l=i[1],c=o[1],p=a[1],f=s*c-l*u,x=s*p-l*h,v=h*c-p*u,m=f-x-v;if(0>=m)return!1;var y,g,z,E,b,T,M,w=p-l,R=s-h,A=l-c,I=u-s;if(void 0!==e){var F=u>s?h>s?s:h:h>u?u:h,_=c>l?p>l?l:p:p>c?c:p,N=s>u?s>h?s:h:u>h?u:h,S=l>c?l>p?l:p:c>p?c:p,P=d(F,_,e,r,n),D=d(N,S,e,r,n);for(M=t.nextZ;M&&M.z<=D;)if(y=M.p,M=M.nextZ,y!==i&&y!==a&&(g=y[0],z=y[1],E=w*g+R*z-x,E>=0&&(b=A*g+I*z+f,b>=0&&(T=m-E-b,T>=0&&(E&&b||E&&T||b&&T)))))return!1;for(M=t.prevZ;M&&M.z>=P;)if(y=M.p,M=M.prevZ,y!==i&&y!==a&&(g=y[0],z=y[1],E=w*g+R*z-x,E>=0&&(b=A*g+I*z+f,b>=0&&(T=m-E-b,T>=0&&(E&&b||E&&T||b&&T)))))return!1}else for(M=t.next.next;M!==t.prev;)if(y=M.p,M=M.next,g=y[0],z=y[1],E=w*g+R*z-x,E>=0&&(b=A*g+I*z+f,b>=0&&(T=m-E-b,T>=0&&(E&&b||E&&T||b&&T))))return!1;return!0}function h(t,e){var r=!!e.vertices,n=t;do{var i=n.prev,o=n.next.next;if(i.p!==o.p&&E(i.p,n.p,n.next.p,o.p)&&T(i,o)&&T(o,i)){r?(s(e,i),s(e,n),s(e,o)):(e.push(i.p),e.push(n.p),e.push(o.p)),i.next=o,o.prev=i;var a=n.prevZ,u=n.nextZ&&n.nextZ.nextZ;a&&(a.nextZ=u),u&&(u.prevZ=a),n=t=o}n=n.next}while(n!==t);return n}function l(t,e,r,n,i){var s=t;do{for(var u=s.next.next;u!==s.prev;){if(s.p!==u.p&&y(s,u)){var h=R(s,u);return s=o(s,s.next),h=o(h,h.next),a(s,e,r,n,i),void a(h,e,r,n,i)}u=u.next}s=s.next}while(s!==t)}function c(t,e){for(var r=t.length,n=[],a=1;r>a;a++){var s=o(i(t[a],!1));s&&n.push(m(s))}for(n.sort(w),a=0;a<n.length;a++)p(n[a],e),e=o(e,e.next);return e}function p(t,e){if(e=f(t,e)){var r=R(e,t);o(r,r.next)}}function f(t,e){var r,n,i,o=e,a=t.p,s=a[0],u=a[1],h=-(1/0);do{if(n=o.p,i=o.next.p,u<=n[1]&&u>=i[1]){var l=n[0]+(u-n[1])*(i[0]-n[0])/(i[1]-n[1]);s>=l&&l>h&&(h=l,r=n[0]<i[0]?o:o.next)}o=o.next}while(o!==e);if(!r)return null;var c,p,f,x,v,d,m=r.p[0],y=r.p[1],g=s*y-u*m,z=s*u-u*h,E=u-u,b=s-h,M=u-y,w=m-s,R=g-z-(h*y-u*m),A=0>=R?-1:1,I=r,F=1/0;for(o=r.next;o!==I;)c=o.p[0],p=o.p[1],f=s-c,f>=0&&c>=m&&(x=(E*c+b*p-z)*A,x>=0&&(v=(M*c+w*p+g)*A,v>=0&&R*A-x-v>=0&&(d=Math.abs(u-p)/f,F>d&&T(o,t)&&(r=o,F=d)))),o=o.next;return r}function x(t,e,r,n){var i=t;do null===i.z&&(i.z=d(i.p[0],i.p[1],e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,v(i)}function v(t){for(var e,r,n,i,o,a,s,u,h=1;;){for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;h>e&&(s++,n=n.nextZ,n);e++);for(u=h;s>0||u>0&&n;)0===s?(i=n,n=n.nextZ,u--):0!==u&&n?r.z<=n.z?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}if(o.nextZ=null,1>=a)return t;h*=2}}function d(t,e,r,n,i){return t=1e3*(t-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=1e3*(e-n)/i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function m(t){var e=t,r=t;do e.p[0]<r.p[0]&&(r=e),e=e.next;while(e!==t);return r}function y(t,e){return!b(t,t.p,e.p)&&T(t,e)&&T(e,t)&&M(t,t.p,e.p)}function g(t,e,r){var n=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return n>0?1:0>n?-1:0}function z(t,e){return t[0]===e[0]&&t[1]===e[1]}function E(t,e,r,n){return g(t,e,r)!==g(t,e,n)&&g(r,n,t)!==g(r,n,e)}function b(t,e,r){var n=t;do{var i=n.p,o=n.next.p;if(i!==e&&o!==e&&i!==r&&o!==r&&E(i,o,e,r))return!0;n=n.next}while(n!==t);return!1}function T(t,e){return-1===g(t.prev.p,t.p,t.next.p)?-1!==g(t.p,e.p,t.next.p)&&-1!==g(t.p,t.prev.p,e.p):-1===g(t.p,e.p,t.prev.p)||-1===g(t.p,t.next.p,e.p)}function M(t,e,r){var n=t,i=!1,o=(e[0]+r[0])/2,a=(e[1]+r[1])/2;do{var s=n.p,u=n.next.p;s[1]>a!=u[1]>a&&o<(u[0]-s[0])*(a-s[1])/(u[1]-s[1])+s[0]&&(i=!i),n=n.next}while(n!==t);return i}function w(t,e){return t.p[0]-e.p[0]}function R(t,e){var r=new I(t.p),n=new I(e.p),i=t.next,o=e.prev;return r.source=t,n.source=e,t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function A(t,e){var r=new I(t);return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function I(t){this.p=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.source=null,this.index=null}e.exports=n},{}],21:[function(t,e,r){!function(t,n){"use strict";"object"==typeof r?e.exports=n():"function"==typeof define&&define.amd?define(n):t.MersenneTwister=n()}(this,function(){"use strict";var t=4294967296,e=624,r=397,n=2147483648,i=2147483647,o=2567483615,a=function(t){"undefined"==typeof t&&(t=(new Date).getTime()),this.mt=new Array(e),this.mti=e+1,this.seed(t)};a.prototype.seed=function(t){var r;for(this.mt[0]=t>>>0,this.mti=1;this.mti<e;this.mti++)r=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&r)>>>16)<<16)+1812433253*(65535&r)+this.mti,this.mt[this.mti]>>>=0},a.prototype.seedArray=function(t){var r,n=1,i=0,o=e>t.length?e:t.length;for(this.seed(19650218);o>0;o--)r=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1664525*((4294901760&r)>>>16)<<16)+1664525*(65535&r))+t[i]+i,this.mt[n]>>>=0,n++,i++,n>=e&&(this.mt[0]=this.mt[e-1],n=1),i>=t.length&&(i=0);for(o=e-1;o;o--)r=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1566083941*((4294901760&r)>>>16)<<16)+1566083941*(65535&r))-n,this.mt[n]>>>=0,n++,n>=e&&(this.mt[0]=this.mt[e-1],n=1);this.mt[0]=2147483648},a.prototype.int=function(){var t,a,s=new Array(0,o);if(this.mti>=e){for(this.mti===e+1&&this.seed(5489),a=0;e-r>a;a++)t=this.mt[a]&n|this.mt[a+1]&i,this.mt[a]=this.mt[a+r]^t>>>1^s[1&t];for(;e-1>a;a++)t=this.mt[a]&n|this.mt[a+1]&i,this.mt[a]=this.mt[a+(r-e)]^t>>>1^s[1&t];t=this.mt[e-1]&n|this.mt[0]&i,this.mt[e-1]=this.mt[r-1]^t>>>1^s[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},a.prototype.int31=function(){return this.int()>>>1},a.prototype.real=function(){return this.int()*(1/(t-1))},a.prototype.realx=function(){return(this.int()+.5)*(1/t)},a.prototype.rnd=function(){return this.int()*(1/t)},a.prototype.random=a.prototype.rnd,a.prototype.rndHiRes=function(){var t=this.int()>>>5,e=this.int()>>>6;return(67108864*t+e)*(1/9007199254740992)};var s=new a;return a.random=function(){return s.rnd()},a})},{}],22:[function(t,e,r){var n=function(){var t=Date.now(),e=t,r=0,n=1/0,i=0,o=0,a=1/0,s=0,u=0,h=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),y(++h%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps",c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(c);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",c.appendChild(p);var f=document.createElement("div");for(f.id="fpsGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",c.appendChild(f);74>f.children.length;){var x=document.createElement("span");x.style.cssText="width:1px;height:30px;float:left;background-color:#113",f.appendChild(x)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var d=document.createElement("div");d.id="msText",d.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="MS",v.appendChild(d);var m=document.createElement("div");for(m.id="msGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(m);74>m.children.length;)x=document.createElement("span"),x.style.cssText="width:1px;height:30px;float:left;background-color:#131",m.appendChild(x);var y=function(t){switch(h=t){case 0:c.style.display="block",v.style.display="none";break;case 1:c.style.display="none",v.style.display="block"}};return{REVISION:12,domElement:l,setMode:y,begin:function(){t=Date.now()},end:function(){var h=Date.now();r=h-t,n=Math.min(n,r),i=Math.max(i,r),d.textContent=r+" MS ("+n+"-"+i+")";var l=Math.min(30,30-30*(r/200));return m.appendChild(m.firstChild).style.height=l+"px",u++,h>e+1e3&&(o=Math.round(1e3*u/(h-e)),a=Math.min(a,o),s=Math.max(s,o),p.textContent=o+" FPS ("+a+"-"+s+")",l=Math.min(30,30-30*(o/100)),f.appendChild(f.firstChild).style.height=l+"px",e=h,u=0),h},update:function(){t=this.end()}}};"object"==typeof e&&(e.exports=n)},{}],23:[function(t,e,r){(function(r){var n=t("./../lib/glMatrixSubset"),i=t("./../Context"),o=t("./../lib/Mesh"),a=t("./../lib/QuadTree"),s=t("./../lib/Timeline"),u=t("./../lib/Loader"),h=n.mat4,l=i.gl,c=t("../generators/BuildingSHG.js"),p=t("../generators/City.js"),f=function(t,e,r){return t*(1-r)+e*r},x=function(t,e){for(var r=[],n=[],i=[],a=[],s=[],u=0,h=t.lots.length;h>u;u++){var l,p,f,x,v,d,m,y,g;l=t.lots[u],p=l.height,f=l.angle,l=l.poly,x=v=0,d=y=Number.POSITIVE_INFINITY,m=g=Number.NEGATIVE_INFINITY;for(var z=0,E=l.length;E>z;z++){var b=l[z];x+=b.x,v+=b.y,d=Math.min(d,b.x),m=Math.max(m,b.x),y=Math.min(y,b.y),g=Math.max(g,b.y)}x/=l.length,v/=l.length;for(var T=c.create({x:x,y:v,width:.9*Math.abs(m-d),depth:.9*Math.abs(g-y),angle:f}),M=T.geom,w=T.color,R=0,A=M.length;A>R;R++){var I=M[R];if("light"in I)a.push(I.light);else for(var z=0,E=I.vertices.length;E>z;z++)r.push(I.vertices[z]),n.push(I.uvs[z]),i.push(w[z%3])}s.push({mesh:new o(r,n,i),x:x,y:v,w:Math.max(m-d,g-y)}),r.splice(0),n.splice(0),i.splice(0)}return{meshes:s,lights:a,x:t.x,y:t.y,w:t.w}},v=new p(0),d={quadtree:null,quadtreeLights:null,fixedMeshes:[]};if("production"!==r.env.NODE_ENV){var m=document.createElement("pre");m.style.background="white",m.style.color="black",m.style.position="absolute",m.style.right="1rem",m.style.top="7rem",i.canvas.parentElement.appendChild(m)}!function(){var t,e=[],r=[],n=[],i=[],s=[],h=0,l=v.blocks.length;!function(){var t=[];v.roads.forEach(function(e){s.push({x:e.x,y:.5,z:e.y}),e.conns.forEach(function(r){-1===t.indexOf(r)&&(s.push({x:f(e.x,r.x,.33),y:.5,z:f(e.y,r.y,.33)}),s.push({x:f(e.x,r.x,.66),y:.5,z:f(e.y,r.y,.66)}))}),t.push(e)})}(),function(){var t=function(){var e=v.blocks.shift(),r=x(e);i.push(r),h++,u.progress("Blocks",h/l),v.blocks.length>0&&setTimeout(t,0)};setTimeout(t,0)}(),u.subscribe("Blocks",function(e,r){return function(){var n,i,o,u;n=i=Number.POSITIVE_INFINITY,o=u=Number.NEGATIVE_INFINITY,r.forEach(function(t){n=Math.min(n,t.x-t.w),o=Math.max(o,t.x+t.w),i=Math.min(i,t.y-t.w),u=Math.max(u,t.y+t.w)});var h=Math.abs(o-n)/2,l=Math.abs(u-i)/2;t=new a(h,l,Math.max(h,l),16),r.forEach(function(e){e.meshes.forEach(function(e){t.insert(e)})}),e.quadtree=t,e.allLights=s}}(d,i)),e.push.apply(e,[-20,-.001,-20,-20,-.001,20,20,-.001,20,-20,-.001,-20,20,-.001,20,20,-.001,-20]),r.push.apply(r,[0,0,3,0,40,3,40,40,3,0,0,3,40,40,3,40,0,3]),n.push.apply(n,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(var c=.001,p=v.roadQuads.reduce(function(){var t,e;return t=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],e=[0,0,2,0,1,2,1,1,2,0,0,2,1,1,2,1,0,2],function(t,r){for(var n=r[0],i=r[1],o=Math.atan2(i.y-n.y,i.x-n.x)+Math.PI/2,a=Math.abs(.09*Math.cos(o)),s=Math.abs(.09*Math.sin(o)),u={x:n.x+s,y:n.y+a},h={x:i.x-s,y:i.y-a},l=Math.sqrt(Math.pow(h.y-u.y,2)+Math.pow(h.x-u.x,2)),p=[u.x-a,c,u.y-s,h.x-a,c,h.y-s,h.x+a,c,h.y+s,u.x-a,c,u.y-s,h.x+a,c,h.y+s,u.x+a,c,u.y+s],f=e.map(function(t,e){switch(e%3){case 0:return t;case 1:return t*l;default:return t}return t}),x=0,v=p.length;v>x;x++)t.vertices.push(p[x]),t.uvs.push(f[x]),t.extra.push(0);return t}}(),{vertices:[],uvs:[],extra:[]}),m=v.roads.reduce(function(){var t,e,r=.09,n=.09;return t=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],e=[0,0,8,0,1,8,1,1,8,0,0,8,1,1,8,1,0,8],function(t,i){for(var o=i.x,a=i.y,s=[o-r,c,a-n,o-r,c,a+n,o+r,c,a+n,o-r,c,a-n,o+r,c,a+n,o+r,c,a-n],u=0,h=s.length;h>u;u++)t.vertices.push(s[u]),t.uvs.push(e[u]),t.extra.push(0);return t}}(),{vertices:[],uvs:[],extra:[]}),y=0,g=m.vertices.length;g>y;y++)e.push(m.vertices[y]),r.push(m.uvs[y]),n.push(m.extra[y]);for(var y=0,g=p.vertices.length;g>y;y++)e.push(p.vertices[y]),r.push(p.uvs[y]),n.push(p.extra[y]);d.fixedMeshes=[new o(e,r,n)]}();var y={meshes:[],lights:[],lightParameters:[12,0,6,32],view:h.create(),model:h.create(),count:0,texture:l.createTexture()};l.bindTexture(l.TEXTURE_2D,y.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i.w,i.h,0,l.RGBA,l.UNSIGNED_BYTE,null),l.bindTexture(l.TEXTURE_2D,null);var g=function(t,e){return t.push(e),t},z=2.71,E=.38,b=1.31,T=.26,M=.79,w=0,R=0,A=new s;!function(){var t=A.property("x"),e=A.property("y"),r=A.property("z"),n=A.property("a"),i=A.property("b"),o=A.property("f");o.at(0,0).at(2e3,1,"h01"),t.at(0,1.54).at(2e3,1.54,"no").at(8e3,1.91,"h01"),e.at(0,.38),r.at(0,.19).at(2e3,.19,"no").at(8e3,.03,"h01"),n.at(0,0).at(2e3,0,"no").at(8e3,.24,"h01"),i.at(0,-3.54).at(2e3,-3.54,"no").at(8e3,-3.45,"h01"),t.at(9e3,.78,"no"),e.at(9e3,.1,"no"),r.at(9e3,2.03,"no"),n.at(9e3,-.75,"no").at(12e3,-.65,"h01"),i.at(9e3,.65,"no").at(12e3,.75,"h01"),t.at(13e3,2.97,"no"),e.at(13e3,1.02,"no").at(4e4,.02,"h01"),r.at(13e3,2.16,"no"),n.at(13e3,.34,"no").at(4e4,-.04,"h01"),i.at(13e3,-3.26,"no").at(4e4,-6.84,"h01"),o.at(39800,1,"no").at(4e4,0,"h01").at(40200,1,"h01"),t.at(4e4,5.45,"no").at(56e3,3.27,"h01").at(7e4,3.27,"out3").at(8e4,3.4,"in3"),e.at(4e4,1.28,"no").at(56e3,.48,"h01").at(7e4,.48,"out3").at(8e4,.425,"in3"),r.at(4e4,.56,"no").at(56e3,2.15,"h01").at(7e4,2.15,"out3").at(8e4,1.83,"in3"),n.at(4e4,.26,"no").at(56e3,-.18,"h01").at(7e4,.05,"out3").at(8e4,0,"in3"),i.at(4e4,-2.72,"no").at(56e3,-2.35,"h01").at(7e4,.21,"out3").at(8e4,0,"in3")}();var I=!0;y.update=function(t){var e,n,i,o,a;if(I){var s=A.update(t);z=e=s.x,E=n=s.y,b=i=s.z,T=o=s.a,M=a=s.b,y.fade=s.f}else z+=(Math.cos(M)*w-Math.sin(M)*R)*Math.cos(T),E+=Math.sin(T)*R,b+=(Math.sin(M)*w+Math.cos(M)*R)*Math.cos(T),e=z,n=E,i=b,o=T,a=M,y.fade=1;"production"!==r.env.NODE_ENV&&(m.textContent=[e,n,i,y.fade].map(function(t){return t.toFixed(2)}).join(", ")+" "+o.toFixed(2)+" "+a.toFixed(2)),h.identity(y.view),h.rotateX(y.view,y.view,o),h.rotateY(y.view,y.view,a),h.translate(y.view,y.view,[-e,-n,-i]);var u=d.quadtree.query(e,i,4);y.meshes=d.fixedMeshes.reduce(g,[]),y.meshes=u.map(function(t){return t.mesh}).reduce(g,y.meshes),y.lights=d.allLights.reduce(function(t,e){for(var r=0;6>r;r++)t.push(e.x,e.y,e.z);return t},[]),"production"!==r.env.NODE_ENV&&(m.textContent+="\nTime: "+t.toFixed(2),m.textContent+="\nVertices: "+y.meshes.reduce(function(t,e){return t+e.count},0),m.textContent+=", Lights: "+y.lights.length/18)},"production"!==r.env.NODE_ENV&&(i.canvas.addEventListener("click",function(t){2===t.which&&(I=!I)}),document.body.addEventListener("keydown",function(t){switch(t.which){case 87:R=-.008;break;case 83:R=.008;break;case 65:w=-.008;break;case 68:w=.008}}),document.body.addEventListener("keyup",function(t){switch(t.which){case 87:R=0;break;case 83:R=0;break;case 65:w=0;break;case 68:w=0}}),i.canvas.addEventListener("mousedown",function(t){var e,r,n=t.clientX,o=t.clientY;e=function(t){var e=t.clientX-n,r=t.clientY-o;T+=.005*r,M+=.005*e,n=t.clientX,o=t.clientY,m.textContent=[z,E,b].map(function(t){return t.toFixed(2)}).join(", ")+" "+T.toFixed(2)+" "+M.toFixed(2)},r=function(t){i.canvas.removeEventListener("mousemove",e),i.canvas.removeEventListener("mouseup",r)},i.canvas.addEventListener("mousemove",e),i.canvas.addEventListener("mouseup",r)})),e.exports=y}).call(this,t("_process"))},{"../generators/BuildingSHG.js":5,"../generators/City.js":6,"./../Context":1,"./../lib/Loader":12,"./../lib/Mesh":13,"./../lib/QuadTree":14,"./../lib/Timeline":17,"./../lib/glMatrixSubset":18,_process:19}],24:[function(t,e,r){var n,i,o,a,s,u=t("./../lib/glMatrixSubset"),h=t("./../Context"),l=t("./../lib/Loader"),c=t("./../lib/Mesh"),p=u.vec3,f=u.mat4,x=h.gl,v=t("../generators/RoomSHG.js"),d=t("./../generators/PRNG"),m=t("./../lib/Timeline"),y={meshes:[],lights:[],lightParameters:[6,0,2,.1],view:f.create(),model:f.create(),count:0,texture:x.createTexture()};o=new d(54321),x.bindTexture(x.TEXTURE_2D,y.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,h.w,h.h,0,x.RGBA,x.UNSIGNED_BYTE,null),x.bindTexture(x.TEXTURE_2D,null),y.init=function(){var t=0,e=.25;a=function(t,e){var r=t.vertices,n=t.uvs,i=[];return e=e.reduce(function(t,e){return void 0!==e.door&&t.push(e.door.point),t.push(e.room.roomCentroid),t},[]),i=r.map(function(t,e){return.4}),{room:t,mesh:new c(r,n,i),lampMesh:new c(new Float32Array(t.lamp.vertices),new Float32Array(t.lamp.uvs),new Float32Array(t.lamp.extra)),tableMesh:new c(new Float32Array(t.table.vertices),new Float32Array(t.table.uvs),new Float32Array(t.table.extra)),lights:t.roomsWorld.map(function(t){return{x:t.x,y:t.y+.75,z:t.z}}),path:e}};var r=function(t,e,r){var n,i,o=[t],a=[],s=[],u=[];for(a[r.indexOf(t)]=null;o.length>0&&(n=o.shift(),n!==e);)n.neighbors.forEach(function(t){var e=r.indexOf(t.r);void 0===a[e]&&(o.push(t.r),a[e]=n,s[e]=t.via)});for(n=e;null!==n;)if(i=r.indexOf(n),void 0!==s[i]&&u.unshift({room:n,door:s[i]}),n=a[i],void 0===n)return u;return u};i=v.create([{x:-4,y:0,z:-8},{x:-4,y:0,z:8},{x:4,y:0,z:8},{x:4,y:0,z:-8}]),t+=e,l.progress("Rooms",t);var u=[],h=i.nodes.reduce(function(t,e){return e.isFirst&&(t.first=e),e.isLast&&(t.last=e),t},{first:null,last:null}),x=i.nodes.filter(function(t){return!t.isMonitor});x.sort(function(){var t=o.random()-.5;return t});for(var d=0,g=i.nodes.length;g-1>d;d+=2)u=u.concat(r(x[d],x[(d+2)%g],x));u=u.concat(r(x[x.length-1],h.first,x)),u=u.concat(r(h.first,h.last,i.nodes)),u.push({room:i.monitor}),t+=e,l.progress("Rooms",t),n=a(i,u),y.meshes=[n.mesh,n.lampMesh,n.tableMesh],y.lights=n.lights.reduce(function(t,e){for(var r=0;6>r;r++)t.push(e.x,e.y,e.z);return t},[]),t+=e,l.progress("Rooms",t),s=function(t){for(var e=new m,r=e.property("x"),n=e.property("y"),i=e.property("z"),o=e.property("th"),a=0,s=NaN,u=0,h=t.length;h-2>u;u++){var l=t[u],c=t[Math.min(u+1,h-1)],p=t[Math.min(u+2,h-1)],f=c.x-l.x,x=c.z-l.z,v=Math.sqrt(f*f+x*x),d=(Math.atan2(-p.z+c.z,p.x-c.x)+3*Math.PI/2)%(2*Math.PI);for(isNaN(s)&&(s=d),u>=h-4&&(d=s);d-s>Math.PI;)d-=2*Math.PI;for(;s-d>Math.PI;)s-=2*Math.PI;0==u&&(r.at(a,l.x,"no"),n.at(a,l.y,"no"),i.at(a,l.z,"no"),o.at(a,s,"no")),a+=1e3*v,r.at(a,c.x,"lin"),n.at(a,c.y,"lin"),i.at(a,c.z,"lin"),o.at(a,d,"lin"),s=d}return a+=4e3,r.at(a,p.x,"in3"),n.at(a,p.y,"in3"),i.at(a,p.z,"in3"),o.at(a,s,"in3"),y.totalTime=a,function(t){return e.update(t)}}(n.path),t+=e,l.progress("Rooms",t),f.translate(y.view,y.view,[0,0,-6]),f.rotateX(y.view,y.view,Math.PI/2),f.rotateY(y.view,y.view,Math.PI/2),y.update=function(t){var e=s(isNaN(t)?0:t),r=e.x,n=e.z,i=e.th,o=0,a=0,u=0,h=p.fromValues(-.0625,.25,.0625),l=p.fromValues(0,.25,-.25),c=p.fromValues(.0625,.25,.0625),x=f.create();f.translate(x,x,[r,0,n]),f.scale(x,x,[2,1,2]),f.rotateY(x,x,i),p.transformMat4(h,h,x),p.transformMat4(l,l,x),p.transformMat4(c,c,x),f.identity(y.view),f.rotateY(y.view,y.view,-i),f.translate(y.view,y.view,[-r+a,-.75+o,-n+u])}},e.exports=y},{"../generators/RoomSHG.js":10,"./../Context":1,"./../generators/PRNG":8,"./../lib/Loader":12,"./../lib/Mesh":13,"./../lib/Timeline":17,"./../lib/glMatrixSubset":18}],25:[function(t,e,r){(function(e){function r(){0===f&&requestAnimationFrame(r),h.render()}function n(t){(isNaN(n.t0)||void 0===n.t0)&&(n.t0=t),void 0!==n.t1&&!isNaN(n.t1)&&t-n.t1>32&&console.log("WARN",t-n.t1),"production"!==e.env.NODE_ENV&&i.begin();var r=t-n.t0;8e4>r?(c.update(r),u.render(c,!0)):(r-=4e3,r%=76e3+p.totalTime,76e3>r?(c.update(r+4e3),u.render(c,!0)):(c.update(Math.max(0,r-(76e3+p.totalTime)+4e3)),p.update(r-76e3),u.render(c),u.render(p,!0))),"production"!==e.env.NODE_ENV&&i.end(),requestAnimationFrame(n),n.t1=t}var i,o=t("./Context"),a=o.canvas,s=o.gl,u=t("./Renderer.js"),h=t("./lib/Loader"),l=(t("./lib/Timeline"),t("stats-js")),c=t("./scenes/MainScene.js"),p=t("./scenes/RoomScene.js");"production"!==e.env.NODE_ENV&&(i=new l,i.setMode(0),i.domElement.style.position="absolute",i.domElement.style.right="1rem",i.domElement.style.top="1rem",a.parentNode.appendChild(i.domElement));var f=0,x=0,v=NaN;if(h.subscribe("Blocks",function(){x+=.5,h.progress("City",x)}),h.subscribe("Rooms",function(){x+=.5,h.progress("City",x)}),h.subscribe("City",function(){console.log("Loading complete"),h.remove(),f=1,v=NaN,u.init(c,p),c.update(0),u.render(c,!0),p.update(0),u.render(p),setTimeout(n,1e3)}),"production"!==e.env.NODE_ENV){var d=0,m=!1;document.addEventListener("keydown",function(t){32===t.keyCode&&(t.preventDefault(),t.stopPropagation(),m=!m)}),document.addEventListener("wheel",function(t){t.preventDefault(),t.stopPropagation(),d+=t.deltaY,d=Math.max(d,0)}),window.JMP=function(t){
d=t}}s.viewport(0,0,o.w,o.h),p.init(),r()}).call(this,t("_process"))},{"./Context":1,"./Renderer.js":2,"./lib/Loader":12,"./lib/Timeline":17,"./scenes/MainScene.js":23,"./scenes/RoomScene.js":24,_process:19,"stats-js":22}]},{},[25]);